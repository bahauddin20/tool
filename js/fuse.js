!function(e){"function"==typeof fuseDefine&&fuseDefine.amd?fuseDefine(e):e()}((function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,n){return(t=h(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=s(e);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(t=e))throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(this,t?(n=s(this).constructor,Reflect.construct(i,arguments,n)):i.apply(this,arguments))}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){var n;if(e)return"string"==typeof e?g(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function h(e){return e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return String(e);if("object"!=typeof(n=n.call(e,"string")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e),"symbol"==typeof e?e:String(e)}Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0!=i){t=0|t;for(var r,o,s=Math.max(0<=t?t:i-Math.abs(t),0);s<i;){if((r=n[s])===(o=e)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;s++}}return!1}}),"undefined"!=typeof window&&window.NodeList&&!window.NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var f=["verbose","debug","info","warn","error","off"],p=function(){function e(n,i,r){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"off";t(this,e),this.console=n,this.logName=i,this.fuseDob=r,this.logLevel=o,this.logs=[]}return i(e,[{key:"setFuseDob",value:function(e){this.fuseDob=e}},{key:"getTimestamp",value:function(){return this.fuseDob?" [".concat(Date.now()-this.fuseDob,"]"):""}},{key:"callLogMethod",value:function(e){if("off"!==e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=["[".concat(this.logName,"]-").concat(n[0]).concat(this.getTimestamp())].concat(l(n.slice(1)));"warn"!==e&&"error"!==e||(1e3<=this.logs.length&&(this.logs=[]),this.logs.push({level:e,params:r})),"error"!==e&&f.indexOf(e)<f.indexOf(this.logLevel)||this.console["verbose"!=e?e:"debug"].apply(null,r)}}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.callLogMethod("error",t)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.callLogMethod("warn",t)}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.callLogMethod("info",t)}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.callLogMethod("info",t)}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.callLogMethod("debug",t)}},{key:"setLogLevel",value:function(e){this.logLevel=e}},{key:"getLogLevel",value:function(){return this.logLevel}},{key:"getLogs",value:function(){return this.logs}}]),e}();function v(e){return"number"==typeof e&&e==e}function b(e){return null==e}function m(e){return void 0===e}function S(e){return!b(e)}function y(e){throw new Error("exhaustiveCheck(".concat(e,") should not have been called"))}function k(e){if(!(e instanceof Error))throw e}var I=new(function(){function e(){t(this,e),this.sessionId=function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,t="",n=0;n<e;++n)t+=Math.floor(16*Math.random()).toString(16);return t}()}return i(e,[{key:"isInDebugMode",value:function(){return"true"===this.getQueryParam("fuse_debug")[1]}},{key:"getWindowLocation",value:function(){if(!this.location)try{this.location=this.getBrowserWindowObject().self.location}catch(e){this.location=this.getBrowserWindowObject().location}return this.location}},{key:"getFuseDob",value:function(){return this.getBrowserWindowObject().performance.timing.navigationStart}},{key:"getPackageMajorVersion",value:function(){return 2}},{key:"getBrowserWindowObject",value:function(){return window.self}},{key:"getQueryParam",value:function(e){return this.getWindowLocation().search.split(/[?&]/).filter((function(e){return""!==e})).map((function(e){return e.split("=")})).filter((function(t){return t[0]===e}))[0]||[]}},{key:"getMainLogPrefix",value:function(){return"FUSE"}},{key:"getLogLevel",value:function(){var e;return this.isInDebugMode()||S(this.fuseDebugger)?"debug":this.getQueryParam("fuse_log_level")&&this.getQueryParam("fuse_log_level")[1]&&(e=this.getQueryParam("fuse_log_level")[1],-1!==f.indexOf(e))?e:"off"}},{key:"getLogger",value:function(){return this.logger||(this.logger=new p(this.getBrowserWindowObject().console,this.getMainLogPrefix(),this.getFuseDob(),this.getLogLevel())),this.logger}},{key:"getFuseDebugger",value:function(){var e;return m(this.fuseDebugger)&&(e=I.getBrowserWindowObject().fuseDebugger,this.fuseDebugger=null!=e?e:null,this.fuseDebugger)&&(this.fuseDebugger.connect(),this.getLogger().debug("[MONITORING]: Debugger attached")),null!=(e=this.fuseDebugger)?e:void 0}},{key:"getSessionId",value:function(){return this.sessionId}}]),e}());function C(e,t){e&&t()}function E(e,t,n,i){e&&0<e?(n.info("[DELAY]: Delaying by ".concat(e,"ms to ").concat(t)),setTimeout(i,e)):i()}var w,T,_,A=function(e){return/[E]dge/.test(e.navigator.userAgent)},R=I.getBrowserWindowObject(),x=I.getLogger(),P=function(e,t){x.debug("[INIT]: Downloading library ".concat(e.name));var n,i,r=R.document.createElement("script");r.async=!0,r.type="text/javascript",e.id&&(r.id=e.id),e.attributes&&Object.keys(e.attributes).forEach((function(t){r.setAttribute(t,e.attributes[t])})),"function"==typeof t&&(r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,t())}:r.onload=function(){t()}),r.src="https:".concat(e.url).concat(e.file),e.query&&(r.src="".concat(r.src,"?").concat(e.query)),e.insertSelector?(i=R.document.querySelector(e.insertSelector))?i.appendChild(r):x.warn("[INIT]: Injection library ".concat(e.name,". Element with selector ").concat(e.insertSelector," not found")):null!=(n=(i=R.document.getElementsByTagName("script")[0]).parentNode)&&n.insertBefore(r,i)},D=((Tr=w=w||{}).Desktop="desktop",Tr.Tablet="tablet",Tr.Mobile="mobile",(Tr=T=T||{}).Chrome="chrome",Tr.Safari="safari",Tr.Opera="opera",Tr.Edge="edge",Tr.IE11="ie11",Tr.Firefox="firefox",Tr.Other="other",(Tr=_=_||{}).IOS="ios",Tr.MacOS="mac",Tr.Android="android",Tr.Windows="windows",Tr.Linux="linux",Tr.ChromeOs="chromeos",Tr.Other="other",[{regex:/\sedg\//i,browser:T.Edge},{regex:/edg([ea]|ios)/i,browser:T.Edge},{regex:/opera/i,browser:T.Opera},{regex:/opr\/|opios/i,browser:T.Opera},{regex:/chrome|crios|crmo/i,browser:T.Chrome},{regex:/firefox|iceweasel|fxios/i,browser:T.Firefox},{regex:/safari|applewebkit/i,browser:T.Safari}]),O=[{regex:/huawei/i,device:w.Mobile},{regex:/nexus\s*(?:7|8|9|10).*/i,device:w.Tablet},{regex:/ipad/i,device:w.Tablet},{regex:/tablet(?! pc)/i,device:w.Tablet},{regex:/(ipod|iphone)/i,device:w.Mobile},{regex:/nexus\s*[0-6].*/i,device:w.Mobile},{regex:/[^-]mobi/i,device:w.Mobile}],L=[{os:_.MacOS,regex:/macintosh/i},{os:_.IOS,regex:/(ipod|iphone|ipad)/i},{os:_.Android,regex:/android/i},{os:_.Windows,regex:/windows /i},{os:_.Linux,regex:/linux/i},{os:_.ChromeOs,regex:/CrOS/}],M=function(){function e(n){t(this,e),this.browserWindow=n,this.userAgent=n.navigator.userAgent,this.device=this.parseDevice(),this.browser=this.parseBrowser(),this.os=this.parseOperatingSystem()}return i(e,[{key:"parseDevice",value:function(){var e=this,t=O.filter((function(t){return t.regex.test(e.userAgent)}));return 0<t.length?t[0].device:null!=(t=this.browserWindow.navigator.userAgentData)&&t.mobile?w.Mobile:w.Desktop}},{key:"parseBrowser",value:function(){var e=this,t=D.filter((function(t){return t.regex.test(e.userAgent)}));return 0<t.length?t[0].browser:T.Other}},{key:"parseOperatingSystem",value:function(){var e=this,t=L.filter((function(t){return t.regex.test(e.userAgent)}));return 0<t.length?t[0].os:_.Other}},{key:"getDevice",value:function(){return this.device}},{key:"getBrowser",value:function(){return this.browser}},{key:"getOperatingSystem",value:function(){return this.os}}]),e}(),N=function(){function e(n,i){var o,s=this;t(this,e),this.fuseDob=n,this.states=[],this.events=[],this.slotProblems=[],this.firstSlotLoaded=!1,this.firstSlotRenderEnded=!1,this.firstImpressionViewed=!1,n=Date.now();this._tagLoadedMs=n-this.getFuseDob(),this.states.push((r(o={},"tag_loaded",!0),r(o,"ts",n),r(o,"load_time_ms",this._tagLoadedMs),o)),i.onSlotLoaded.subscribe((function(e){s.firstSlotLoaded||(s.setStateStatus("gpt_first_slot_loaded"),s.firstSlotLoaded=!0),s.addAdEvent("gpt_slot_loaded_".concat(e.slot.getSlotElementId()))})),i.onSlotResponse.subscribe((function(e){s.firstSlotRenderEnded||(s.setStateStatus("gpt_first_slot_render_ended"),s.firstSlotRenderEnded=!0),s.addAdEvent("gpt_slot_render_ended_".concat(e.slot.getSlotElementId()))})),i.onImpressionViewable.subscribe((function(e){s.firstImpressionViewed||(s.setStateStatus("gpt_first_impression_viewable"),s.firstImpressionViewed=!0),s.addAdEvent("gpt_impression_viewable_".concat(e.slot.getSlotElementId()))}))}return i(e,[{key:"getSlotProblems",value:function(){return this.slotProblems}},{key:"addSlotProblem",value:function(e){1e3<=this.slotProblems.length&&(this.slotProblems=this.slotProblems.slice(100)),this.slotProblems.push(Object.assign(Object.assign({},e),{time:this.getElapsedTime()}))}},{key:"getFuseDob",value:function(){return this.fuseDob}},{key:"getElapsedTime",value:function(){return(new Date).getTime()-this.getFuseDob()}},{key:"reportFirstGptRequest",value:function(){this._firstGptRequestMs=this.getElapsedTime()}},{key:"firstGptRequestMs",get:function(){return this._firstGptRequestMs}},{key:"reportCmpLoadFinish",value:function(){this._cmpLoadFinishMs=this._cmpLoadFinishMs||this.getElapsedTime()}},{key:"cmpLoadFinishMs",get:function(){return this._cmpLoadFinishMs}},{key:"cmpGdprCached",get:function(){return Boolean(this._cmpGdprElapsedMs&&this._cmpGdprElapsedMs<=10)}},{key:"reportCmpGdprDetermined",value:function(){this._cmpGdprElapsedMs=this._cmpGdprElapsedMs||this.getElapsedTime()-this.cmpLoadFinishMs}},{key:"cmpGdprElapsedMs",get:function(){return this._cmpGdprElapsedMs}},{key:"reportFirstZone",value:function(){this._firstZoneMs=this._firstZoneMs||this.getElapsedTime()}},{key:"firstZoneMs",get:function(){return this._firstZoneMs}},{key:"reportHbAuctionStart",value:function(){this._hbAuctionStartMs=this._hbAuctionStartMs||this.getElapsedTime()}},{key:"hbAuctionStartMs",get:function(){return this._hbAuctionStartMs}},{key:"tagLoadedMs",get:function(){return this._tagLoadedMs}},{key:"setStateStatus",value:function(e){var t,n=Date.now();this.states.push((r(t={},e,!0),r(t,"ts",n),r(t,"load_time_ms",n-this.getFuseDob()),t))}},{key:"addAdEvent",value:function(e,t){var n=Date.now();this.events.push(Object.assign(Object.assign({adEvent:e},t),{ts:n,event_time_ms:n-this.getFuseDob()}))}},{key:"getIsCmpPromptShown",value:function(){return Boolean(this.states.find((function(e){return e.cmp_prompt_shown})))}}]),e}();function B(e){var t;return 1e4<=e?"over_9999":(t=e<4e3?500:1e3,e=Math.floor(e/t)*t,"".concat(e,"-").concat(e+t-1))}function z(e,t){return{_tag:"loading",loadStart:e,deferredLoad:1<arguments.length&&void 0!==t&&t}}function F(e,t,n){return{_tag:"ready",loadStart:e.loadStart,loadFinish:t,loadElapsed:t-e.loadStart,deferredLoad:e.deferredLoad,output:n}}var G=function(){function e(n,i,r){t(this,e),this.onComponentInitEvent=n,this.logger=i,this.reporter=r,this._state={yandex:{_tag:"pending"},gpt:{_tag:"pending"},prebid:{_tag:"pending"},cmp:{_tag:"pending"},uam:{_tag:"pending"},docReadyScan:{_tag:"pending"}}}return i(e,[{key:"state",get:function(){return this._state}},{key:"updateState",value:function(e,t){this._state[e]=t,this.reporter.setStateStatus("component_init_".concat(e,"_").concat(t._tag)),"ready"===t._tag&&this.logger.log("[INIT]: Component ".concat(e," is ready")),this.onComponentInitEvent.emit({component:e,state:t})}}]),e}();function U(e){return"disabled"==e._tag||"ready"===e._tag&&e.output.allowPersonalisation}function W(e){return"ready"==e._tag?e.output.jurisdiction:"unknown"}function j(e){return e.split("x").map(Number)}function H(e){var t=[1,1];return e.forEach((function(e){e[0]>t[0]&&(t[0]=e[0]),e[1]>t[1]&&(t[1]=e[1])})),t}function V(e,t){return parseInt((100*(e/t-1)).toFixed())}var q,Z,Y,Q,J,K=function(e){return e[0]+"x"+e[1]},X=-1,$=function(e){addEventListener("pageshow",(function(t){t.persisted&&(X=t.timeStamp,e(t))}),!0)},ee=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},te=function(){var e=ee();return e&&e.activationStart||0},ne=function(e,t){var n=ee(),i="navigate";return 0<=X?i="back-forward-cache":n&&(document.prerendering||0<te()?i="prerender":document.wasDiscarded?i="restore":n.type&&(i=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},ie=function(e,t,n){try{var i;if(PerformanceObserver.supportedEntryTypes.includes(e))return(i=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}))).observe(Object.assign({type:e,buffered:!0},n||{})),i}catch(e){}},re=function(e,t,n,i){var r,o;return function(s){0<=t.value&&(s||i)&&((o=t.value-(r||0))||void 0===r)&&(r=t.value,t.delta=o,t.rating=(s=t.value)>n[1]?"poor":s>n[0]?"needs-improvement":"good",e(t))}},oe=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},se=function(e){function t(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||e(t)}addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},ae=function(e){var t=!1;return function(n){t||(e(n),t=!0)}},ue=-1,ce=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},le=function(e){"hidden"===document.visibilityState&&-1<ue&&(ue="visibilitychange"===e.type?e.timeStamp:0,ge())},de=function(){addEventListener("visibilitychange",le,!0),addEventListener("prerenderingchange",le,!0)},ge=function(){removeEventListener("visibilitychange",le,!0),removeEventListener("prerenderingchange",le,!0)},he=function(){return ue<0&&(ue=ce(),de(),$((function(){setTimeout((function(){ue=ce(),de()}),0)}))),{get firstHiddenTime(){return ue}}},fe=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},pe=[1800,3e3],ve=function(e,t){t=t||{},fe((function(){var n,i=he(),r=ne("FCP"),o=ie("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(o.disconnect(),e.startTime<i.firstHiddenTime)&&(r.value=Math.max(e.startTime-te(),0),r.entries.push(e),n(!0))}))}));o&&(n=re(e,r,pe,t.reportAllChanges),$((function(i){r=ne("FCP"),n=re(e,r,pe,t.reportAllChanges),oe((function(){r.value=performance.now()-i.timeStamp,n(!0)}))})))}))},be=[.1,.25],me={passive:!0,capture:!0},Se=new Date,ye=function(e,t){q||(q=t,Z=e,Y=new Date,Ce(removeEventListener),ke())},ke=function(){var e;0<=Z&&Z<Y-Se&&(e={entryType:"first-input",name:q.type,target:q.target,cancelable:q.cancelable,startTime:q.timeStamp,processingStart:q.timeStamp+Z},Q.forEach((function(t){t(e)})),Q=[])},Ie=function(e){var t,n,i,r;function o(){ye(n,i),r()}function s(){r()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,i=e,r=function(){removeEventListener("pointerup",o,me),removeEventListener("pointercancel",s,me)},addEventListener("pointerup",o,me),addEventListener("pointercancel",s,me)):ye(t,e))},Ce=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,Ie,me)}))},Ee=[100,300],we=0,Te=1/0,_e=0,Ae=function(e){e.forEach((function(e){e.interactionId&&(Te=Math.min(Te,e.interactionId),_e=Math.max(_e,e.interactionId),we=_e?(_e-Te)/7+1:0)}))},Re=function(){return J?we:performance.interactionCount||0},xe=function(){"interactionCount"in performance||(J=J||ie("event",Ae,{type:"event",buffered:!0,durationThreshold:0}))},Pe=[200,500],De=0,Oe=function(){return Re()-De},Le=[],Me={},Ne=function(e){var t=Le[Le.length-1],n=Me[e.interactionId];(n||Le.length<10||e.duration>t.latency)&&(n?(n.entries.push(e),n.latency=Math.max(n.latency,e.duration)):(t={id:e.interactionId,latency:e.duration,entries:[e]},Me[t.id]=t,Le.push(t)),Le.sort((function(e,t){return t.latency-e.latency})),Le.splice(10).forEach((function(e){delete Me[e.id]})))},Be=[2500,4e3],ze={},Fe=[800,1800],Ge=function e(t){document.prerendering?fe((function(){return e(t)})):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},Ue=function(e){var t,n,i;return e&&e.tagName&&e.classList?(t=e.tagName.toLowerCase(),n=e.id?" #".concat(e.id):"",i=0<e.classList.length?" .".concat(e.classList.value):"",e=(e=e.getAttribute("data-fuse"))?' [data-fuse="'.concat(e,'"]'):"","".concat(t).concat(n).concat(i).concat(e)):""},We=function(){function n(e,i,r,o,s,a,u,c,l){var d=this;t(this,n),this.componentState=e,this.deviceInfo=i,this.logger=r,this.browserWindow=o,this.sessionId=s,this.reporter=a,this.requestMethod=u,this.backgroundRequestTimeout=0,this.requestQueue=new Set,this.baseUrl=c.getFuseCDN(),this.fuseUuid=c.getFuseUUID(),this.fuseId=c.getFuseId(),this.publicationId=c.getPublicationId(),this.adServer=c.isYandexEnabled()?"yandex":"gpt",this.tenantId=c.getTenantCode(),c.getUseTelemetry()&&l.onSlotRequested.subscribe((function(e){var t=e.slot.getAdUnitPath();(e=c.getFuseSlots().filter((function(e){return e.slot===t}))[0])&&d.recordSlotRequest(e.id)}))}return i(n,[{key:"recordSlotRequest",value:function(e){var t="slot-request",n=this.makeUrl(t,{auid:e},this.getCmpData());this.logDetails(e,t),this.requestMethod(n)}},{key:"recordFuseLoad",value:function(e){this.requestMethod(this.makeUrl("fuse-load",{sdi:e}))}},{key:"recordRogueBidderResponse",value:function(e,t,n){this.requestMethod(this.makeUrl("rogue-bidder-response",{slotId:e,bidder:t.bidder,pbTrId:t.transactionId,pbReqId:t.requestId,pbAdId:t.adId,pbCrId:t.creativeId,pbSize:t.size,size:K(n),wDiff:V(t.width,n[0]),hDiff:V(t.height,n[1])},this.getCmpData()))}},{key:"recordRogueAdxResponse",value:function(e,t,n){var i=t.size;this.requestMethod(this.makeUrl("rogue-bidder-response",{slotId:e,bidder:"adx",pbAdId:null==(e=t.sourceAgnosticLineItemId)?void 0:e.toString(),pbCrId:null==(e=t.sourceAgnosticCreativeId)?void 0:e.toString(),pbSize:K(i),size:K(n),wDiff:V(i[0],n[0]),hDiff:V(i[1],n[1])},this.getCmpData()))}},{key:"prepareRecordingWebVitals",value:function(){var e,t,n,i,r,o=this;this.deviceInfo.getBrowser()!==T.Chrome?this.logInfo("[WEB-VITALS]: Disabled web vitals recording for non-chrome browser"):(e=function(e){"LCP"===e.name?null!=(n=e.entries[0])&&n.element&&(t=Ue(e.entries[0].element)):"CLS"===e.name&&(t=(n=e.entries.reduce((function(e,t){return!e||t.value>e.value?t:e}),void 0))?Ue(null==(n=n.sources[n.sources.length-1])?void 0:n.node):void 0);var t,n={name:e.name,value:"".concat(e.value),rating:e.rating,id:e.id,delta:"".concat(e.delta),element:t};o.logInfo("[WEB-VITALS]: ".concat(JSON.stringify(n))),o.queueBackgroundRequest("web-vitals",{cwvRep:[n]},o.getCmpData())},this.logInfo("[WEB-VITALS]: Set up web vitals callbacks"),function(e,t){t=t||{},ve(ae((function(){function n(e){e.forEach((function(e){var t,n;e.hadRecentInput||(t=s[0],n=s[s.length-1],o&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(o+=e.value,s.push(e)):(o=e.value,s=[e]))})),o>r.value&&(r.value=o,r.entries=s,i())}var i,r=ne("CLS",0),o=0,s=[],a=ie("layout-shift",n);a&&(i=re(e,r,be,t.reportAllChanges),se((function(){n(a.takeRecords()),i(!0)})),$((function(){r=ne("CLS",o=0),i=re(e,r,be,t.reportAllChanges),oe((function(){return i()}))})),setTimeout(i,0))})))}(e,{reportAllChanges:!0}),ve(e),function(e,t){t=t||{},fe((function(){function n(e){e.forEach(o)}var i=he(),r=ne("FID"),o=function(e){e.startTime<i.firstHiddenTime&&(r.value=e.processingStart-e.startTime,r.entries.push(e),a(!0))},s=ie("first-input",n),a=re(e,r,Ee,t.reportAllChanges);s&&se(ae((function(){n(s.takeRecords()),s.disconnect()}))),s&&$((function(){var n;r=ne("FID"),a=re(e,r,Ee,t.reportAllChanges),Q=[],Z=-1,q=null,Ce(addEventListener),n=o,Q.push(n),ke()}))}))}(e),function(e,t){t=t||{},fe((function(){function n(e){e.forEach((function(e){e.interactionId&&Ne(e),"first-input"!==e.entryType||Le.some((function(t){return t.entries.some((function(t){return e.duration===t.duration&&e.startTime===t.startTime}))}))||Ne(e)})),e=Math.min(Le.length-1,Math.floor(Oe()/50)),(e=Le[e])&&e.latency!==i.value&&(i.value=e.latency,i.entries=e.entries,o())}xe();var i=ne("INP"),r=ie("event",n,{durationThreshold:t.durationThreshold||40}),o=re(e,i,Pe,t.reportAllChanges);r&&(r.observe({type:"first-input",buffered:!0}),se((function(){n(r.takeRecords()),i.value<0&&0<Oe()&&(i.value=0,i.entries=[]),o(!0)})),$((function(){Le=[],De=Re(),i=ne("INP"),o=re(e,i,Pe,t.reportAllChanges)})))}))}(e),function(e,t){t=t||{},fe((function(){function n(e){(e=e[e.length-1])&&e.startTime<o.firstHiddenTime&&(s.value=Math.max(e.startTime-te(),0),s.entries=[e],i())}var i,r,o=he(),s=ne("LCP"),a=ie("largest-contentful-paint",n);a&&(i=re(e,s,Be,t.reportAllChanges),r=ae((function(){ze[s.id]||(n(a.takeRecords()),a.disconnect(),ze[s.id]=!0,i(!0))})),["keydown","click"].forEach((function(e){addEventListener(e,r,!0)})),se(r),$((function(n){s=ne("LCP"),i=re(e,s,Be,t.reportAllChanges),oe((function(){s.value=performance.now()-n.timeStamp,ze[s.id]=!0,i(!0)}))})))}))}(e,{reportAllChanges:!0}),t=e,n=n||{},i=ne("TTFB"),r=re(t,i,Fe,n.reportAllChanges),Ge((function(){var e,o=ee();!o||(e=o.responseStart)<=0||e>performance.now()||(i.value=Math.max(e-te(),0),i.entries=[o],r(!0),$((function(){i=ne("TTFB",0),(r=re(t,i,Fe,n.reportAllChanges))(!0)})))})))}},{key:"prepareBackgroundRequestProcessor",value:function(){var e=this;this.browserWindow.addEventListener("visibilitychange",(function(){"hidden"===e.browserWindow.document.visibilityState&&e.flushQueue()}))}},{key:"logInfo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info("".concat(t.map((function(e){return JSON.stringify(e)}))))}},{key:"flushQueue",value:function(){var e;if(0<this.requestQueue.size){this.logInfo("Flushing request queue");var t,n,i=[],r=function(e,t){var n,i,r,o,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return i=!(n=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return n=e.done,e},e:function(e){i=!0,r=e},f:function(){try{n||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(e)||(s=d(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.requestQueue);try{for(r.s();!(n=r.n()).done;){var o=n.value;"web-vitals"===o.eventType&&null!=(e=o.record)&&e.cwvRep?(i.push.apply(i,l(o.record.cwvRep)),o.cmpData&&(t=o.cmpData)):this.requestMethod(this.makeUrl(o.eventType,o.record,o.cmpData))}}catch(e){r.e(e)}finally{r.f()}if(i.length)for(;i.length;)this.requestMethod(this.makeUrl("web-vitals",{cwvRep:i.splice(0,10)},t));this.requestQueue.clear()}}},{key:"makeUrl",value:function(e,t,n){var i=n&&!["none","unknown"].includes(n.jurisdiction)&&null!=n&&n.personalisation?"consent":"noconsent";t=this.buildQueryParameters(Object.assign(Object.assign(Object.assign({},t),{cmpj:null==n?void 0:n.jurisdiction,cmpdialog:null==n?void 0:n.dialogShown}),this.getCommonMetadata(e))),n="https:".concat(this.baseUrl);return"https://".concat(this.getHostName(n),"/telemetry/").concat(i).concat(t)}},{key:"queueBackgroundRequest",value:function(e,t,n){var i=this;this.requestQueue.add({eventType:e,record:t,cmpData:n}),clearTimeout(this.backgroundRequestTimeout),this.backgroundRequestTimeout=setTimeout((function(){i.flushQueue()}),5e3)}},{key:"logDetails",value:function(e,t){this.logger.debug("[STATS]: Record ".concat(t," event for fuse ").concat(this.fuseId,", ad ").concat(e," on device ").concat(this.deviceInfo.getDevice()," and browser ").concat(this.deviceInfo.getBrowser()))}},{key:"buildQueryParameters",value:function(t){return Object.entries(t).reduce((function(t,n){var i=(n=c(n,2))[0];return(n=n[1])?("object"===e(n)&&(n=JSON.stringify(n)),"".concat(t?t+"&":"?").concat(encodeURIComponent(i),"=").concat(encodeURIComponent(n))):t}),"")}},{key:"getCommonMetadata",value:function(e){var t=(n=[this.browserWindow.location.href,this.getReferrer()])[0],n=n[1];return{v:"1",ttm:Date.now(),cookie:this.browserWindow.navigator.cookieEnabled,res:"".concat(screen.width,"x").concat(screen.height),device:this.deviceInfo.getDevice(),browser:this.deviceInfo.getBrowser(),fuuid:this.fuseUuid,fid:this.fuseId,pubid:this.publicationId,url:this.purify(t),refr:this.purify(n),sid:this.sessionId,srate:100,adserver:this.adServer,etm:this.reporter.getElapsedTime(),e:e,tenant:this.tenantId,sd:this.browserWindow.scrollY}}},{key:"getCmpData",value:function(){var e=this.componentState.state.cmp;return{jurisdiction:W(e),personalisation:U(e),dialogShown:this.reporter.getIsCmpPromptShown()}}},{key:"getHostName",value:function(e){var t=/^(?:(?:https?|ftp):)\/*(?:[^@]+@)?([^:/#]+)/.exec(e);return t?t[1]:e}},{key:"getParameter",value:function(e,t){return(e=/^(?:https?|ftp)(?::\/*(?:[^?]+))([?][^#]+)/.exec(e))&&1<(null==e?void 0:e.length)?this.fromQuerystring(t,e[1]):null}},{key:"fromQuerystring",value:function(e,t){return(e=new RegExp("^[^#]*[?&]"+e+"=([^&#]*)").exec(t))?decodeURIComponent(e[1].replace(/\+/g," ")):null}},{key:"getReferrer",value:function(e){var t=this.fromQuerystring("referrer",this.browserWindow.location.href)||this.fromQuerystring("referer",this.browserWindow.location.href);if(t)return t;if(e)return e;try{if(this.browserWindow.top)return this.browserWindow.top.document.referrer;if(this.browserWindow.parent)return this.browserWindow.parent.document.referrer}catch(e){}return this.browserWindow.document.referrer}},{key:"purify",value:function(e){return e.replace(/#.*/,"").replace(/[{}]/g,"")}}]),n}(),je=function(){function e(n){t(this,e),this.initialiser=n,this._field=null}return i(e,[{key:"field",get:function(){var e;return null!=(e=this._field)?e:this._field=this.initialiser()}}]),e}();function He(e){return function(){return new je(e).field}}function Ve(e){var t=ut(e);if(!b(t)&&""!==t){if("true"===t||"false"===t)return"true"===t;var n=parseInt(t,10);if(Number.isInteger(n))return n;nt.info("[SETTINGS] Could not parse ".concat(e," with value: ").concat(t," as a number"))}}var qe=function(){function e(n,i){t(this,e),this.logger=n,this.eventName=i,this.subscribers=[],this.lastEmitted=null,this.wrapped=[]}return i(e,[{key:"subscribe",value:function(e){this.subscribers.push(e)}},{key:"_unsubscribe",value:function(e){return 0<=(e=this.subscribers.indexOf(e))&&(this.subscribers.splice(e,1),!0)}},{key:"unsubscribe",value:function(e){var t=this.findWrapper(e);return t?this._unsubscribe(t):this._unsubscribe(e)}},{key:"findWrapper",value:function(e){var t;return null==(t=this.wrapped.filter((function(t){return t.subscriber===e})).shift())?void 0:t.wrapper}},{key:"once",value:function(e){function t(i){e(i),n.unsubscribe(t)}var n=this;this.subscribe(t),this.wrapped.push({wrapper:t,subscriber:e})}},{key:"immediateOrOnce",value:function(e){return S(this.lastEmitted)?(this.logger.debug("[EVENT][".concat(this.eventName,"]: Already triggered, invoking callback synchronously")),e(this.lastEmitted),!0):(this.once(e),!1)}},{key:"emit",value:function(e){var t=this,n=this.subscribers.length;0<n?this.logger.debug("[EVENT][".concat(this.eventName,"]: Fired, start processing ").concat(n," callbacks")):this.logger.debug("[EVENT][".concat(this.eventName,"]: Fired, no pending callbacks")),this.lastEmitted=e,this.subscribers.map((function(e){return e})).forEach((function(n){try{n(e)}catch(n){n instanceof Error?t.logger.error("[EVENT][".concat(t.eventName,"]: Caught exception in callback with item ").concat(e),n.message,n.stack):t.logger.error("[EVENT][".concat(t.eventName,"]: Caught exception of invalid type in callback with item ").concat(e))}}))}},{key:"getSubscriberCount",value:function(){return this.subscribers.length}}]),e}(),Ze=function(){function e(n,i,r,o){var s=this;t(this,e),this.logger=n,this.eventName=i,this.source=r,this.filter=o,this.delegate=new qe(n,i),r.subscribe((function(e){S(e=s.filter(e))&&s.delegate.emit(e)}))}return i(e,[{key:"subscribe",value:function(e){this.delegate.subscribe(e)}},{key:"unsubscribe",value:function(e){this.delegate.unsubscribe(e)}},{key:"once",value:function(e){this.delegate.once(e)}},{key:"immediateOrOnce",value:function(e){return this.delegate.immediateOrOnce(e)}}]),e}(),Ye=new(function(){function e(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};t(this,e),this.logger=n,this.addDebugProxy=i,this.emitters={},this.observables={}}return i(e,[{key:"onTagInitComplete",get:function(){return this.getEmitter("onTagInitComplete")}},{key:"pageInitObservable",get:function(){return this.onPageInit}},{key:"onPageInit",get:function(){return this.getEmitter("onPageInit")}},{key:"onPageReset",get:function(){return this.getEmitter("onPageReset")}},{key:"onZoneEvent",get:function(){return this.getEmitter("onZoneEvent")}},{key:"onAuctionEvent",get:function(){return this.getEmitter("onAuctionEvent")}},{key:"onZoneRegistered",get:function(){return this.getFiltered("register_zone",this.onZoneEvent,(function(e){return"registered"==e.zoneEventType?e:null}))}},{key:"onZoneActivateApi",get:function(){return this.getFiltered("activate_zone_api",this.onZoneEvent,(function(e){return"activate_zone_api"==e.zoneEventType?e:null}))}},{key:"activateZoneCalledObservable",get:function(){return this.onZoneActivateApi}},{key:"onComponentInitEvent",get:function(){return this.getEmitter("onComponentInitEvent")}},{key:"onInitManagerReady",get:function(){return this.getEmitter("onInitManagerReady")}},{key:"onWindowResized",get:function(){return this.getEmitter("onWindowResized")}},{key:"onSlotLoaded",get:function(){return this.getEmitter("onSlotLoaded")}},{key:"onSlotRender",get:function(){return this.getEmitter("onSlotRender")}},{key:"onSlotResponse",get:function(){return this.getEmitter("onSlotResponse")}},{key:"onSlotRequested",get:function(){return this.getEmitter("onSlotRequested")}},{key:"onImpressionViewable",get:function(){return this.getEmitter("onImpressionViewable")}},{key:"onBreakpointChanged",get:function(){return this.getFiltered("onBreakpointChanged",this.onWindowResized,(function(e){return e.crossedBp?e:null}))}},{key:"getEmitter",value:function(e){var t,n=new qe(this.logger(),e),i=(i=this.addDebugProxy())?i(n):n;return null!=(t=(n=this.emitters)[e])?t:n[e]=i}},{key:"getFiltered",value:function(e,t,n){var i,r;return null!=(i=(r=this.observables)[e])?i:r[e]=new Ze(this.logger(),e,t,n)}}]),e}())(He((function(){return I.getLogger()})),He((function(){var e;return null==(e=I.getFuseDebugger())?void 0:e.fuseEventEmitterWrapper()}))),Qe=function(){function e(n){t(this,e),this.options={capture:!0,passive:!0},this.window=n.api.viewportInfo.browserWindow,this.triggeredCB=n.onTriggeredCB,this.window.addEventListener("scroll",this.triggeredCB,this.options)}return i(e,[{key:"destroy",value:function(){this.window.removeEventListener("scroll",this.triggeredCB,this.options)}}]),e}(),Je="InView",Ke=function(){function e(n){t(this,e),this.params=n,this.name=Je}return i(e,[{key:"buildTriggers",value:function(e){return[new Qe(e)]}},{key:"check",value:function(e,t){return!!(e=t.slotRegistry.getSlot(e))&&(t=t.viewportInfo.getCurrentBreakpoint().name,!(!b(t=this.params[t])&&!1!==t)||e.isInView(t))}}]),e}(),Xe=function(){function e(n,i,r){function o(e){r(e)&&n.onTriggeredCB()}t(this,e),this.unsubscribe=function(){return i.unsubscribe(o)},i.subscribe(o)}return i(e,[{key:"destroy",value:function(){this.unsubscribe()}}]),e}(),$e=function(){o(n,Xe);var e=u(n);function n(i){t(this,n);var r=i.api.slotRegistry.getSlot(i.id).zoneInstanceId,o=i.api.events.onZoneActivateApi;return e.call(this,i,o,(function(e){return e.instanceId===r}))}return i(n)}(),et="ManualActivate",tt=function(){function e(){t(this,e),this.name=et}return i(e,[{key:"buildTriggers",value:function(e){return[new $e(e)]}},{key:"check",value:function(e,t){return S(e=null==(e=t.slotRegistry.getSlot(e))?void 0:e.zoneInstanceId)&&t.zoneRegistry.isManuallyActivated(e)}}]),e}(),nt=I.getLogger(),it=function(){return st("fuseDelayQuantcastInit")},rt=function(){return st("fuseDelayGptInit")},ot=function(){return st("fuseDelayUamInit")},st=function(e){var t=I.getQueryParam(e)[1];if(t){var n=parseInt(t);if(Number.isInteger(n))return n;nt.info("[SETTINGS]: Could not parse ".concat(e," with value ").concat(t," as a number"))}return null},at=function(e){var t,n=I.getQueryParam(e)[1];return b(n)?null:(b(t=/^(false|true|1|0)$/i.test(n)?Boolean(/^(true|1)$/i.test(n)):null)&&nt.info("[SETTINGS] Could not parse ".concat(e," with value: ").concat(n," as a boolean")),t)},ut=function(e){return I.getQueryParam(e)[1]||""},ct={fuse_blocked_url:[],fuse_breakpoints:{l:1336,m:970,s:728,xl:1640,xs:0},fuse_cdn:"//cdn.fuseplatform.net/publift/tags/",fuse_id:3354,fuse_industry:["IAB9"],fuse_settings:{adblock:!1,amazonUam:{enabled:!0,pubID:"8b48e249-e9e6-4a52-8b48-396ea93403e8"},blockthrough:!0,cmp:"script",cmpProvider:{partner:"quantcast"},confiant:!1,disableAutoLoadSlots:!1,disableGdprPersonalisation:!1,enableAutoRegistration:!1,enableMiniScrollers:!1,fuse_test_urls:[],headerbidding:1e3,id5:{enabled:!1},identity:{enabled:!1},in2wInjection:5,inskinWidth:1200,networkCode:"71161633",onLoadCallback:"",prebid:{analytics:[],breakpoint_options:{l:{enabled:!0,timeout:1e3},m:{enabled:!0,timeout:1e3},s:{enabled:!0,timeout:1e3},xl:{enabled:!0,timeout:1e3},xs:{enabled:!0,timeout:1e3}},defaultTimeout:1e3,enabled:!0,sendAllBids:!1},quickstart:!1,responsive:!0,strict_cmp:!1,telemetry:"default",topStickyHeaderSelector:"",useBidCache:5,useDomObserver:!1,useGptPreAuctionModule:5,useId5:5,useIndustry:5,videoSettings:{enabled:!1},yandex:!1,yandexBlockId:""},fuse_slots:[{activateConditionConfig:{type:"none"},attributes:{adblock:!1,dynamic:!1,headerbidding:!0,interscroller:!1,interstitial:!1,miniscroller:!1,refresh:30,scrollToStick:!1,sticky:!1},bids:[{bidSizes:["300x100","300x50","320x100","320x50","468x60","728x90","970x90"],bidder:"amx",params:{tagId:"cHVibGlmdC5jb20"}},{bidSizes:[],bidder:"appnexus",params:{placementId:"31187423"}},{bidSizes:["300x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78HW2679S11FRCPJ40_1486317_300x50",zoneId:1486317}},{bidSizes:["300x100"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78HW2679S11FRCPJ40_1486318_300x100",zoneId:1486318}},{bidSizes:["320x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78HW2679S11FRCPJ40_1486319_320x50",zoneId:1486319}},{bidSizes:["320x100"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78HW2679S11FRCPJ40_1486320_320x100",zoneId:1486320}},{bidSizes:["728x90"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78HW2679S11FRCPJ40_1486324_728x90",zoneId:1486324}},{bidSizes:["970x90"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78HW2679S11FRCPJ40_1486325_970x90",zoneId:1486325}},{bidSizes:["320x50"],bidder:"gumgum",params:{inSlot:1037684}},{bidSizes:["468x60"],bidder:"gumgum",params:{inSlot:1037685}},{bidSizes:["728x90"],bidder:"gumgum",params:{inSlot:1037686}},{bidSizes:["970x90"],bidder:"gumgum",params:{inSlot:1037688}},{bidSizes:["1200x90","300x100","300x50","320x100","320x50","468x60","728x90","970x90"],bidder:"pubmatic",params:{adSlot:"71161633/CHRCTRCALC_charactercalculator/charactercalulator_header",publisherId:"156762"}},{bidSizes:["300x100","300x50","320x100","320x50","468x60","728x90","970x90"],bidder:"smartadserver",params:{domain:"https://prg-apac.smartadserver.com",formatId:116284,pageId:1720333,siteId:566977}},{bidSizes:["1200x90","300x100","300x50","320x100","320x50","468x60","728x90","970x90"],bidder:"triplelift",params:{inventoryCode:"Charactercalculator_StandardDisplay"}}],id:"22996239460",sizeMapping:{l:[[468,60],[728,90],[970,90],[1200,90]],m:[[468,60],[728,90],[970,90]],s:[[300,100],[320,100],[468,60],[728,90]],xl:[[468,60],[728,90],[970,90],[1200,90]],xs:[[300,50],[300,100],[320,50],[320,100]]},sizes:[[300,50],[300,100],[320,50],[320,100],[468,60],[728,90],[970,90],[1200,90]],slot:"/71161633,22579868039/CHRCTRCALC_charactercalculator/charactercalulator_header"},{activateConditionConfig:{type:"none"},attributes:{adblock:!1,dynamic:!1,headerbidding:!0,interscroller:!1,interstitial:!1,miniscroller:!1,refresh:30,scrollToStick:!1,sticky:!1},bids:[{bidSizes:["300x100","300x250","300x50","320x100","320x50","336x280"],bidder:"amx",params:{tagId:"cHVibGlmdC5jb20"}},{bidSizes:[],bidder:"appnexus",params:{placementId:"31187426"}},{bidSizes:["300x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E792GWAND9QQ9MV0FRM_1486317_300x50",zoneId:1486317}},{bidSizes:["300x100"],bidder:"criteo",params:{publisherSubId:"01HB5D5E792GWAND9QQ9MV0FRM_1486318_300x100",zoneId:1486318}},{bidSizes:["320x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E792GWAND9QQ9MV0FRM_1486319_320x50",zoneId:1486319}},{bidSizes:["320x100"],bidder:"criteo",params:{publisherSubId:"01HB5D5E792GWAND9QQ9MV0FRM_1486320_320x100",zoneId:1486320}},{bidSizes:["300x250"],bidder:"criteo",params:{publisherSubId:"01HB5D5E792GWAND9QQ9MV0FRM_1486321_300x250",zoneId:1486321}},{bidSizes:["336x280"],bidder:"criteo",params:{publisherSubId:"01HB5D5E792GWAND9QQ9MV0FRM_1486323_336x280",zoneId:1486323}},{bidSizes:["300x250"],bidder:"gumgum",params:{inSlot:1037682}},{bidSizes:["320x50"],bidder:"gumgum",params:{inSlot:1037684}},{bidSizes:["300x100","300x250","300x50","320x100","320x50","336x280"],bidder:"pubmatic",params:{adSlot:"71161633/CHRCTRCALC_charactercalculator/charactercalulator_incontent_2",publisherId:"156762"}},{bidSizes:["300x100","300x250","300x50","320x100","320x50","336x280"],bidder:"smartadserver",params:{domain:"https://prg-apac.smartadserver.com",formatId:116284,pageId:1720333,siteId:566977}},{bidSizes:["300x100","300x250","300x50","320x100","320x50","336x280"],bidder:"triplelift",params:{inventoryCode:"Charactercalculator_StandardDisplay"}}],id:"22996239463",sizeMapping:{l:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]],m:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]],s:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]],xl:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]],xs:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]]},sizes:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]],slot:"/71161633,22579868039/CHRCTRCALC_charactercalculator/charactercalulator_incontent_2"},{activateConditionConfig:{type:"none"},attributes:{adblock:!1,dynamic:!1,headerbidding:!0,interscroller:!1,interstitial:!1,miniscroller:!1,refresh:30,scrollToStick:!1,sticky:!1},bids:[{bidSizes:["300x100","300x250","300x50","320x100","320x50","336x280","468x60","728x250","728x90"],bidder:"amx",params:{tagId:"cHVibGlmdC5jb20"}},{bidSizes:[],bidder:"appnexus",params:{placementId:"31187424"}},{bidSizes:["300x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78P70FV69F8MGTWNX2_1486317_300x50",zoneId:1486317}},{bidSizes:["300x100"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78P70FV69F8MGTWNX2_1486318_300x100",zoneId:1486318}},{bidSizes:["320x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78P70FV69F8MGTWNX2_1486319_320x50",zoneId:1486319}},{bidSizes:["320x100"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78P70FV69F8MGTWNX2_1486320_320x100",zoneId:1486320}},{bidSizes:["300x250"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78P70FV69F8MGTWNX2_1486321_300x250",zoneId:1486321}},{bidSizes:["336x280"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78P70FV69F8MGTWNX2_1486323_336x280",zoneId:1486323}},{bidSizes:["728x90"],bidder:"criteo",params:{publisherSubId:"01HB5D5E78P70FV69F8MGTWNX2_1486324_728x90",zoneId:1486324}},{bidSizes:["300x250"],bidder:"gumgum",params:{inSlot:1037682}},{bidSizes:["320x50"],bidder:"gumgum",params:{inSlot:1037684}},{bidSizes:["468x60"],bidder:"gumgum",params:{inSlot:1037685}},{bidSizes:["728x90"],bidder:"gumgum",params:{inSlot:1037686}},{bidSizes:["300x100","300x250","300x50","320x100","320x50","336x280","468x60","728x250","728x90"],bidder:"pubmatic",params:{adSlot:"71161633/CHRCTRCALC_charactercalculator/charactercalulator_incontent_1",publisherId:"156762"}},{bidSizes:["300x100","300x250","300x50","320x100","320x50","336x280","468x60","728x250","728x90"],bidder:"smartadserver",params:{domain:"https://prg-apac.smartadserver.com",formatId:116284,pageId:1720333,siteId:566977}},{bidSizes:["300x100","300x250","300x50","320x100","320x50","336x280","468x60","728x250","728x90"],bidder:"triplelift",params:{inventoryCode:"Charactercalculator_StandardDisplay"}}],id:"22996895243",sizeMapping:{l:[[300,50],[320,50],[468,60],[728,90],[728,250]],m:[[468,60],[728,90],[728,250]],s:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]],xl:[[300,50],[320,50],[468,60],[728,90],[728,250]],xs:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]]},sizes:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280],[468,60],[728,90],[728,250]],slot:"/71161633,22579868039/CHRCTRCALC_charactercalculator/charactercalulator_incontent_1"},{activateConditionConfig:{type:"none"},attributes:{adblock:!1,dynamic:!1,headerbidding:!0,interscroller:!1,interstitial:!1,miniscroller:!1,refresh:30,scrollToStick:!1,sticky:!1},bids:[{bidSizes:["200x200","250x250","300x100","300x250","300x50","320x100","320x250","320x50","336x280","468x60","728x250","728x90","970x250","970x90"],bidder:"amx",params:{tagId:"cHVibGlmdC5jb20"}},{bidSizes:[],bidder:"appnexus",params:{placementId:"31187427"}},{bidSizes:["300x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486317_300x50",zoneId:1486317}},{bidSizes:["300x100"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486318_300x100",zoneId:1486318}},{bidSizes:["320x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486319_320x50",zoneId:1486319}},{bidSizes:["320x100"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486320_320x100",zoneId:1486320}},{bidSizes:["300x250"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486321_300x250",zoneId:1486321}},{bidSizes:["336x280"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486323_336x280",zoneId:1486323}},{bidSizes:["728x90"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486324_728x90",zoneId:1486324}},{bidSizes:["970x90"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486325_970x90",zoneId:1486325}},{bidSizes:["970x250"],bidder:"criteo",params:{publisherSubId:"01HB5D5E79KK910C35YZXRD1DG_1486326_970x250",zoneId:1486326}},{bidSizes:["300x250"],bidder:"gumgum",params:{inSlot:1037682}},{bidSizes:["320x50"],bidder:"gumgum",params:{inSlot:1037684}},{bidSizes:["468x60"],bidder:"gumgum",params:{inSlot:1037685}},{bidSizes:["728x90"],bidder:"gumgum",params:{inSlot:1037686}},{bidSizes:["970x250"],bidder:"gumgum",params:{inSlot:1037687}},{bidSizes:["970x90"],bidder:"gumgum",params:{inSlot:1037688}},{bidSizes:["200x200","250x250","300x100","300x250","300x50","320x100","320x250","320x50","336x280","468x60","728x250","728x90","970x250","970x90"],bidder:"pubmatic",params:{adSlot:"71161633/CHRCTRCALC_charactercalculator/charactercalulator_incontent_3",publisherId:"156762"}},{bidSizes:["200x200","250x250","300x100","300x250","300x50","320x100","320x250","320x50","336x280","468x60","728x250","728x90","970x250","970x90"],bidder:"smartadserver",params:{domain:"https://prg-apac.smartadserver.com",formatId:116284,pageId:1720333,siteId:566977}},{bidSizes:["200x200","250x250","300x100","300x250","300x50","320x100","320x250","320x50","336x280","468x60","728x250","728x90","970x250","970x90"],bidder:"triplelift",params:{inventoryCode:"Charactercalculator_StandardDisplay"}}],dynamicAttributes:{each:0,incrementEach:0,position:"in",repeatHeight:1e3,skip:0},id:"22996895246",interscrollerAttributes:{showBanner:!1,zIndex:0},mediaTypes:[],sizeMapping:{l:[[300,250],[468,60],[728,90],[728,250],[970,90],[970,250]],m:[[200,200],[250,250],[300,50],[300,100],[300,250],[320,50],[320,100],[320,250],[468,60],[728,90],[728,250],[970,90],[970,250]],s:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]],xl:[[300,250],[468,60],[728,90],[728,250],[970,90],[970,250]],xs:[[300,50],[300,100],[300,250],[320,50],[320,100],[336,280]]},sizes:[[200,200],[250,250],[300,50],[300,100],[300,250],[320,50],[320,100],[320,250],[336,280],[468,60],[728,90],[728,250],[970,90],[970,250]],slot:"/71161633,22579868039/CHRCTRCALC_charactercalculator/charactercalulator_incontent_3",stickyAttributes:{allowClose:!0,allowReopen:!0,bgOpacity:0,compact:!1,isButtonOutside:!0,isHideForever:!1,isTop:!1,scrollCreative:!1}},{activateConditionConfig:{type:"none"},attributes:{adblock:!1,dynamic:!1,headerbidding:!0,interscroller:!1,interstitial:!1,miniscroller:!1,refresh:30,scrollToStick:!1,sticky:!0},bids:[{bidSizes:["300x50","320x50","468x60","728x90","970x90"],bidder:"amx",params:{tagId:"cHVibGlmdC5jb20"}},{bidSizes:[],bidder:"appnexus",params:{placementId:"31187425"}},{bidSizes:["300x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E7929FZ5F6W8XKNRD2G_1486317_300x50",zoneId:1486317}},{bidSizes:["320x50"],bidder:"criteo",params:{publisherSubId:"01HB5D5E7929FZ5F6W8XKNRD2G_1486319_320x50",zoneId:1486319}},{bidSizes:["728x90"],bidder:"criteo",params:{publisherSubId:"01HB5D5E7929FZ5F6W8XKNRD2G_1486324_728x90",zoneId:1486324}},{bidSizes:["970x90"],bidder:"criteo",params:{publisherSubId:"01HB5D5E7929FZ5F6W8XKNRD2G_1486325_970x90",zoneId:1486325}},{bidSizes:["320x50"],bidder:"gumgum",params:{inSlot:1037684}},{bidSizes:["468x60"],bidder:"gumgum",params:{inSlot:1037685}},{bidSizes:["728x90"],bidder:"gumgum",params:{inSlot:1037686}},{bidSizes:["970x90"],bidder:"gumgum",params:{inSlot:1037688}},{bidSizes:["1200x90","300x50","320x50","468x60","728x90","970x90"],bidder:"pubmatic",params:{adSlot:"71161633/CHRCTRCALC_charactercalculator/sticky_footer",publisherId:"156762"}},{bidSizes:["300x50","320x50","468x60","728x90","970x90"],bidder:"smartadserver",params:{domain:"https://prg-apac.smartadserver.com",formatId:116284,pageId:1720333,siteId:566977}},{bidSizes:["1200x90","300x50","320x50","468x60","728x90","970x90"],bidder:"triplelift",params:{inventoryCode:"Charactercalculator_StandardDisplay"}}],dynamicAttributes:{each:0,incrementEach:0,position:"in",repeatHeight:1e3,skip:0},id:"22996895249",injectConditionConfig:{name:"UrlRegex",params:{regex:"https://charactercalculator.com/privacy/[^\\?]"},type:"condition"},interscrollerAttributes:{showBanner:!1,zIndex:0},mediaTypes:[],sizeMapping:{l:[[468,60],[728,90],[970,90],[1200,90]],m:[[468,60],[728,90],[970,90]],s:[[300,50],[320,50],[468,60],[728,90]],xl:[[468,60],[728,90],[970,90],[1200,90]],xs:[[300,50],[320,50]]},sizes:[[300,50],[320,50],[468,60],[728,90],[970,90],[1200,90]],slot:"/71161633,22579868039/CHRCTRCALC_charactercalculator/sticky_footer",stickyAttributes:{allowClose:!0,allowReopen:!0,bgColor:"#191e24",bgOpacity:0,compact:!1,isButtonOutside:!0,isHideForever:!1,isTop:!1,scrollCreative:!1}},{activateConditionConfig:{type:"none"},attributes:{adblock:!1,dynamic:!1,headerbidding:!0,interscroller:!1,interstitial:!1,miniscroller:!1,refresh:30,scrollToStick:!1,sticky:!1},bids:[{bidSizes:[],bidder:"appnexus",params:{placementId:"31187428"}},{bidSizes:["160x600"],bidder:"gumgum",params:{inSlot:1037681}},{bidSizes:["300x600"],bidder:"gumgum",params:{inSlot:1037683}},{bidSizes:["120x600","160x600","300x600"],bidder:"pubmatic",params:{adSlot:"71161633/CHRCTRCALC_charactercalculator/charactercalulator_vrec_lhs",publisherId:"156762"}},{bidSizes:["120x600","160x600","300x600"],bidder:"triplelift",params:{inventoryCode:"Charactercalculator_StandardDisplay"}}],id:"22998224700",sizeMapping:{l:[[120,600],[160,600]],m:[],s:[],xl:[[120,600],[160,600],[300,600]],xs:[]},sizes:[[120,600],[160,600],[300,600]],slot:"/71161633,22579868039/CHRCTRCALC_charactercalculator/charactercalulator_vrec_lhs"},{activateConditionConfig:{type:"none"},attributes:{adblock:!1,dynamic:!1,headerbidding:!0,interscroller:!1,interstitial:!1,miniscroller:!1,refresh:30,scrollToStick:!1,sticky:!1},bids:[{bidSizes:[],bidder:"appnexus",params:{placementId:"31187429"}},{bidSizes:["160x600"],bidder:"gumgum",params:{inSlot:1037681}},{bidSizes:["300x600"],bidder:"gumgum",params:{inSlot:1037683}},{bidSizes:["120x600","160x600","300x600"],bidder:"pubmatic",params:{adSlot:"71161633/CHRCTRCALC_charactercalculator/charactercalulator_vrec_rhs",publisherId:"156762"}},{bidSizes:["120x600","160x600","300x600"],bidder:"triplelift",params:{inventoryCode:"Charactercalculator_StandardDisplay"}}],id:"22998224703",sizeMapping:{l:[[120,600],[160,600]],m:[],s:[],xl:[[120,600],[160,600],[300,600]],xs:[]},sizes:[[120,600],[160,600],[300,600]],slot:"/71161633,22579868039/CHRCTRCALC_charactercalculator/charactercalulator_vrec_rhs"}],fuse_tenant:"publift",fuse_uuid:"92d98b77-97d2-50de-99e7-ff798f699ab0",sco:{asi:"publift.com",sellerId:"01HANKG6AD7PKFMKF5D3AXXYZN"},supported_sizes:{l:[[120,600],[160,600],[300,50],[300,100],[300,250],[320,50],[320,100],[320,480],[336,280],[468,60],[728,90],[728,250],[970,90],[970,250],[1200,90]],m:[[200,200],[250,250],[300,50],[300,100],[300,250],[320,50],[320,100],[320,250],[320,480],[336,280],[468,60],[728,90],[728,250],[970,90],[970,250]],s:[[300,50],[300,100],[300,250],[320,50],[320,100],[320,480],[336,280],[468,60],[728,90]],xl:[[120,600],[160,600],[300,50],[300,100],[300,250],[300,600],[320,50],[320,100],[336,280],[468,60],[728,90],[728,250],[970,90],[970,250],[1200,90]],xs:[[300,50],[300,100],[300,250],[320,50],[320,100],[320,480],[336,280]]},tenantId:"DGKSPXNV53",fuse_flavour:"default",publication_metadata:{publication_id:8,generation_version:"4.129741.0",generation_time:"2023-10-19T07:35:57.580Z",revision:"v5"},fuse_prebid_hash:"98b2afee969908da46de5e9ccfc90936"},lt=new(function(){function e(n){t(this,e),this.myWindow=n}return i(e,[{key:"isDevelopmentMode",value:function(){return 0==ct.publication_metadata.publication_id}},{key:"getAccountSettings",value:function(){var e=this.myWindow.field;return this.isDevelopmentMode()&&e.fuseConfig?e.fuseConfig:ct}},{key:"getBreakpoints",value:function(){var e={},t=this.getAccountSettings();return t.fuse_breakpoints.xl&&(e.xl=t.fuse_breakpoints.xl),t.fuse_breakpoints.l&&(e.l=t.fuse_breakpoints.l),e.m=t.fuse_breakpoints.m,e.s=t.fuse_breakpoints.s,e.xs=t.fuse_breakpoints.xs,e}},{key:"isUseBrowserOuterwidth",value:function(){var e;return null!=(e=null!=(e=at("fuseUseBrowserOuterwidth"))?e:this.getAccountSettings().fuse_settings.isUseBrowserOuterwidth)&&e}}]),e}())(new je((function(){return I.getBrowserWindowObject()}))),dt=function(){function e(n,i){var r,o=this;t(this,e),this.layer=n,this.logger=i,this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.lastClickTime=0,this.cancelNextClick=!1,this.touchBoundary=10,this.tapDelay=200,this.tapTimeout=700,n.addEventListener("click",(function(e){return o.onClick(e)}),!0),n.addEventListener("touchstart",(function(e){return o.onTouchStart(e)}),!1),n.addEventListener("touchmove",(function(e){return o.onTouchMove(e)}),!1),n.addEventListener("touchend",(function(e){return o.onTouchEnd(e)}),!1),n.addEventListener("touchcancel",(function(){return o.onTouchCancel()}),!1),"function"==typeof n.onclick&&(this.logger.debug("[FASTCLICK] re-using existing onclick"),r=n.onclick,n.addEventListener("click",(function(e){r.call(o,e)}),!1),n.onclick=null),this.logger.debug("[FASTCLICK] FastClick enabled")}return i(e,[{key:"needsClick",value:function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if("file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)}},{key:"needsFocus",value:function(e){switch(e.nodeName.toLowerCase()){case"textarea":case"select":return!0;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}}},{key:"sendClick",value:function(e,t){document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),t=t.changedTouches[0],(t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,button:0,relatedTarget:null})).forwardedTouchEvent=!0,e.dispatchEvent(t),this.logger.debug("[FASTCLICK] Sent click event to element ".concat(e.tagName))}},{key:"focus",value:function(e){var t;e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type&&"email"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()}},{key:"updateScrollParent",value:function(e){var t=e.fastClickScrollParent;if(!t||!t.contains(e)){var n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}}while(n=n.parentElement)}t&&(t.fastClickLastScrollTop=t.scrollTop)}},{key:"getTargetElementFromEventTarget",value:function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e}},{key:"onTouchStart",value:function(e){if(!(1<e.targetTouches.length)){var t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],i=window.getSelection();if(!i.rangeCount||i.isCollapsed){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t),this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault()}}return!0}},{key:"touchHasMoved",value:function(e){e=e.changedTouches[0];var t=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>t||Math.abs(e.pageY-this.touchStartY)>t}},{key:"onTouchMove",value:function(e){return this.trackingClick&&(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0}},{key:"findControl",value:function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")}},{key:"onTouchEnd",value:function(e){var t=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp;var n=this.trackingClickStart,i=(this.trackingClick=!1,this.trackingClickStart=0,t.tagName.toLowerCase());if("label"===i){var r=this.findControl(t);r&&(this.focus(t),t=r)}else if(this.needsFocus(t))return 100<e.timeStamp-n||window.top!==window&&"input"===i?this.targetElement=null:(this.focus(t),this.sendClick(t,e),"select"!==i&&(this.targetElement=null,e.preventDefault())),!1;return!(!(r=t.fastClickScrollParent)||r.fastClickLastScrollTop===r.scrollTop)||(this.needsClick(t)||(e.preventDefault(),this.sendClick(t,e)),!1)}},{key:"onTouchCancel",value:function(){this.trackingClick=!1,this.targetElement=null}},{key:"onMouse",value:function(e){return!this.targetElement||!(!e.forwardedTouchEvent&&e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)&&(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),1))}},{key:"onClick",value:function(e){return this.trackingClick?(this.targetElement=null,!(this.trackingClick=!1)):"submit"===e.target.type&&0===e.detail||((e=this.onMouse(e))||(this.targetElement=null),e)}},{key:"destroy",value:function(){this.layer.removeEventListener("click",this.onClick,!0),this.layer.removeEventListener("touchstart",this.onTouchStart,!1),this.layer.removeEventListener("touchmove",this.onTouchMove,!1),this.layer.removeEventListener("touchend",this.onTouchEnd,!1),this.layer.removeEventListener("touchcancel",this.onTouchCancel,!1)}}]),e}(),gt=function(){function e(n,i){t(this,e),this.browserWindow=n,this.logger=i,this.isTouching=!1,this.isMonitoring=!1,this.monitorTouchDetect()}return i(e,[{key:"monitorTouchDetect",value:function(){var e=this;this.isMonitoring||(this.browserWindow.addEventListener("touchstart",(function(){e.isTouching=!0})),this.browserWindow.addEventListener("touchend",(function(){e.isTouching=!1})),this.browserWindow.addEventListener("touchcancel",(function(){e.isTouching=!1})),this.isMonitoring=!0,this.logger.debug("[TOUCH]: Monitoring touch events"))}},{key:"getIsTouching",value:function(){return this.isTouching}},{key:"waitForTouchEnd",value:function(e){var t=this;if(!this.isTouching)return e();var n=setInterval((function(){if(t.logger.debug("[TOUCH]: Checking if user is touching"),!t.isTouching)return clearInterval(n),e()}),100)}}]),e}();var ht,ft=function(){function e(n,i,r,o,s){t(this,e),this.logger=n,this.browserWindow=i,this.breakpoints=r,this.onWindowResized=o,this.options=s,this.initBpWatch(),this.logger.debug("[VIEWPORT]: Initialised at breakpoint ".concat(this.getCurrentBreakpoint().name))}return i(e,[{key:"getCurrentBreakpoint",value:function(){return e=this.breakpoints,t=this.getViewportStatus().width,n=null,Object.entries(e).forEach((function(e){var i=(e=c(e,2))[0];(e=e[1])<=t&&(!n||e>n.size)&&(n={size:e,name:i})})),n;var e,t,n}},{key:"breakpointSupplier",value:function(){return this.getCurrentBreakpoint.bind(this)}},{key:"isNotXsBreakpoint",value:function(){return"xs"!==this.getCurrentBreakpoint().name}},{key:"getViewportStatus",value:function(){var e=this.browserWindow;return{width:this.options.isUseOuterwidth.field?e.outerWidth:e.innerWidth,innerHeight:e.innerHeight,outerHeight:e.outerHeight,hidden:e.document.hidden,offset:{x:e.scrollX,y:e.scrollY}}}},{key:"initBpWatch",value:function(){var e=this,t=this.getCurrentBreakpoint().size;this.browserWindow.addEventListener("resize",function(e,t,n){function i(){var c=Date.now()-a;c<e&&0<=c?r=setTimeout(i,e-c):(r=null,n||(u=t.apply(s,o),r)||(s=o=null))}var r,o,s,a,u;return function(){s=this,o=arguments,a=Date.now();var c=n&&!r;return r=r||setTimeout(i,e),c&&(u=t.apply(s,o),s=o=null),u}}(500,(function(){var n=(i=e.getCurrentBreakpoint()).size,i=i.name,r=t!==n;return t=n,e.onWindowResized.emit({crossedBp:r,name:i,currentFrom:n})})))}}]),e}(),pt=new(function(){function e(){t(this,e)}return i(e,[{key:"getTouchObserver",value:function(){return this.touchObserver||(this.touchObserver=new gt(I.getBrowserWindowObject(),I.getLogger())),this.touchObserver}},{key:"enableFastClick",value:function(){this.fastClick||(this.fastClick=new dt(I.getBrowserWindowObject().document.body,I.getLogger()))}},{key:"getViewportInfo",value:function(){return this.viewportInfo||(this.viewportInfo=new ft(I.getLogger(),I.getBrowserWindowObject(),lt.getBreakpoints(),Ye.onWindowResized,{isUseOuterwidth:new je((function(){return lt.isUseBrowserOuterwidth()}))})),this.viewportInfo}}]),e}()),vt=function(){function e(n,i,r,o){var s=this;t(this,e),this.logger=n,this.accountSettings=i,this.breakpoints=r,this.viewportInfo=o,this.forceDisablePrebid=!1,this.v2Compatibility={disableWidgetsRenderer:!1},this.isUamEnabled=function(){var e;return!s.isYandexEnabled()&&(null==(e=s.fuseSettings.amazonUam)?void 0:e.enabled)},this.isResponsiveEnabled=function(){return s.fuseSettings.responsive},this.getInskinWidth=function(){return s.fuseSettings.inskinWidth},this.getSupportedSizes=function(e){return s.accountSettings.supported_sizes[e]},this.getCurrentBreakpoint=function(e){var t,n=s.breakpoints,i=null!=e?e:s.viewportInfo.getViewportStatus().width;return Object.keys(n).forEach((function(e){var r=n[e];r<=i&&(!t||r>t.size)&&(t={size:r,name:e})})),t},this.fuseSettings=this.applyQueryOverrides(i.fuse_settings),this.yieldExperiments=this.makeYieldExperimentsSettings(this.fuseSettings),this.logger.debug("[SETTINGS]: Yield experiments settings: ".concat(JSON.stringify(this.yieldExperiments))),this.fuseSettings=this.applyYieldExperimentsOverrides(this.fuseSettings,this.yieldExperiments),this.logger.debug("[SETTINGS]: Final: ".concat(JSON.stringify(this.fuseSettings))),this.initFuseSlots()}return i(e,[{key:"applyQueryOverrides",value:function(e){var t={useBidCache:Ve("fuseUseBidCache"),in2wInjection:Ve("fuseIn2wInjection"),useIndustry:Ve("fuseUseIndustry"),useGptPreAuctionModule:Ve("fuseUseGptPreAuctionModule"),useId5:Ve("fuseUseId5")},n=Object.assign({},e);return Object.keys(t).forEach((function(e){b(t[e])||(n[e]=t[e])})),this.logger.debug("[SETTINGS]: queryOverrides: ".concat(JSON.stringify(t))),n}},{key:"applyYieldExperimentsOverrides",value:function(e,t){var n=Object.assign({},e);return Object.keys(t).forEach((function(e){var i=t[e];i.isYieldExperiment&&(n[e]=i.experimentValue)})),n}},{key:"getYieldExperiment",value:function(e){var t=v(e);return{setting:e||!1,isYieldExperiment:t,experimentValue:t?100*Math.random()<Number(e):void 0}}},{key:"getYieldExperimentSettingValue",value:function(e){return"boolean"==typeof(t=e)&&t==t&&e;var t}},{key:"isPubliftGAM",value:function(){return"71161633"===this.fuseSettings.networkCode}},{key:"makeYieldExperimentsSettings",value:function(e){var t,n=this.isPubliftGAM();return{useBidCache:this.getYieldExperiment(e.useBidCache),in2wInjection:this.getYieldExperiment(!!n&&e.in2wInjection),useIndustry:this.getYieldExperiment(e.useIndustry),useGptPreAuctionModule:this.getYieldExperiment(e.useGptPreAuctionModule),useId5:this.getYieldExperiment(!(null!=(t=e.id5)&&t.enabled||!n)&&e.useId5)}}},{key:"getYieldExperimentalTargetingValues",value:function(e){if(this.yieldExperiments[e].isYieldExperiment)return"".concat(Boolean(this.yieldExperiments[e].experimentValue))}},{key:"getYieldExperimentsTargeting",value:function(){var e=this,t={};return Object.keys(this.yieldExperiments).forEach((function(n,i){(n=e.yieldExperiments[n]).isYieldExperiment&&(t["fuse_exp_".concat(i+1)]="".concat(Boolean(n.experimentValue)))})),t}},{key:"getUamSettings",value:function(){return this.fuseSettings.amazonUam}},{key:"isPrebidEnabled",value:function(){return!this.isYandexEnabled()&&!this.forceDisablePrebid&&this.fuseSettings.prebid&&this.fuseSettings.prebid.enabled}},{key:"isPrebidServer",value:function(){return 0<this.getPrebidServerBidders().length&&!at("fuseDisablePrebidServer")}},{key:"getPrebidServerBidders",value:function(){return this.fuseSettings.prebidServerBidderCodes||[]}},{key:"getPrebidSettings",value:function(){return this.fuseSettings.prebid}},{key:"getFuseUUID",value:function(){return this.accountSettings.fuse_uuid}},{key:"getSco",value:function(){return this.accountSettings.sco}},{key:"getTagRevision",value:function(){return this.accountSettings.publication_metadata.revision}},{key:"getFuseId",value:function(){return this.accountSettings.fuse_id}},{key:"getUseTelemetry",value:function(){return"disabled"!==this.fuseSettings.telemetry}},{key:"getIosChromeClickHandle",value:function(){return Boolean(this.fuseSettings.iosChromeClickHandle)}},{key:"getConfiantId",value:function(){return this.fuseSettings.confiantId}},{key:"getLowDwellPages",value:function(){return this.fuseSettings.lowDwellPages||[]}},{key:"getMaxViewportsFirstAuction",value:function(){return this.fuseSettings.maxViewportsFirstAuction}},{key:"getCmpProvider",value:function(){return this.isCmpRequired()?this.fuseSettings.cmpProvider:{partner:"none"}}},{key:"isCmpRequired",value:function(){return!this.isYandexEnabled()&&"none"!==this.fuseSettings.cmp}},{key:"getCmpMode",value:function(){return this.isYandexEnabled()||!this.fuseSettings.cmp?"disabled":this.fuseSettings.strict_cmp?"strict":"enabled"}},{key:"getCmpSkipStub",value:function(){return Boolean(this.fuseSettings.cmpSkipStub||"fundingchoices"===this.getCmpProvider().partner)}},{key:"getGdprTimeoutMillis",value:function(){var e;return null!=(e=st("fuseTagGdprTimeoutMs"))?e:2e4}},{key:"getUspTimeoutMillis",value:function(){return 100}},{key:"getTagStartCutoffMs",value:function(){var e;return null!=(e=st("fuseTagStartCutoffMs"))?e:this.fuseSettings.tagStartCutoffMs}},{key:"getPrebidDownloadCutoffMs",value:function(){var e;return null!=(e=st("fusePrebidDownloadCutoffMs"))?e:this.fuseSettings.prebidDownloadCutoffMs}},{key:"getPrebidTagStartCutoffMs",value:function(){var e;return null!=(e=st("fusePrebidTagStartCutoffMs"))?e:this.fuseSettings.prebidTagStartCutoffMs}},{key:"getUamTagStartCutoffMs",value:function(){var e;return null!=(e=st("fuseUamTagStartCutoffMs"))?e:this.fuseSettings.uamTagStartCutoffMs}},{key:"getAuctionMaxSlots",value:function(){var e;return null!=(e=null!=(e=st("fuseAuctionMaxSlots"))?e:this.fuseSettings.auctionMaxSlots)?e:99}},{key:"isIdentityEnabled",value:function(){var e;return null!=(e=null==(e=this.fuseSettings.identity)?void 0:e.enabled)&&e}},{key:"getIdentitySettings",value:function(){return this.fuseSettings.identity}},{key:"isId5Enabled",value:function(){var e;return(null==(e=this.fuseSettings.id5)?void 0:e.enabled)||this.getYieldExperimentSettingValue(this.fuseSettings.useId5)}},{key:"isGptPreAuctionEnabled",value:function(){return this.getYieldExperimentSettingValue(this.fuseSettings.useGptPreAuctionModule)}},{key:"isIn2wInjection",value:function(){return this.getYieldExperimentSettingValue(this.fuseSettings.in2wInjection)}},{key:"isBidCacheEnabled",value:function(){return this.getYieldExperimentSettingValue(this.fuseSettings.useBidCache)}},{key:"isFuseIndustryEnabled",value:function(){return this.getYieldExperimentSettingValue(this.fuseSettings.useIndustry)}},{key:"isAutoRegistrationEnabled",value:function(){return Boolean(this.fuseSettings.enableAutoRegistration)}},{key:"getId5PartnerId",value:function(){var e=null!=(e=this.fuseSettings.id5)&&e.enabled&&null!=(e=this.fuseSettings.id5)?e.partnerId:void 0;return this.yieldExperiments.useId5.isYieldExperiment&&this.yieldExperiments.useId5.experimentValue?1189:e}},{key:"getVideoSettings",value:function(){var e;return null!=(e=this.fuseSettings.videoSettings)?e:{enabled:!1}}},{key:"isConfiantEnabled",value:function(){return!this.isYandexEnabled()&&this.fuseSettings.confiant}},{key:"isPubstackEnabled",value:function(){return!!this.fuseSettings.pubstackId}},{key:"getPubstackId",value:function(){return this.fuseSettings.pubstackId}},{key:"isBlockthroughEnabled",value:function(){return!this.isYandexEnabled()&&this.fuseSettings.blockthrough}},{key:"isWidgetRendererEnabled",value:function(){return!this.v2Compatibility.disableWidgetsRenderer&&!this.fuseSettings.disableWidgetsRenderer}},{key:"setDisableWidgetRenderer",value:function(){this.v2Compatibility.disableWidgetsRenderer=!0}},{key:"isStrictCmp",value:function(){return Boolean(this.fuseSettings.strict_cmp)}},{key:"isRequestGdprPersonalisation",value:function(){return!this.fuseSettings.disableGdprPersonalisation}},{key:"isIframeCmp",value:function(){return"iframe"===this.fuseSettings.cmp}},{key:"setForceDisablePrebid",value:function(){this.logger.log("[CONFIG]: Forcefully disabling prebid"),this.forceDisablePrebid=!0}},{key:"isMiniScrollersEnabled",value:function(){return Boolean(this.fuseSettings.enableMiniScrollers)}},{key:"scrollToStickDisableDepth",value:function(){return this.fuseSettings.scrollToStickDisableDepth}},{key:"isSpaOldBlockingPageInit",value:function(){return Boolean(this.fuseSettings.spaOldBlockingPageInit)}},{key:"getTopStickyHeaderSelector",value:function(){var e;return(null==(e=null==(e=this.getFuseSlots().filter((function(e){var t;return(null==(t=e.attributes)?void 0:t.miniscroller)&&(null==(t=e.miniscrollerAttributes)?void 0:t.topStickyHeaderSelector)}))[0])?void 0:e.miniscrollerAttributes)?void 0:e.topStickyHeaderSelector)||ut("fuseTopStickyHeaderSelector")||this.fuseSettings.topStickyHeaderSelector}},{key:"getSlotRefWithoutMcm",value:function(e){var t=/^(\/\d*),(\d*)(\/.*)$/i;return!1===t.test(e)?(this.logger.debug("[SETTINGS]: regExGamAdUnitRef.test(slotRef): ".concat(JSON.stringify(t.test(e)),", slotRef: ").concat(e)),e):(this.logger.debug("[SETTINGS]: regExGamAdUnitRef.test(slotRef): ".concat(JSON.stringify(t.test(e)),", slotRef: ").concat(e)),t=t.exec(e),this.logger.debug("[SETTINGS]: slotRef: ".concat(e,", matches: ").concat(JSON.stringify(t))),"".concat(t[1]).concat(t[3]))}},{key:"cleanSlotBasedOnMcmMode",value:function(e){var t=this.getSlotRefWithoutMcm(e.slot);return this.logger.debug("[SETTINGS]: before: with MCM: ".concat(e.slot,", after: without MCM: ").concat(t)),Object.assign(Object.assign({},e),{slot:t})}},{key:"cleanSlotSizeMapping",value:function(e){var t,n={};return null!=(t=e.sizeMapping)&&t.xl&&(n.xl=e.sizeMapping.xl),null!=(t=e.sizeMapping)&&t.l&&(n.l=e.sizeMapping.l),n.m=null==(t=e.sizeMapping)?void 0:t.m,n.s=null==(t=e.sizeMapping)?void 0:t.s,n.xs=null==(t=e.sizeMapping)?void 0:t.xs,Object.assign(Object.assign({},e),{sizeMapping:n})}},{key:"initFuseSlots",value:function(){var e=this,t=at("fuseMcmOff");this.accountSettings.fuse_slots=this.accountSettings.fuse_slots.map((function(n){t&&(e.logger.debug("[SETTINGS]: will".concat(t?"":" NOT"," remove MCM child reference from the slot ref - ").concat(n.slot)),n=e.cleanSlotBasedOnMcmMode(n));var i=n.activateConditionConfig;switch(i.type){case"none":n.activateCondition=void 0;break;case"lazy":var r=e.getCurrentBreakpoint().name;b(r=i.scrollDistance[r])||!1===r?n.activateCondition=void 0:n.activateCondition={type:"condition",name:Je,params:i.scrollDistance};break;case"manual":n.activateCondition={type:"condition",name:et};break;case"custom":n.activateCondition=i.config;break;default:y(i)}return n=e.applyOverrides(n),e.cleanSlotSizeMapping(n)}))}},{key:"getFuseSlots",value:function(){return this.accountSettings.fuse_slots}},{key:"applyOverrides",value:function(e){var t;return Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),{interscroller:void 0!==(null==(t=this.overrideParams)?void 0:t.interscrollersParams[e.id])||(null==(t=e.attributes)?void 0:t.interscroller),sticky:void 0!==(null==(t=this.overrideParams)?void 0:t.stickiesParams[e.id])||(null==(t=e.attributes)?void 0:t.sticky),dynamic:void 0!==(null==(t=this.overrideParams)?void 0:t.dynamicParams[e.id])||(null==(t=e.attributes)?void 0:t.dynamic)||(null==(t=this.overrideParams)?void 0:t.dynamicParams[e.id]),scrollToStick:void 0!==(null==(t=this.overrideParams)?void 0:t.scrollToStickParams[e.id])||(null==(t=e.attributes)?void 0:t.scrollToStick),miniscroller:void 0!==(null==(t=this.overrideParams)?void 0:t.miniscrollersParams[e.id])||(null==(t=e.attributes)?void 0:t.miniscroller)}),interscrollerAttributes:Object.assign(Object.assign({},e.interscrollerAttributes),null==(t=this.overrideParams)?void 0:t.interscrollersParams[e.id]),stickyAttributes:Object.assign(Object.assign({},e.stickyAttributes),null==(t=this.overrideParams)?void 0:t.stickiesParams[e.id]),dynamicAttributes:Object.assign(Object.assign({},e.dynamicAttributes),null==(t=this.overrideParams)?void 0:t.dynamicParams[e.id]),miniscrollerAttributes:Object.assign(Object.assign({},e.miniscrollerAttributes),null==(t=this.overrideParams)?void 0:t.miniscrollersParams[e.id])})}},{key:"generateZoneTemplate",value:function(e,t){var n=this.getZoneTemplate(e);if(n)return this.zoneCustomiser()&&function(e,t,n){if(n)try{e.log("[ZONE][".concat(t,"][fuseZoneCustomiser] Start"))}catch(n){e.error("[ZONE][".concat(t,"][fuseZoneCustomiser] Encountered error during evaluation"),n)}else e.error("[ZONE][".concat(t,"][fuseZoneCustomiser] api is not defined, skip customisation"))}(this.logger,e,t),n}},{key:"getZoneTemplate",value:function(e){return this.getFuseSlots().filter((function(t){return t.id==e}))[0]}},{key:"isScanDOMOnPageLoad",value:function(){var e=this.fuseSettings.disableAutoLoadSlots;return b(e)||!e}},{key:"isHeaderBiddingSlot",value:function(e){return!e.attributes.interstitial&&e.attributes.headerbidding&&0<e.bids.length}},{key:"isSlotWidget",value:function(e){var t;return(null==(t=e.attributes)?void 0:t.interscroller)||(null==(t=e.attributes)?void 0:t.sticky)||(null==(t=e.attributes)?void 0:t.dynamic)||null}},{key:"maxSlotHeightForBreakpoint",value:function(e,t){return null==(e=e.sizeMapping[t])?void 0:e.reduce((function(e,t){return t[1]>e?Number(t[1]):e}),0)}},{key:"getPrebidOptions",value:function(e){if(this.isPrebidEnabled()&&this.fuseSettings.prebid.breakpoint_options&&(e=this.fuseSettings.prebid.breakpoint_options[e]))return{enabled:e.enabled,sendAllBids:!0===this.fuseSettings.prebid.sendAllBids,timeout:null!=(e=null!=(e=e.timeout)?e:this.fuseSettings.prebid.defaultTimeout)?e:1e3};return{enabled:this.isPrebidEnabled(),sendAllBids:!0===this.fuseSettings.prebid.sendAllBids,timeout:null!=(e=this.fuseSettings.prebid.defaultTimeout)?e:1e3}}},{key:"isPrebidEnabledAtBP",value:function(e){return this.isPrebidEnabled()&&this.getPrebidOptions(e).enabled}},{key:"isUamEnabledAtBP",value:function(e){return this.isUamEnabled()&&this.getPrebidOptions(e).enabled}},{key:"getHbTimeout",value:function(e){return this.getPrebidOptions(e).timeout}},{key:"getPrebidMediaTypes",value:function(){return this.fuseSettings.prebidMediaTypes||["banner"]}},{key:"isPrebidBannerEnabled",value:function(){return this.getPrebidMediaTypes().includes("banner")}},{key:"isPrebidVideoEnabled",value:function(){return this.getPrebidMediaTypes().includes("video")}},{key:"isPrebidNativeEnabled",value:function(){return this.getPrebidMediaTypes().includes("native")}},{key:"isSlotEnabledForBreakpoint",value:function(e,t){return!!(e=this.getZoneTemplate(e))&&0<(null!=(e=null==(e=e.sizeMapping)?void 0:e[t])?e:[]).length}},{key:"getPublicationId",value:function(){return this.accountSettings.publication_metadata.publication_id}},{key:"getFlavour",value:function(){return this.accountSettings.fuse_flavour||"default"}},{key:"getFuseCDN",value:function(){return this.accountSettings.fuse_cdn}},{key:"getPrebidHash",value:function(){return this.accountSettings.fuse_prebid_hash}},{key:"getBlockedUrls",value:function(){return this.accountSettings.fuse_blocked_url||[]}},{key:"getFuseIndustry",value:function(){return this.accountSettings.fuse_industry}},{key:"getFuseSettings",value:function(){return this.fuseSettings}},{key:"getEdgeHtmlMaxAdsRefreshLimit",value:function(){return this.fuseSettings.edgeHtmlMaxAdsRefreshLimit||60}},{key:"getDefaultRefreshInterval",value:function(){return this.fuseSettings.refresh}},{key:"getAccountSettings",value:function(){return this.accountSettings}},{key:"getV2CompatOverrides",value:function(){return this.v2Compatibility}},{key:"isTestCreatives",value:function(){return at("fuseTestCreatives")||!1}},{key:"getSlotTestUrls",value:function(){return this.fuseSettings.fuse_test_urls||[]}},{key:"getYandexBlockId",value:function(){return ut("fuseYandexBlockId")||this.fuseSettings.yandexBlockId}},{key:"isYandexEnabled",value:function(){return this.fuseSettings.yandex||at("fuseYandex")||""!==ut("fuseYandexBlockId")}},{key:"isPubxaiEnabled",value:function(){return this.fuseSettings.usePubxai||!1}},{key:"isArctagEnabled",value:function(){return this.fuseSettings.useArctag||!1}},{key:"getIn2wRatio",value:function(){return this.yieldExperiments.in2wInjection.isYieldExperiment&&this.yieldExperiments.in2wInjection.experimentValue?.9:this.fuseSettings.in2wRatio}},{key:"getIn2wAdvertiserId",value:function(){return this.fuseSettings.in2wAdvertiserId}},{key:"getIn2wAdvertiserTimeZone",value:function(){return this.fuseSettings.in2wAdvertiserTimeZone}},{key:"getTenantCode",value:function(){return this.accountSettings.fuse_tenant}},{key:"getPrebidIasPubId",value:function(){return this.fuseSettings.prebidIasPubId}},{key:"zoneCustomiser",value:function(){return this.fuseSettings.zoneCustomiser}}]),e}(),bt=new(function(){function e(){t(this,e)}return i(e,[{key:"getSettings",value:function(){return this.settingsAll||(this.settingsAll=new vt(I.getLogger(),lt.getAccountSettings(),lt.getBreakpoints(),pt.getViewportInfo())),this.settingsAll}}]),e}()),mt=new(function(){function e(){t(this,e)}return i(e,[{key:"getDeviceInfo",value:function(){return this.deviceInfo||(this.deviceInfo=new M(I.getBrowserWindowObject())),this.deviceInfo}},{key:"getTelemetry",value:function(){var e=this;return this.telemetry||(this.telemetry=new We(this.getComponentStatusStore(),this.getDeviceInfo(),I.getLogger(),I.getBrowserWindowObject(),I.getSessionId(),this.getReporter(),(function(t){var n=I.getBrowserWindowObject();n.fetch?n.fetch(t,{credentials:"omit",mode:"cors",keepalive:!0}).catch((function(t){var n=String(t).toLowerCase();if(n.includes("TypeError: NetworkError when attempting to fetch resource".toLowerCase()))I.getLogger().warn("Unable to fire telemetry request, possibly unable to outlive environment.");else if(n.includes("TypeError: Load failed".toLowerCase())&&e.getDeviceInfo().getBrowser()===T.Safari)I.getLogger().warn("Unable to fire telemetry request, unknown network error.");else{if(!n.includes("TypeError: Failed to fetch".toLowerCase()))throw t;I.getLogger().warn("Unable to fire telemetry request, possibly be blocked by AdBlock.")}})):((n=new XMLHttpRequest).open("GET",t,!0),n.send())}),bt.getSettings(),{onSlotRequested:Ye.onSlotRequested})),this.telemetry}},{key:"getReporter",value:function(){var e;return this.reporter||(e=I.getFuseDob(),this.reporter=new N(e,{onSlotLoaded:Ye.onSlotLoaded,onSlotResponse:Ye.onSlotResponse,onImpressionViewable:Ye.onImpressionViewable})),this.reporter}},{key:"getComponentStatusStore",value:function(){return this.pluginStateStore||(this.pluginStateStore=new G(Ye.onComponentInitEvent,I.getLogger(),this.getReporter())),this.pluginStateStore}}]),e}()),St=function(e,t,n,i){e.debug("".concat(i,"[EVENT][").concat(n.slot.getSlotElementId(),"]: ").concat(t," event details: ").concat(JSON.stringify(n)))},yt=[5068036699,5101751880,5189144814,5144578315,5221077018,5104488413],kt=function(e){return e=e.slot.getResponseInformation(),Boolean((null==e?void 0:e.advertiserId)&&yt.includes(e.advertiserId))},It={name:"Google Publisher Tag",url:"//securepubads.g.doubleclick.net/tag/js/",file:"gpt.js"},Ct={},Et={},wt=!1,Tt=!1,_t=I.getLogger(),At=I.getBrowserWindowObject(),Rt=I.getWindowLocation(),xt=mt.getReporter(),Pt=mt.getComponentStatusStore(),Dt=bt.getSettings();function Ot(e){return"function"==typeof e.getVersion?"v".concat(e.getVersion()):"unknown version"}var Lt=function(e){var t=Mt();At.googletag&&At.googletag._loadStarted_?_t.debug("[INIT]: GPT ".concat(Ot(t)," is already on the page, skip loading another copy")):P(It,(function(){_t.debug("[INIT]: GPT ".concat(At.googletag&&At.googletag._loadStarted_?"".concat(Ot(t)," is loaded"):"not loaded")),e()}))},Mt=function(){return At.googletag?At.googletag.cmd||(_t.info("[GPT]: Initialised window.googletag.cmd as it was missing"),At.googletag.cmd=[]):At.googletag={cmd:[]},ht=At.googletag,At.googletag},Nt=function(e){return Mt().cmd.push(e)};function Bt(e,t){Nt((function(){var n,i=[],r=(e.forEach((function(e){n=[e.slotDivId],a=t;var n,r,o,s,a=(ht?n?((r=(s=ht.pubads().getSlots()).filter((function(e){return 0<=n.indexOf(e.getSlotElementId())}))).length!==n.length&&(o=s.map((function(e){return e.getSlotElementId()})),s=n.filter((function(e){return-1===o.indexOf(e)})),_t.warn("[AUCTION][".concat(a,"]: Could not find a GPT slot for all fuse slots.\n      Missing Slots=").concat(JSON.stringify(s),",\n      All GPT Slots: ").concat(JSON.stringify(o)))),r):(_t.error("Called getGPTSlot() without a fuseSlotCode"),[]):(_t.error("Called getGPTSlot(".concat(n,") but googletag not defined")),[]))[0];a?i.push([e,a]):_t.warn("[AUCTION][".concat(t,"]: Could not find GPT Slot corresponding to ").concat(e.slotDivId))})),i.map((function(e){return(e=c(e,2))[0],e[1]})));function o(){!function(e){e.forEach((function(e){var t=e[1],n=t.getSlotElementId();e=e[0].zoneTemplate.id,n=Ct[n]||0,e=Et[e]||0,t.setTargeting("is_refresh",(0<n).toString()),t.setTargeting("slot_prev_count",n.toString()),t.setTargeting("adunit_prev_count",e.toString())}))}(i);var e=JSON.stringify(r.map((function(e){return e.getSlotElementId()})));xt.addAdEvent("gpt_pubads_refresh_".concat(e),{requestId:t}),wt||(xt.reportFirstGptRequest(),xt.setStateStatus("first_gpt_request"),Zt(U(Pt.state.cmp))),jt(),wt=!0,_t.debug("[AUCTION][".concat(t,"]: Calling googletag.pubads().refresh(").concat(e,")")),ht.pubads().refresh(r,{changeCorrelator:Tt}),Tt=!1,function(e){e.forEach((function(e){var t=e[1].getSlotElementId();e=e[0].zoneTemplate.id,Et[e]=(Et[e]||0)+1,Ct[t]=(Ct[t]||0)+1}))}(i)}r&&0!==r.length?!0===A(At)?(_t.debug("[GC] will trigger GC for iFrames in Edge browser"),n=At.document.querySelectorAll("div[data-fuse] iframe"),new Promise((function(e){setTimeout((function(){try{e()}catch(e){}}),5),n.forEach((function(e){e.addEventListener("load",(function(){try{for(;this.contentWindow.lastChild;)this.contentWindow.removeChild(this.contentWindow.lastChild);_t.debug("[GC]: cleaned iFrame contentWindow")}catch(e){_t.error("[GC]: error in cleaning iFrame contentWindow => ".concat(e))}}),{once:!0})})),n.forEach((function(e){e.setAttribute("src","about:blank")})),e()})).then((function(){try{CollectGarbage()}catch(e){_t.error("[GC]: error in CollectGarbage => ".concat(e))}o()})).catch((function(e){_t.error("[GC]: error in purgeIframes => ".concat(e))}))):o():_t.info("[AUCTION][".concat(t,"]: Cancelled adserver request because no matching GPT slots found"))}))}var zt=function(e,t){_t.debug("[GPT]: Setting page targeting for [key: ".concat(e,", value: ").concat(t,"]")),ht.pubads().setTargeting(e,t)},Ft=function(e,t){Nt((function(){return zt(e,t)}))};function Gt(e){switch(e._tag){case"ready":return B(e.loadFinish);case"deferred":case"disabled":return"disabled";case"cancelled":return e._tag;case"pending":case"loading":return"not_ready";default:y(e)}}var Ut,Wt,jt=function(){function e(e,t){zt(e,wt?"refresh":t)}function t(t,n){n&&e(t,B(n))}_t.debug("[GPT]: Applying page targeting"),zt("fuse_site",function(){var e=Rt.host;return e.substring(e.length-40,e.length)}()),zt("fuse_path",function(){var e=Rt.pathname;return e.substring(e.length-40,e.length)}()),zt("fuse_query",function(){var e=Rt.search;return e.substring(e.length-40,e.length)}()),zt("fuse_category",function(){for(var e=[],t=Rt.pathname.split("/"),n=0;n<t.length;n+=1)t[n].length&&-1===t[n].indexOf(".")&&e.push(t[n]);return e}());var n=((n=Dt.getFuseIndustry())&&zt(Dt.isFuseIndustryEnabled()?"fuse_industry_2":"fuse_industry",n),zt("testmode","".concat(Dt.isTestCreatives())),Dt.getInskinWidth()),i=(n="".concat(S(n)&&At.screen.width>=n),n=(zt("inskin_yes",n),zt("fuse_uuid",Dt.getFuseUUID()),zt("fuse_publication_id",Dt.getPublicationId().toString()),zt("fuse_flavour",Dt.getFlavour()),e("GPT_READY_MS",Gt(Pt.state.gpt)),e("PREBID_READY_MS",Gt(Pt.state.prebid)),e("UAM_READY_MS",Gt(Pt.state.uam)),e("CMP_DETERMINED_MS",Gt(Pt.state.cmp)),e("CMP_GDPR_CACHED",String(xt.cmpGdprCached)),t("FUSE_LOADED_MS",xt.tagLoadedMs),xt.firstGptRequestMs&&t("GPT_AUCTION_START_MS",xt.firstGptRequestMs),xt.cmpLoadFinishMs&&t("CMP_LOAD_FINISH_MS",xt.cmpLoadFinishMs),xt.cmpGdprElapsedMs&&t("CMP_GDPR_ELAPSED_MS",xt.cmpGdprElapsedMs),xt.firstZoneMs&&t("FIRST_ZONE_MS",xt.firstZoneMs),xt.hbAuctionStartMs&&t("HB_AUCTION_START_MS",xt.hbAuctionStartMs),W(Pt.state.cmp)),zt("CMP_JURISDICTION",n),zt("CMP_ALLOW_PERSONAL","".concat(U(Pt.state.cmp))),Dt.getYieldExperimentsTargeting());Object.keys(i).forEach((function(e){zt(e,i[e])}))},Ht=function(){Nt((function(){jt()}))},Vt=function(){var e=function(e,t,n){return function(i,r){return function(o){var s=t(o);if(St(e,i,o,s?"[".concat(n,"]"):""),!t(o))return r(o)}}}(_t,kt,"IN2W");ht.pubads().disableInitialLoad(),ht.pubads().collapseEmptyDivs(!0),ht.pubads().setCentering(!0),ht.pubads().enableSingleRequest(),ht.pubads().addEventListener("slotRequested",e("requested",(function(e){Ye.onSlotRequested.emit(e)}))),ht.pubads().addEventListener("slotResponseReceived",e("response",(function(e){Ye.onSlotResponse.emit(e)}))),ht.pubads().addEventListener("slotOnload",e("load",(function(e){Ye.onSlotLoaded.emit(e)}))),ht.pubads().addEventListener("slotRenderEnded",e("render",(function(e){Ye.onSlotRender.emit(e)}))),ht.pubads().addEventListener("impressionViewable",e("viewable",(function(e){Ye.onImpressionViewable.emit(e)}))),jt()},qt=function(e){Nt((function(){ht.pubads().addEventListener("slotRenderEnded",e)}))},Zt=function(e){e={nonPersonalizedAds:!e},_t.info("[GPT]: googletag.pubads().setPrivacySettings(".concat(JSON.stringify(e),")")),At.googletag.pubads().setPrivacySettings(e)},Yt=function(e){ht.destroySlots(e)},Qt=I.getLogger(),Jt=mt.getReporter(),Kt=bt.getSettings(),Xt={name:"Blockthrough",url:"//btloader.com/",file:"tag?o=5708166709903360&upapi=true"},$t=function(e){Kt.isBlockthroughEnabled()?pt.getViewportInfo().isNotXsBreakpoint()?(Jt.setStateStatus("blockthrough_load_start"),P(Xt,(function(){Qt.log("[BLOCKTHROUGH]: Tag loaded"),Jt.setStateStatus("blockthrough_load_finish"),e&&e()}))):Qt.debug("[INIT]: Skip loading blockthrough because page on XS breakpoint"):Qt.debug("[INIT]: Skip loading blockthrough because it is not enabled")},en=I.getLogger(),tn=mt.getReporter(),nn=I.getBrowserWindowObject(),rn=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"ZVeqITFg3t0RVj7Gh41kEbdx9DA",t=1<arguments.length?arguments[1]:void 0,n=(tn.setStateStatus("confiant_load_start"),nn.confiant||{}),i=(n[e]=n[e]||{clientSettings:{}},n[e].clientSettings||(n[e].clientSettings={}));i.callback=function(e,t,n,i,r,o){en.log("[CONFIANT]: Has blocked the ad: ",e,t,n,i,r,JSON.stringify(o))},i.prebidExcludeBidders=[],i.prebidNameSpace="fusePbjs",i.on_prebid_error=function(e){en.log("[CONFIANT]: failed to scan an ad",e)},i.onRendered=function(e){en.log("[CONFIANT]: Rendered the ad",e)},nn.confiant=n,P(function(e){return{name:"Confiant",url:"//cdn.confiant-integrations.net/".concat(e,"/gpt_and_prebid/"),file:"config.js"}}(e),(function(){en.log("[CONFIANT]: Script loaded"),tn.setStateStatus("confiant_load_finish"),t&&t()}))},on=I.getLogger(),sn=mt.getReporter(),an=function(e,t){sn.setStateStatus("pubstack_load_start"),P(function(e){return{name:"Pubstack",url:"//boot.pbstck.com/v1/tag/",file:e}}(e),(function(){on.log("[PUBSTACK]: Script loaded"),sn.setStateStatus("pubstack_load_finish"),t&&t()}))},un=function(){function e(n){t(this,e),this.partnerId=n}return i(e,[{key:"configPrebid",value:function(e){var t=e.userSync;return Object.assign(Object.assign({},e),{userSync:Object.assign(Object.assign({},t),{userIds:[].concat(l(t.userIds||[]),[{name:"id5Id",params:{partner:this.partnerId},storage:{type:"html5",name:"id5id",expires:90,refreshInSeconds:28800}}])})})}}]),e}(),cn=function(){var e=bt.getSettings(),t=e.getId5PartnerId();!Ut&&e.isId5Enabled()&&t&&(Ut=new un(t))},ln=function(){return Ut},dn=function(){function e(n,i){t(this,e),this.browserWindow=n,this.placementId=i}return i(e,[{key:"setup",value:function(){var e,t=document.createElement("script"),n=(t.async=!0,t.defer=!0,t.src="https://launchpad-wrapper.privacymanager.io/47eddec1-62a9-4081-b655-0c9fa5eb8a0d/launchpad-liveramp.js",this.browserWindow.document.getElementsByTagName("script")[0]);null!=(e=null==n?void 0:n.parentNode)&&e.insertBefore(t,n)}},{key:"configPrebid",value:function(e){var t=e.userSync;return Object.assign(Object.assign({},e),{userSync:Object.assign(Object.assign({},t),{userIds:[].concat(l(t.userIds||[]),[{name:"identityLink",params:{pid:this.placementId},storage:{type:"cookie",name:"idl_env",expires:7,refreshInSeconds:1800,notUse3P:!1}}]),syncDelay:3e3})})}}]),e}(),gn=function(e){var t;Wt||(t=bt.getSettings(),(Wt=new dn(e,t.getFuseSettings().identity.placementId)).setup())},hn=function(){return Wt},fn=new(function(){function e(){t(this,e)}return i(e,[{key:"getPrebidGlobal",value:function(){var e=I.getBrowserWindowObject();return e.fusePbjs||(e.fusePbjs={que:[]}),e.fusePbjs}}]),e}()),pn=this&&this.__rest||function(e,t){var n={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},vn=I.getLogger(),bn=I.getPackageMajorVersion(),mn=fn.getPrebidGlobal(),Sn=mt.getReporter(),yn=bt.getSettings();function kn(e){return e.hasOwnProperty("libLoaded")}var In=function(e){var t,n;if(Sn.setStateStatus("prebid_load_script_start"),!kn(mn))return t=yn.getPrebidHash(),n=yn.getFuseCDN(),P(Object.assign({name:"Prebid.org"},t?{url:"//".concat(new URL("https:"+n).hostname,"/prebid/"),file:"prebid-".concat(t,".js")}:{url:"".concat(n).concat(bn,"/").concat(yn.getFuseId(),"/"),file:"prebid.js"}),(function(){vn.debug("[INIT]: Prebid ".concat(kn(mn)&&mn.libLoaded?"".concat(mn.version," is loaded and ready"):"not loaded")),Sn.setStateStatus("prebid_onload_received"),e()}));vn.warn("[INIT]: Prebid ".concat(mn.version," is already loaded skip loading it again"))},Cn=function(e){mn.que.push((function(){try{e.call(void 0)}catch(e){e instanceof Error?vn.error("Error processing command :",e.message,e.stack):vn.error("Error processing command :",e)}}))};function En(e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({enableSendAllBids:e&&!0===e.sendAllBids,priceGranularity:{buckets:[{max:3,increment:.01,precision:2},{max:10,increment:.1,precision:2},{max:50,increment:1,precision:2},{max:100,increment:10,precision:2}]},sizeConfig:yn.isResponsiveEnabled()&&!lt.isUseBrowserOuterwidth()?(t=null,n=[],Object.keys(lt.getBreakpoints()).forEach((function(e){var i=lt.getBreakpoints()[e],r=t?t-1:null;vn.debug("[PREBID]: Configured breakpoint ".concat(e," ").concat(i,"px to ").concat(r)),n.push({mediaQuery:"(min-width:".concat(i,"px)").concat(t?" and (max-width: ".concat(r,"px)"):""),sizesSupported:yn.getSupportedSizes(e),labels:[e]}),t=i})),n):(i=pt.getViewportInfo().getCurrentBreakpoint().name,[{mediaQuery:"(min-width: ".concat(0,"px)"),sizesSupported:yn.getSupportedSizes(i),labels:[i]}]),userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"}},enableOverride:!0}},yn.isCmpRequired()&&(vn.debug("[PREBID]: Configured CMP module"),{consentManagement:{gdpr:{cmpApi:"iab",timeout:yn.getUspTimeoutMillis(),defaultGdprScope:yn.isStrictCmp(),allowAuctionWithoutConsent:!yn.isStrictCmp()},usp:{cmpApi:"iab",timeout:yn.getUspTimeoutMillis()}}})),yn.isGptPreAuctionEnabled()&&(vn.debug("[PREBID]: Configured GPT Pre auction module"),{gptPreAuction:{enabled:!0,customPreAuction:function(e){return null==(e=document.querySelector('div[data-fuse-slot="'.concat(e.code,'"]')))?void 0:e.getAttribute("data-gpid")}}})),e.sco&&{schain:{validation:"strict",config:{ver:"1.0",complete:1,nodes:[{asi:(i=e.sco).asi,sid:i.sellerId,hp:1}]}}}),0<e.prebidServerBidders.length&&(e=e.prebidServerBidders,vn.debug("[PREBID]: Enabling Prebid Server for ".concat(JSON.stringify(e))),{s2sConfig:{accountId:"20884",bidders:e,adapter:"prebidServer",enabled:!0,endpoint:"https://mpbs.rubiconproject.com/openrtb2/auction",syncEndpoint:"https://mpbs.rubiconproject.com/cookie_sync",timeout:750,extPrebid:{cache:{vastxml:{returnCreative:!1}}}}})),{currency:{adServerCurrency:"USD",granularityMultiplier:1,defaultRates:{AUD:{USD:.67}}}}),yn.isBidCacheEnabled()&&{useBidCache:!0}),yn.getPrebidIasPubId()&&{realTimeData:{dataProviders:[{name:"ias",waitForIt:!0,params:{pubId:yn.getPrebidIasPubId()}}]}}),"v5"===yn.getTagRevision()&&{enableTIDs:!0});var t,n,i}var wn=function(e){return vn.debug("[PREBID]: Applied config settings ".concat(JSON.stringify(e))),mn.setConfig(Object.assign(Object.assign({},e),yn.isPrebidVideoEnabled()&&{cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},rubicon:{rendererConfig:{align:"center",position:"append",closeButton:!0,label:"Advertisement",collapse:!0}}})),"v5"===yn.getTagRevision()&&(mn.bidderSettings={standard:{storageAllowed:["cookie"]}}),e},Tn=function(e){var t,n=e.sizesHb.map((function(e){return K(e)})),i=e.zoneTemplate.bids.filter((function(e){return!((e=e.bidSizes)&&0<e.length)||0<function(e,t){for(var n=[],i=new Set(t),r=0,o=e.length;r<o;++r)i.has(e[r])&&n.push(e[r]);return n}(n,e).length})).map((function(e){return e.bidSizes,pn(e,["bidSizes"])}));return yn.isPrebidVideoEnabled()&&null!=(e=e.mediaTypes)&&e.includes("video")?(t={w:640,h:480,context:"outstream",language:"en",mimes:["video/mp4"]},i.map((function(e){return Object.assign(Object.assign({},e),{params:Object.assign(Object.assign(Object.assign({},t),e.params),"pubmatic"===e.bidder&&{outstreamAU:"renderer_test_pubmatic"})})}))):i};var _n=Cn,An=function(e){Cn((function(){var e=En({sendAllBids:yn.getPrebidSettings()&&!0===yn.getPrebidSettings().sendAllBids,sco:yn.getSco(),prebidServerBidders:yn.isPrebidServer()?yn.getPrebidServerBidders():[]}),t=hn();yn.isIdentityEnabled()&&t&&(vn.debug("[PREBID] Enabled identity module"),e=t.configPrebid(e),vn.debug("[PREBID] Enabled ATS analytics module"),mn.enableAnalytics([{provider:"atsAnalytics",options:{pid:t.placementId}}])),t=ln();yn.isId5Enabled()&&t&&(vn.debug("[PREBID] Enabled id5 module"),e=t.configPrebid(e)),wn(e),vn.debug("[PREBID]: Enabled prebid ".concat(JSON.stringify(e)))})),E(st("fuseDelayPrebidInit"),"simulate prebid download delay",vn,(function(){var t=Sn.getElapsedTime();In((function(){var n=I.getBrowserWindowObject(),i=n.pbjs;m(i)||!kn(i)?n.pbjs=mn:i.renderAd&&(i.renderAd=mn.renderAd),e(t)}))}))},Rn=function(){kn(mn)&&mn.removeAdUnit()},xn=function(e){Cn((function(){var t=I.getBrowserWindowObject(),n=I.getWindowLocation();mn.setConfig({ortb2:{site:{name:n.hostname,domain:n.hostname,cat:e.iabCodes||yn.getFuseIndustry(),sectioncat:e.iabCodes,pagecat:e.iabCodes,page:n.href,ref:t.document.referrer,keywords:e.keywords.join(",")}}}),Ft("CATEGORY_IAB",e.keywords),Ft("CATEGORY_IAB_Codes",e.iabCodes)}))},Pn=I.getLogger(),Dn=mt.getReporter(),On=function(){Dn.setStateStatus("arctag_load_start"),P({name:"ArcTag",url:"//silo25.p7cloud.net/",file:"as.js"},(function(){Pn.log("[ARCTAG]: Script loaded"),Dn.setStateStatus("arctag_load_finish"),function(){var e=0,t=setInterval((function(){var n,i=I.getBrowserWindowObject().arcobj1;i?(clearInterval(t),null!=(n=i.page_iab_codes)&&n.text||null!=(n=i.page_iab)&&n.text?(Pn.debug("[ARCTAG]: Applying prebid site categories from window.arcobj1 ".concat(JSON.stringify(i))),xn({iabCodes:(null==(n=i.page_iab_codes)?void 0:n.text)||[],keywords:(null==(n=i.page_iab)?void 0:n.text)||[]})):Pn.debug("[ARCTAG]: No codes and keyword in retrieved data")):(e++,Pn.debug("[ARCTAG]: window.arcobj1 not inited yet ".concat(e)),30<e&&(clearInterval(t),Pn.debug("[ARCTAG]: window.arcobj1 check cancelled")))}),100)}()}))},Ln=I.getLogger(),Mn=mt.getReporter(),Nn=function(){function e(n,i){var r=this;t(this,e),this.logger=n,this.gptDestroySlots=i,this.templateTargetings={},this.slots={},this.destroySlotsFunc=function(e){var t=e.map((function(e){return e.getSlotElementId()}));r.logger.debug("[GPT-REGISTRY]: Calling googletag.destroySlots(".concat(JSON.stringify(t),")")),r.gptDestroySlots(e)}}return i(e,[{key:"add",value:function(t,n){var i=this,r=e.getLCTemplateId(t),o=(Array.isArray(this.slots[r])||(this.slots[r]=[]),this.logger.debug("[GPT-REGISTRY]: Added ".concat(r)),this.slots[r].push(n),this.templateTargetings[r]);o?(Object.keys(o).forEach((function(e){n.setTargeting(e,o[e]),i.logger.debug("[GPT-REGISTRY]: Set targeting. zoneTemplateId: ".concat(r,", gpt slot id: ").concat(n.getSlotElementId(),", key: ").concat(e,", value: ").concat(o[e]))})),this.logger.debug("[GPT-REGISTRY]: Applied targeting for ".concat(r," on newly added gpt slot - id: ").concat(n.getSlotElementId()))):this.logger.debug("[GPT-REGISTRY]: No template targeting set for zoneTemplateId: ".concat(r))}},{key:"purgeAll",value:function(){var e=this;Object.keys(this.slots).forEach((function(t){return e.purge(t)}))}},{key:"purge",value:function(t){t=e.getLCTemplateId(t);var n=(this.logger.debug("[GPT REGISTRY]: Purging ".concat(t)),this.slots[t]);n&&(this.destroySlotsFunc(n),delete this.slots[t],delete this.templateTargetings[t])}},{key:"purgeByElement",value:function(t,n){var i=this.getSlots(t)||[],r=i.find((function(e){return e.getSlotElementId()===n}));r?(this.destroySlotsFunc([r]),this.slots[e.getLCTemplateId(t)]=i.filter((function(e){return e.getSlotElementId()!==n}))):this.logger.warn("[GPT-REGISTRY]: No slot found for key: ".concat(t," code: ").concat(n))}},{key:"getSlotsLength",value:function(){return Object.keys(this.slots).length}},{key:"getSlots",value:function(t){return t&&"string"==typeof t&&Array.isArray(this.slots[e.getLCTemplateId(t)])?this.slots[e.getLCTemplateId(t)]:[]}},{key:"addTemplateTargetings",value:function(t,n,i){t=e.getLCTemplateId(t),this.templateTargetings[t]||(this.templateTargetings[t]={}),this.templateTargetings[t][n]=i}},{key:"getTemplateTargetings",value:function(t){return t=e.getLCTemplateId(t),this.templateTargetings[t]||null}},{key:"setSlotTargetingById",value:function(e,t,n){var i=this;this.addTemplateTargetings(e,t,n),this.logger.debug("[GPT-REGISTRY]: Template targeting set. zoneTemplateId: ".concat(e,", key: ").concat(t,", value: ").concat(JSON.stringify(n))),this.getSlots(e).forEach((function(r){try{r.setTargeting(t,n),i.logger.debug("[GPT-REGISTRY]: Applied template targetings. slot id: ".concat(r.getSlotElementId(),", key: ").concat(t,", value: ").concat(JSON.stringify(n)))}catch(r){r instanceof Error?i.logger.error("[GPT-REGISTRY]: Error occurred while individually setTargeting for slot ".concat(e,"."),r.message,r.stack):i.logger.error("[GPT-REGISTRY]: Error of unexpected type occurred while individually setTargeting for slot ".concat(e,"."))}}))}}],[{key:"getLCTemplateId",value:function(e){return e.toLowerCase()}}]),e}(),Bn=new(function(){function e(){t(this,e)}return i(e,[{key:"getGptSlotRegistry",value:function(){return this.gptSlotRegistry||(this.gptSlotRegistry=new Nn(I.getLogger(),Yt)),this.gptSlotRegistry}}]),e}()),zn=function(){function e(n,i,r,o){var s=this;t(this,e),this.logger=n,this.reporter=i,this.events=r,this.componentState=o,this.state={tag_initialised:!1,on_low_dwell_page:!1},this.bidLibrariesCutoffMs=1e3,this.bidLibrariesCutoff=!1,r.onComponentInitEvent.subscribe((function(e){"gpt"===e.component&&"ready"===e.state._tag&&!1===s.bidLibrariesCutoff&&setTimeout((function(){s.bidLibrariesCutoff=!0,s.logger.info("[FUSE][INIT] Bid libraries cutoff by timeout ".concat(s.bidLibrariesCutoffMs,"ms")),s.checkAndTrigger()}),s.bidLibrariesCutoffMs),s.checkAndTrigger()}))}return i(e,[{key:"getInitStatus",value:function(){var e=this.getComponentState("cmp"),t=this.getComponentState("docReadyScan");return{cmpOk:"ready"===e||"disabled"===e,docReady:"ready"==t||"disabled"===t,anyBidLibraryReady:this.isAnyBidLibraryReady()}}},{key:"isReadyForInit",value:function(){var e=this.getInitStatus();return 0===Object.values(e).filter((function(e){return!e})).length}},{key:"checkAndTrigger",value:function(){b(this.firedInitReady)&&this.isReadyForInit()&&(this.reporter.setStateStatus("initmanager_fired_auction_ready"),this.firedInitReady=this.reporter.getElapsedTime(),this.events.onInitManagerReady.emit({eventType:"onInitManagerReady"}))}},{key:"getComponentState",value:function(e){return this.componentState.state[e]._tag}},{key:"isComponentReady",value:function(e){return"ready"===this.getComponentState(e)}},{key:"isAnyBidLibraryReady",value:function(){var e,t,n;return"disabled"!==this.getComponentState("yandex")?this.isComponentReady("yandex"):(e=this.getComponentState("prebid"),t=this.getComponentState("uam"),n=["ready","disabled"],this.bidLibrariesCutoff||n.includes(e)&&n.includes(t))}},{key:"setTagInitialised",value:function(){this.state.tag_initialised=!0}},{key:"isTagInitialised",value:function(){return this.state.tag_initialised}},{key:"setIsLowDwellPage",value:function(e){this.state.on_low_dwell_page=e}},{key:"isLowDwellPage",value:function(){return this.state.on_low_dwell_page}}]),e}(),Fn=new(function(){function e(){t(this,e)}return i(e,[{key:"getInitManager",value:function(){return this.initManager||(this.initManager=new zn(I.getLogger(),mt.getReporter(),Ye,mt.getComponentStatusStore())),this.initManager}}]),e}()),Gn=I.getLogger(),Un=[];function Wn(){var e;Gn.info("[TARGETING] Clearing page targeting"),e=Un,Nt((function(){e.forEach((function(e){ht.pubads().clearTargeting(e.key)}))})),Un=[]}function jn(e,t){var n=-1;Un.forEach((function(t,i){-1===n&&t.key===e&&(n=i)})),Gn.info("[TARGETING]: Updating custom targeting for [key: ".concat(e,", value: ").concat(t,"]")),-1<n?Un[n].value=t:Un.push({key:e,value:t}),Ft(e,t)}var Hn=function(){function e(n,i,r,o,s){t(this,e),this.logger=n,this.context=i,this.rootCondition=r,this.api=o,this.onSatisfiedCB=s,this.firedCallback=!1}return i(e,[{key:"enableTriggers",value:function(){this.rootCondition.enableTriggers(this.api)}},{key:"destroy",value:function(){this.rootCondition.destroyTriggers()}},{key:"checkCondition",value:function(){return this.rootCondition.checkCondition()}},{key:"checkAndFire",value:function(){this.firedCallback||this.rootCondition.checkCondition()&&(this.logger.info("[ACTIVATOR][".concat(this.context,"]: Conditions are satisfied. Destroying triggers and invoking callback")),this.rootCondition.destroyTriggers(),this.firedCallback=!0,this.onSatisfiedCB(this.context))}}]),e}(),Vn=function(){function e(){t(this,e),this.name="AlwaysTrue"}return i(e,[{key:"check",value:function(){return!0}},{key:"buildTriggers",value:function(e){return[]}}]),e}(),qn=function(){function e(){t(this,e),this.name="AlwaysFalse"}return i(e,[{key:"check",value:function(){return!1}},{key:"buildTriggers",value:function(e){return[]}}]),e}(),Zn=function(){function e(n){t(this,e),this.conditions=n,this.name="AndCondition"}return i(e,[{key:"buildTriggers",value:function(e){return[]}},{key:"check",value:function(){return this.conditions.reduce((function(e,t){return e&&t.checkCondition()}),!0)}}]),e}(),Yn=function(){function e(n){t(this,e),this.conditions=n,this.name="OrCondition"}return i(e,[{key:"buildTriggers",value:function(e){return[]}},{key:"check",value:function(){return this.conditions.reduce((function(e,t){return e||t.checkCondition()}),!1)}}]),e}(),Qn=function(){o(n,Xe);var e=u(n);function n(i){return t(this,n),e.call(this,i,i.api.events.onWindowResized,(function(e){return!e.crossedBp}))}return i(n)}(),Jn=function(){function e(n,i,r,o,s){t(this,e),this.id=n,this.condition=i,this.api=r,this.activatorCallback=o,this.logger=s,this.triggers=null,this.satisfied=!1}return i(e,[{key:"checkCondition",value:function(){return this.checkConditionAndNotify(!1)}},{key:"checkConditionAndNotify",value:function(e){if(!this.satisfied){try{this.satisfied=this.condition.check(this.id,this.api)}catch(e){return k(e),this.logger.warn("[CONDITION][".concat(this.condition.name,"][").concat(this.id,"]: Caught exception while checking condition"),e.message,e.stack),!1}this.satisfied&&e&&this.activatorCallback()}return this.satisfied}},{key:"destroyTriggers",value:function(){return e.visitConditions(this,(function(e){e.triggers&&e.triggers.forEach((function(e){e.destroy()}))}))}},{key:"enableTriggers",value:function(t){var n=this;return e.visitConditions(this,(function(e){var i=e.condition,r={id:n.id,api:t,logger:n.logger,onTriggeredCB:function(){return e.checkConditionAndNotify(!0)}};e.triggers=[].concat(l(i.buildTriggers(r)),[new Qn(r)])}))}}],[{key:"visitConditions",value:function(t,n){var i=t.condition;if(i instanceof Zn||i instanceof Yn)i.conditions.forEach((function(t){return e.visitConditions(t,n)}));else try{n(t)}catch(e){k(e),t.logger.warn("[CONDITION][".concat(i.name,"][").concat(t.id,"]: Caught exception while visiting condition:"),e.message,e.stack)}}}]),e}(),Kn=function(){function e(n){t(this,e),this.logger=n,this.internalConditions={AlwaysTrue:function(){return new Vn},AlwaysFalse:function(){return new qn}},this.conditions={}}return i(e,[{key:"buildActivator",value:function(e,t,n,i){e=this.buildCondition(t,e,n,(function(){return r.checkAndFire()}));var r=new Hn(this.logger,t,e,n,i);return r}},{key:"registerCondition",value:function(e,t){if(this.conditions[e])throw Error("Condition with ".concat(e," already registered"));this.conditions[e]=t}},{key:"buildCondition",value:function(e,t,n,i){var r=t.type;switch(r){case"and":return this.buildBooleanCondition(e,t,n,i,(function(e){return new Zn(e)}));case"or":return this.buildBooleanCondition(e,t,n,i,(function(e){return new Yn(e)}));case"condition":case"custom-condition":return this.buildTriggerCondition(e,t,n,i);default:y(r)}}},{key:"buildTriggerCondition",value:function(e,t,n,i){var r;return this.internalConditions[t.name]?new Jn(e,this.internalConditions[t.name](),n,i,this.logger):(r=this.conditions[t.name])?(r=new r(null!=(r=t.params)?r:{}),new Jn(e,r,n,i,this.logger)):(this.logger.error("[CONDITION-FACTORY]: Could not find condition ".concat(t.name,", it will be deemed false")),this.buildAlwaysFalseCondition(e,n,i))}},{key:"buildAlwaysFalseCondition",value:function(e,t,n){return new Jn(e,new qn,t,n,this.logger)}},{key:"buildBooleanCondition",value:function(e,t,n,i,r){var o=this;return(t=t.subConditions)&&0!==t.length?(r=r(t.map((function(t){return o.buildCondition(e,t,n,i)}))),new Jn(e,r,n,i,this.logger)):(this.logger.error("[CONDITION-FACTORY]: Boolean condition with no sub-conditions"),this.buildAlwaysFalseCondition(e,n,i))}}]),e}(),Xn="AbsoluteScrollDistance",$n=function(){function e(n){t(this,e),this.params=n,this.name=Xn}return i(e,[{key:"buildTriggers",value:function(e){return[new Qe(e)]}},{key:"check",value:function(e,t){return t.getWindow().scrollY>=((null==(t=this.params)?void 0:t.pixelsDistance)||0)}}]),e}(),ei="BreakpointMatch",ti=function(){function e(n){t(this,e),this.params=n,this.name=ei}return i(e,[{key:"buildTriggers",value:function(e){return[]}},{key:"check",value:function(t,n){n=n.viewportInfo.getCurrentBreakpoint().name;var i=!("gte"in this.params)||e.compareBp(this.params.gte,n,"gte");n=!("lte"in this.params)||e.compareBp(this.params.lte,n,"lte");return i&&n}}],[{key:"compareBp",value:function(e,t,n){return e=this.BpOrder[e],t=this.BpOrder[t],"gte"===n?e<=t:t<=e}}]),e}(),ni=(ti.BpOrder={xs:1,s:2,m:3,l:4,xl:5},function(){function e(n){t(this,e),this.window=n.api.viewportInfo.browserWindow,this.triggeredCB=n.onTriggeredCB,document.addEventListener("readystatechange",this.triggeredCB)}return i(e,[{key:"destroy",value:function(){this.window.removeEventListener("readystatechange",this.triggeredCB)}}]),e}()),ii="DocumentStatus",ri=function(){function e(n){t(this,e),this.params=n,this.name=ii}return i(e,[{key:"buildTriggers",value:function(e){return[new ni(e)]}},{key:"check",value:function(e,t){return-1!==this.params.state.indexOf(document.readyState)}}]),e}(),oi=function(){function e(n,i){t(this,e),this.ctx=n,this.intervalMs=i,this.intervalId=setInterval(this.ctx.onTriggeredCB,this.intervalMs)}return i(e,[{key:"destroy",value:function(){clearInterval(this.intervalId)}}]),e}(),si="DomElementExists",ai=function(){function e(n){t(this,e),this.params=n,this.name=si}return i(e,[{key:"buildTriggers",value:function(e){return[new oi(e,250)]}},{key:"check",value:function(e,t){return null!==document.querySelector(this.params.selector)}}]),e}(),ui="PageCount",ci=function(){function e(n){t(this,e),this.params=n,this.name=ui,this.hasChecked=!1,this.isOver=!1}return i(e,[{key:"buildTriggers",value:function(e){return[]}},{key:"check",value:function(t,n){var i;return this.hasChecked||(e.incrementPageCount(t,n.getWindow()),this.hasChecked=!0,i=e.getPageCount(t,n.getWindow()),this.isOver=i>=((null==(i=this.params)?void 0:i.pageCount)||1),this.isOver&&e.resetPageCount(t,n.getWindow())),this.isOver}}],[{key:"getCountKey",value:function(e){return"fuse-page-views-".concat(e)}},{key:"getPageCount",value:function(t,n){return Number(n.sessionStorage.getItem(e.getCountKey(t))||0)}},{key:"incrementPageCount",value:function(t,n){n.sessionStorage.setItem(e.getCountKey(t),"".concat(this.getPageCount(t,n)+1))}},{key:"resetPageCount",value:function(t,n){n.sessionStorage.setItem(e.getCountKey(t),"0")}}]),e}(),li="UrlRegex",di=function(){function e(n){t(this,e),this.params=n,this.name=li}return i(e,[{key:"buildTriggers",value:function(e){return[]}},{key:"check",value:function(e,t){return S(t=t.getWindow().location.toString().match(this.params.regex))&&0<t.length}}]),e}(),gi="WindowHeightDistance",hi=function(){function e(n){t(this,e),this.params=n,this.name=gi}return i(e,[{key:"buildTriggers",value:function(e){return[new Qe(e)]}},{key:"check",value:function(e,t){return(t=t.getWindow()).scrollY>=t.innerHeight*((null==(t=this.params)?void 0:t.windowHeightDistance)||0)}}]),e}(),fi="WindowValue",pi=function(){function e(n){t(this,e),this.params=n,this.name=fi}return i(e,[{key:"buildTriggers",value:function(){return[]}},{key:"check",value:function(e,t){return t.viewportInfo.browserWindow[this.params.name]===this.params.value}}]),e}(),vi="LocalStorageValue",bi=function(){function e(n){t(this,e),this.params=n,this.name=vi}return i(e,[{key:"buildTriggers",value:function(){return[]}},{key:"check",value:function(e,t){return t.viewportInfo.browserWindow.localStorage.getItem(this.params.name)===this.params.value}}]),e}(),mi="MetaTagProperty",Si=function(){function e(n){t(this,e),this.params=n,this.name=mi,this.metaTagKey=n.metaTagKey,this.metaTagValues=n.metaTagValues}return i(e,[{key:"buildTriggers",value:function(){return[]}},{key:"check",value:function(e,t){return!b(t=t.viewportInfo.browserWindow.document.querySelector('meta[name="'.concat(this.metaTagKey,'"]')))&&this.metaTagValues.includes(t.getAttribute("content"))}}]),e}();function yi(e,t){return Boolean(Ti(e,t)||(null==(t=null==(t=t.purpose)?void 0:t.legitimateInterests)?void 0:t[e]))}var ki,Ii,Ci=new(function(){function e(n){t(this,e),this.logger=n,this.slotConditionFactory=null,this.insertConditionFactory=null}return i(e,[{key:"getSlotConditionFactory",value:function(){var e;return this.slotConditionFactory||(this.slotConditionFactory=new Kn(this.logger),(e=this.slotConditionFactory).registerCondition(Xn,$n),e.registerCondition(ei,ti),e.registerCondition(si,ai),e.registerCondition(Je,Ke),e.registerCondition(et,tt),e.registerCondition(ui,ci),e.registerCondition(li,di),e.registerCondition(gi,hi),e.registerCondition(fi,pi),e.registerCondition(vi,bi),e.registerCondition(mi,Si)),this.slotConditionFactory}},{key:"getInsertConditionFactory",value:function(){var e;return this.insertConditionFactory||(this.insertConditionFactory=new Kn(this.logger),(e=this.insertConditionFactory).registerCondition(ii,ri),e.registerCondition(Xn,$n),e.registerCondition(ei,ti),e.registerCondition(gi,hi),e.registerCondition(li,di),e.registerCondition(si,ai),e.registerCondition(ui,ci),e.registerCondition(fi,pi),e.registerCondition(vi,bi),e.registerCondition(mi,Si)),this.insertConditionFactory}}]),e}())(I.getLogger()),Ei=function(){function e(n,i,r){t(this,e),this.logger=n,this.browserWindow=i,this.reporter=r}return i(e,[{key:"load",value:function(e){switch(this.reporter.setStateStatus("cmp_load_quantcast_start"),e.partner){case"quantcast":return this.loadQuantcast();case"cookiebot":return this.loadCookieBot(e.domainGroupId);case"fundingchoices":return void this.logger.log("[CMP]: Funding Choices CMP provider selected no external script required")}}},{key:"loadQuantcast",value:function(){this.logger.log("[CMP]: Loading Quantcast CMP provider");var e=this,t=this.browserWindow.document.location.hostname,n=this.browserWindow.document.createElement("script"),i=this.browserWindow.document.getElementsByTagName("script")[0],r=this.browserWindow.document.getElementsByTagName("head")[0]||this.browserWindow.document.documentElement,o="https://cmp.quantcast.com".concat("/choice/","PRrmquD1Ggcb1","/",t,"/choice.js?tag_version=V2"),s=new XMLHttpRequest;s.onreadystatechange=function(){4===this.readyState&&(n.async=!0,n.type="text/javascript",200===this.status?n.src=o:e.logger.error("GET call to CMP script with ".concat(t," responed with the status code - ").concat(this.status)),null!=i&&i.parentNode?i.parentNode.insertBefore(n,i):(e.logger.debug("First script element not fully initialised, falling back to head-based insertion"),r.insertBefore(n,r.firstChild)),e.logger.log("[CMP]: Added Quantcast script to document"))},this.logger.log("[CMP]: Opening Quantcast URL"),s.open("GET",o,!0),s.send()}},{key:"loadCookieBot",value:function(e){var t=this;this.logger.log("[CMP]: Loading Cookie Bot - ".concat(e)),P({name:"CookieBot",url:"//consent.cookiebot.com/",file:"uc.js",insertSelector:"head",attributes:{"data-cbid":e,"data-blockingmode":"auto","data-framework":"IAB"}},(function(){t.logger.log("[CMP]: Cookie Bot script loaded")}))}}]),e}(),wi=function(){function n(e,i){t(this,n),this.logger=e,this.browserWindow=i}return i(n,[{key:"generate",value:function(){this.createStubFunctionV2()}},{key:"createStubFunctionV2",value:function(){var t=this;t.logger.debug("[CMP]: Generating V2 stub");for(var n="__tcfapiLocator",i=[],r=t.browserWindow,o=void 0,s=r;s;){try{if(s.frames[n]){o=s,t.logger.debug("[CMP] Found locator frame");break}}catch(o){"{}"!==JSON.stringify(o)&&t.logger.log("[CMP]:",JSON.stringify(o))}if(s===t.browserWindow.top)break;s=s.parent}o||(t.logger.debug("[CMP] Locator frame not found"),function e(){var i,o=r.document,s=!!r.frames[n];return s?t.logger.debug("[CMP] Found existing version 2 stub"):(t.logger.debug("[CMP] Version 2 stub not found - generating"),o.body?((i=o.createElement("iframe")).style.cssText="display:none",i.name=n,o.body.appendChild(i)):setTimeout(e,5)),!s}(),r.__tcfapi=function(){var t=arguments,n=void 0;if(!t.length)return i;"setGdprApplies"===t[0]?3<t.length&&2===t[2]&&"boolean"==typeof t[3]&&(n=t[3],"function"==typeof t[2])&&t[2]("set",!0):"ping"===t[0]?"function"==typeof t[2]&&t[2]({gdprApplies:n,cmpLoaded:!1,cmpStatus:"stub"}):(n="init"===t[0]&&"object"===e(t[3])?[t[0],t[1],t[2],Object.assign(t[3],{tag_version:"V2"})].concat(Array.from(t).slice(4)):t,i.push(n))},r.addEventListener("message",(function(e){var n="string"==typeof e.data,i=void 0;try{i=n?JSON.parse(e.data):e.data}catch(i){"{}"!==JSON.stringify(i)&&t.logger.error("[CMP]:",JSON.stringify(i))}var r=null==i?void 0:i.__tcfapiCall;r&&t.browserWindow.__tcfapi(r.command,r.version,(function(t,i){t={__tcfapiReturn:{returnValue:t,success:i,callId:r.callId}},e&&e.source&&e.source.postMessage&&e.source.postMessage(n?JSON.stringify(t):t,"*")}),r.parameter)}),!1))}}]),n}(),Ti=function(e,t){var n;return(null==(n=null==(n=t.purpose)?void 0:n.consents)?void 0:n[e])||(null==(n=t.purposeConsents)?void 0:n[e])},_i=function(){function e(n,i,r){t(this,e),this.logger=n,this.consentUIPrompt=r,this.uspTries=0,this.uspTriesLimit=3,this.callCount=-1,this.browserWindow=i,this.createUspStub()}return i(e,[{key:"checkForCCPA",value:function(e){var t=this;this.browserWindow.Cookiebot?(this.logger.log("[CMP-v2]: Checking CCPA with cookiebot"),this.browserWindow.Cookiebot.regulations.ccpaApplies?(this.logger.log("[CMP-V2]: CCPA Region from Cookiebot"),this.browserWindow.__uspapi("getUSPData",1,(function(n,i){if(!i)return t.logger.log("[CMP-V2]: Failed retrieving USP data use default instead"),e({applies:!0,privacyString:"1---"});e({applies:!0,privacyString:n.uspString})}))):e({applies:!1})):this.browserWindow.__uspapi("uspPing",1,(function(n,i){i&&n.mode.includes("USP")&&n.jurisdiction.includes(n.location.toUpperCase())?(t.logger.log("[CMP-V2]: CCPA Region"),t.browserWindow.__uspapi("setUspDftData",1,(function(n,i){t.logger.log("[CMP-V2]: Setting up data for USP API",JSON.stringify(n),i),t.browserWindow.__uspapi("getUSPData",1,(function(n,i){if(!i)return t.logger.log("[CMP-V2]: Failed retrieving USP data use default instead"),e({applies:!0,privacyString:"1---"});e({applies:!0,privacyString:n.uspString})}))}))):e({applies:!1})}))}},{key:"setGDPRConsentPrompt",value:function(){var e=this;this.consentUIPrompt.setup("Privacy Settings",(function(){e.browserWindow.__tcfapi("displayConsentUi",2,(function(){return e.logger.log("[CMP-V2]: GDPR Consent UI displayed")}))}))}},{key:"setCCPAConsentPrompt",value:function(){var e=this;this.consentUIPrompt.setup("Do Not Sell My Data",(function(){e.browserWindow.__uspapi("displayUspUi")}))}},{key:"cmpLoaded",value:function(e){var t=!1;setTimeout((function(){if(!t)return e(!1)}),1e3),this.browserWindow.__tcfapi("ping",2,(function(n){return t=!0,null!=n&&n.cmpLoaded?e(!0):e(!1)}))}},{key:"getConsentData",value:function(e){var t=this;this.browserWindow.__tcfapi("getTCData",2,(function(n,i){return t.callCount++,i&&n?b(n.gdprApplies)||"loading"===(null==(i=null==n?void 0:n.cmpStatus)?void 0:i.toLowerCase())||n.gdprApplies&&b(null==n?void 0:n.eventStatus)?(t.logger.log("[CMP-V2]: GDPR not yet determined"),e({dataAvailable:!0,gdprApplies:void 0,cmpStatus:null==n?void 0:n.cmpStatus,eventStatus:null==n?void 0:n.eventStatus})):!1===n.gdprApplies?e({dataAvailable:!0,gdprApplies:!1,cmpStatus:null==n?void 0:n.cmpStatus,eventStatus:null==n?void 0:n.eventStatus}):!0===n.gdprApplies?t.handleGdprApplies(n,e):void t.logger.warn("[CMP-V2]: Unexpected gdprApplies status. Data: ".concat(JSON.stringify(n))):(t.logger.warn("[CMP-V2]: Failed to get TCData"),e({dataAvailable:!1,cmpStatus:null==n?void 0:n.cmpStatus,eventStatus:null==n?void 0:n.eventStatus}))}))}},{key:"handleGdprApplies",value:function(e,t){var n,i,r,o,s,a,u,c,l,d,g=e.eventStatus.toLowerCase();return"useractioncomplete"===g||"tcloaded"===g?(n=Ti(1,e),i=Ti(3,e),r=Ti(4,e),o=yi(2,e),s=yi(7,e),a=yi(9,e),u=yi(10,e),l=!b(n),d=!b(i),c=!b(i),d=(l=l&&d&&c)&&n&&i&&r&&o&&s&&a&&u,this.logger.debug("[CMP-V2]: Consents available: ".concat(l,", Consent: ").concat(d," Data: ").concat(JSON.stringify(e))),t({dataAvailable:!0,gdprChoiceReceived:!0,personalisedAdsConsent:d,gdprApplies:!0,cmpStatus:null==e?void 0:e.cmpStatus,eventStatus:null==e?void 0:e.eventStatus})):("cmpuishown"===g||this.callCount%8==0&&this.logger.warn("[CMP-V2]: Unexpected eventStatus. Data: ".concat(JSON.stringify(e))),t({dataAvailable:!0,gdprChoiceReceived:!1,gdprApplies:!0,cmpStatus:null==e?void 0:e.cmpStatus,eventStatus:null==e?void 0:e.eventStatus}))}},{key:"createUspStub",value:function(){function e(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.warn("[CMP-V2] USP is still in stub mode. Calling to ".concat(t[0]," API will be unsuccessful")),"function"==typeof t[2]&&t[2](void 0,!1)}var t,n=this,i=this.logger,r=this.browserWindow;void 0===r.__uspapi&&(r.__uspapi=e,t=setInterval((function(){n.uspTries++,r.__uspapi!==e?(i.debug("[CMP-V2]: USP stub function has been replaced"),clearInterval(t)):n.uspTries<n.uspTriesLimit?i.debug("[CMP-V2]: USP stub function has NOT been replaced, will retry"):(i.warn("[CMP-V2]: USP stub function has NOT been replaced, but the timeout has been reached"),clearInterval(t))}),300))}}]),e}(),Ai=function(){function e(n,i,r,o,s,a,u){t(this,e),this.logger=i,this.reporter=r,this.stubFunctionsGenerator=o,this.consentUIPrompt=s,this.componentStateStore=a,this.settings=u,this.cmpLoadCounter=0,this.dialogShown=!1,this.browserWindow=n}return i(e,[{key:"enable",value:function(){this.componentStateStore.updateState("cmp",z(this.reporter.getElapsedTime())),this.generateStubs(),this.loadVersion()}},{key:"generateStubs",value:function(){this.settings.getCmpSkipStub()?this.logger.log("[CMP]: Skipping stubs"):this.stubFunctionsGenerator.generate()}},{key:"loadVersion",value:function(){this.reporter.setStateStatus("cmp_load_wait_start"),this.logger.info("[CMP]: Wait for CMP to load"),this.checkForVersion2()}},{key:"versionLoader",value:function(e){var t=this,n=e.found;e=e.versionNumber;S(this.version)?this.logger.warn("[CMP]: Version already loaded: ".concat(e)):n?2===e?(this.reporter.setStateStatus("cmp_load_wait_finish"),this.reporter.reportCmpLoadFinish(),this.logger.debug("[CMP]: Loaded version ".concat(e)),this.version=new _i(this.logger,this.browserWindow,this.consentUIPrompt),this.handleCmpLoaded()):(this.logger.error("[CMP]: Version ".concat(e," is not supported, disabling personalisation")),this.setDetermination("none",!0,!0)):(++this.cmpLoadCounter%10==0&&this.logger.debug("[CMP] Waiting for load"),setTimeout((function(){return t.checkForVersion2()}),50))}},{key:"checkForVersion2",value:function(){var e=this;if(this.settings.getCmpSkipStub()&&!this.browserWindow.__tcfapi)return this.logger.log("[CMP]: Stub function not setup yet"),this.versionLoader({found:!1,versionNumber:2});this.browserWindow.__tcfapi("ping",null,(function(t,n){var i=t.cmpLoaded;i&&e.browserWindow.Cookiebot&&!e.browserWindow.Cookiebot.userCountry&&(e.logger.log("[CMP]: CookieBot ping response when no user country: ".concat(n," - ").concat(JSON.stringify(t))),i=!1),e.versionLoader({found:i,versionNumber:2})}))}},{key:"checkForCCPA",value:function(e){var t;null!=(t=this.version)&&t.checkForCCPA(e)}},{key:"cmpLoaded",value:function(e){if(!S(this.version))return e(!1);this.version.cmpLoaded(e)}},{key:"getConsentData",value:function(e){var t;null!=(t=this.version)&&t.getConsentData(e)}},{key:"setGDPRConsentPrompt",value:function(){var e;null!=(e=this.version)&&e.setGDPRConsentPrompt()}},{key:"setCCPAConsentPrompt",value:function(){var e;null!=(e=this.version)&&e.setCCPAConsentPrompt()}},{key:"setNonPrivacyRegionsPrompt",value:function(){this.consentUIPrompt.setup("You are outside the CCPA jurisdiction.")}},{key:"handleGdprNotApplies",value:function(){var e,t=this,n=(this.logger.info("[CMP]: GDPR does not apply"),!1);setTimeout((function(){n||(n=!0,t.reporter.setStateStatus("cmp_check_for_ccpa_timeout"),t.logger.warn("[CMP]: USP API is not responding, continue as if not in CCPA region"),t.setDetermination("none",!0,!0))}),2e3),this.reporter.setStateStatus("cmp_check_for_ccpa_start"),this.checkForCCPA((function(i){var r=i.applies;i=i.privacyString;n?t.logger.warn("[CMP]: Got CCPA response, but timeout already reached"):(n=!0,t.reporter.setStateStatus("cmp_check_for_ccpa_finish"),r?(t.setCCPAConsentPrompt(),e="Y"===(null==i?void 0:i[2].toUpperCase()),t.logger.info("[CMP]: CCPA applies. disablePersonalisation: ".concat(e)),t.setDetermination("ccpa",!e,!1)):(t.logger.info("[CMP]: Not in CCPA region, continue with personalisation"),t.setNonPrivacyRegionsPrompt(),t.setDetermination("none",!0,!1)))}))}},{key:"handleGdprApplies",value:function(){var e=this,t=(this.logger.log("[CMP]: GDPR applies, checking if personalisation is allowed"),this.reporter.setStateStatus("cmp_gdpr_choice_wait_start"),this.setGDPRConsentPrompt(),!1);this.getConsentData((function(n){var i,r,o=n.gdprChoiceReceived;n=n.personalisedAdsConsent;o&&(t=!0,e.reporter.setStateStatus("cmp_gdpr_choice_wait_finish"),e.logger.info("[CMP]: GDPR decision received via short-circuit. Allow personalisation: ".concat(n)),e.setDetermination("gdpr",Boolean(n),!1)),t||(e.dialogShown=!0,e.reporter.setStateStatus("cmp_prompt_shown"),i=0,r=setInterval((function(){e.getConsentData((function(n){var o=n.gdprChoiceReceived,s=n.personalisedAdsConsent,a=n.cmpStatus;n=n.eventStatus;o?(t=!0,e.reporter.setStateStatus("cmp_gdpr_choice_wait_finish"),e.logger.info("[CMP]: GDPR decision received. Allow personalisation: ".concat(s)),clearInterval(r),e.setDetermination("gdpr",Boolean(s),!1)):++i%10==0&&e.logger.info("[CMP]: Waiting for GDPR personalisation choice. cmpStatus: ".concat(a,", eventStatus: ").concat(n))}))}),100))}))}},{key:"handleCmpLoaded",value:function(){function e(e){t.reporter.setStateStatus("cmp_gdpr_applies_check_finish"),!1===e?t.handleGdprNotApplies():t.settings.isRequestGdprPersonalisation()?t.handleGdprApplies():(t.reporter.setStateStatus("cmp_gdpr_choice_wait_finish"),t.logger.info("[CMP]: The GDPR applies, but we will assume they do not allow personalisation (show limited ads)"),t.setDetermination("gdpr",!1,!1))}var t=this;this.logger.info("[CMP]: Checking if the GDPR applies"),this.reporter.setStateStatus("cmp_gdpr_applies_check_start"),this.getConsentData((function(n){var i,r,o;b(n=n.gdprApplies)?(i=0,t.logger.debug("[CMP]: Setting a check interval of ".concat(250,"ms")),r=!1,o=setInterval((function(){t.getConsentData((function(n){b(n=n.gdprApplies)?i++%4==0&&t.logger.info("[CMP]: Waiting for GDPR determination"):(clearInterval(o),r||(r=!0,e(n)))}))}),250)):(t.logger.debug("[CMP]: GDPR status already available, processing immediately"),e(n))}))}},{key:"setDetermination",value:function(e,t,n){var i=this.componentStateStore.state.cmp._tag;"gdpr"===e&&this.reporter.reportCmpGdprDetermined(),"loading"==i?(e={jurisdiction:e,timeout:n,allowPersonalisation:t,dialogShown:this.dialogShown},this.logger.info("[CMP]: Determination: ".concat(JSON.stringify(e))),n=this.reporter.getElapsedTime(),this.componentStateStore.updateState("cmp",F(this.componentStateStore.state.cmp,n,e))):this.logger.error("[CMP]: CMP in unexpected state: ".concat(i))}}]),e}(),Ri=function(){function e(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"div[data-fuse-privacy-tool]",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"fuse-privacy-tool";t(this,e),this.browserWindow=n,this.domSelector=i,this.elementId=r}return i(e,[{key:"setup",value:function(e,t){var n,i=this.browserWindow.document.querySelector(this.domSelector);i&&(t?((n=document.createElement("a")).href="javascript:void(0)",n.id=this.elementId,n.innerHTML=e,n.addEventListener("click",t),i.appendChild(n)):i.textContent=e)}}]),e}(),xi=function(){function e(n,i){t(this,e),this.logger=n,this.tcData={cmpStatus:"loaded",eventStatus:"tcloaded",tcfPolicyVersion:2,cmpVersion:44,cmpId:10},this._listenerId=1,this.browserWindow=i,this.allowedOrigin=i.document.referrer?new URL(i.document.referrer).origin:""}return i(e,[{key:"load",value:function(){var e=this;this.browserWindow.__tcfapi=function(t,n,i,r){switch(t){case"ping":return e._handlePing(i);case"getTCData":return e._handleGetTCData(i);case"addEventListener":e.logger.log("[CMP]: Add Event Listener command does nothing. Listener ID: ".concat(e._listenerId));var o=Object.assign(Object.assign({},e.tcData),{listenerId:e._listenerId});return e._listenerId++,i(o,!0);case"removeEventListener":return e.logger.log("[CMP]: Remove Event Listener command does nothing. Listener ID: ".concat(r)),i(Object.assign({},e.tcData),!0);default:return e.logger.log("[CMP]: Unsupported command: ".concat(t)),i({},!1)}},this.browserWindow.addEventListener("message",(function(t){e.allowedOrigin&&t.origin!==e.allowedOrigin?e.logger.log("[CMP]: Ignoring message from origin ".concat(t.origin)):"set-tc-data"===t.data.type?e.tcData=Object.assign({},t.data.data):e.logger.log("[CMP]: unknown iframe message: ".concat(null==(t=t.data)?void 0:t.type))}))}},{key:"_handlePing",value:function(e){e({cmpLoaded:!0,cmpStatus:this.tcData.cmpStatus,cmpVersion:this.tcData.cmpVersion,displayStatus:"disabled",apiVersion:"2",cmpId:this.tcData.cmpId,gdprApplies:this.tcData.gdprApplies})}},{key:"_handleGetTCData",value:function(e){e(Object.assign({},this.tcData),!0)}}]),e}(),Pi=new(function(){function e(){t(this,e)}return i(e,[{key:"getStubFunctionsGenerator",value:function(){return this.stubFunctionsGenerator||(this.stubFunctionsGenerator=new wi(I.getLogger(),I.getBrowserWindowObject())),this.stubFunctionsGenerator}},{key:"getConsentManager",value:function(){return this.consentManager||(this.consentManager=new Ai(I.getBrowserWindowObject(),I.getLogger(),mt.getReporter(),this.getStubFunctionsGenerator(),new Ri(I.getBrowserWindowObject()),mt.getComponentStatusStore(),bt.getSettings())),this.consentManager}},{key:"getCmpProviderLoader",value:function(){return this.cmpProviderLoader||(this.cmpProviderLoader=new Ei(I.getLogger(),I.getBrowserWindowObject(),mt.getReporter())),this.cmpProviderLoader}},{key:"getIframeCmpManager",value:function(){return this.iframeCmpManager||(this.iframeCmpManager=new xi(I.getLogger(),I.getBrowserWindowObject())),this.iframeCmpManager}}]),e}()),Di=function(){function e(){t(this,e)}return i(e,[{key:"code",value:function(){return"1---"}}]),e}(),Oi=function(){function e(n,i,r,o,s,a,u,c){t(this,e),this.pubId=n,this.adServer=i,this.logger=r,this.browserWindow=o,this.consentManager=s,this.reporter=a,this.gptPushFn=u,this.sco=c}return i(e,[{key:"loadAmazonUam",value:function(e,t,n,i,r,o){var s;function a(n,i){t[e]._Q.push([n,i])}t[e]||(t[e]={init:function(){a("i",arguments)},fetchBids:function(){a("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]},(s=n.createElement(i)).async=!0,s.src=r,"function"==typeof o&&(s.readyState?s.onreadystatechange=function(){"loaded"!==s.readyState&&"complete"!==s.readyState||(s.onreadystatechange=null,o())}:s.onload=function(){o()}),(r=n.getElementsByTagName(i)[0]).parentNode.insertBefore(s,r))}},{key:"load",value:function(e,t){var n=this;if(this.logger.debug("[UAM]: Loading script"),this.reporter.setStateStatus("uam_script_load_start"),this.loadAmazonUam("apstag",this.browserWindow,this.browserWindow.document,"script","//c.amazon-adsystem.com/aax2/apstag.js",(function(){n.reporter.setStateStatus("uam_script_load_finish"),n.init(e,t)})),!this.browserWindow.apstag)return this.logger.error("[INIT]: UAM script load failed.")}},{key:"init",value:function(e,t){var n=this;this.reporter.setStateStatus("uam_initialise_start"),this.browserWindow.apstag.init(this.getUamConfig(e),(function(){n.logger.info("[UAM]: Initialisation finished"),n.reporter.setStateStatus("uam_initialise_finish"),t()}))}},{key:"getUamConfig",value:function(e){var t={};return e||(t.gdpr={cmpTimeout:0}),!b(this.sco)&&Object.getOwnPropertyNames(this.sco).length&&(t.schain={ver:"1.0",complete:1,nodes:[{asi:this.sco.asi,sid:this.sco.sellerId,hp:1}]}),Object.assign({pubID:this.pubId,adServer:this.adServer},t)}},{key:"makeBids",value:function(e,t){var n=this;this.browserWindow.apstag.fetchBids({slots:e},(function(e){n.gptPushFn((function(){n.browserWindow.apstag.setDisplayBids(),t(e)}))}))}}]),e}(),Li=new(function(){function e(){t(this,e)}return i(e,[{key:"getCcpaPrivacyStringCoder",value:function(){return new Di}},{key:"getUamAdServer",value:function(){return"googletag"}},{key:"getUam",value:function(){var e;return this.uam||(e=bt.getSettings(),this.uam=new Oi(e.getUamSettings().pubID,Li.getUamAdServer(),I.getLogger(),I.getBrowserWindowObject(),Pi.getConsentManager(),mt.getReporter(),Nt,e.getSco())),this.uam}}]),e}()),Mi=function(){function e(n,i,r,o,s){t(this,e),this.logger=n,this.settings=i,this.viewportInfo=r,this.isLowDwellPage=o,this.componentStateStore=s,this.auctionCounter=0}return i(e,[{key:"plan",value:function(e,t){var n="".concat(++this.auctionCounter),i=this.viewportInfo.getCurrentBreakpoint().name,r=this.settings.getHbTimeout(i),o=this.isLowDwellPage(),s=this.settings.isUamEnabledAtBP(i),a=this.settings.isPrebidEnabledAtBP(i),u=(s||a||this.logger.debug("[PLANNER][".concat(n,"]: Headerbidding is not configured at breakpoint ").concat(i)),this.getMaxOffset(t)),c=(t=this.settings.getAuctionMaxSlots(),0<(t=(e=this.sortSlotsByViewport(n,e).filter((function(e){return e.zoneDiv.getBoundingClientRect().top<u})).slice(0,t)).filter((function(e){return e.allowHeaderBidding}))).length);return{auctionId:n,usePrebid:!o&&this.isUsePrebid(a,n,c),useUam:!o&&this.isUseUam(s,n,c),hbTimeout:r,hbSlots:t,breakpointName:i,slots:e}}},{key:"sortSlotsByViewport",value:function(e,t){t=t.sort((function(e,t){return e=e.zoneDiv.getBoundingClientRect(),t=t.zoneDiv.getBoundingClientRect(),e.top-t.top}));var n=t.map((function(e){return e.slotDivId}));return this.logger.debug("[PLANNER][".concat(e,"]: Slot priority order: ").concat(JSON.stringify(n))),t}},{key:"getMaxOffset",value:function(e){var t=(n=this.viewportInfo.getViewportStatus()).offset,n=n.innerHeight;return e?t.y+n+n*e:1/0}},{key:"isUseUam",value:function(e,t,n){var i="ready"===this.componentStateStore.state.uam._tag;return e&&!i?this.logger.info("[AUCTION][".concat(t,"]: UAM has not finished loading and will be excluded from the auction")):e&&!n&&this.logger.debug("[AUCTION][".concat(t,"]: UAM has been excluded from the auction because no headerbidding slots are enabled")),e&&i&&n}},{key:"isUsePrebid",value:function(e,t,n){var i="ready"===this.componentStateStore.state.prebid._tag;return e&&!i?this.logger.info("[AUCTION][".concat(t,"]: Prebid has not finished loading and will be excluded from the auction")):e&&!n&&this.logger.debug("[AUCTION][".concat(t,"]: Prebid has been excluded from the auction because no headerbidding slots are enabled")),e&&i&&n}}]),e}(),Ni=((Tr=ki=ki||{}).GPT_REQUEST="GPT_REQUEST",Tr.GPT_RESPONSE="GPT_RESPONSE",Tr.GPT_RENDERED="GPT_RENDERED",Tr.GPT_LOADED="GPT_LOADED",Tr.CANCELLED="CANCELLED",Tr.SUPERSEDED="SUPERSEDED",(Tr=Ii=Ii||{})[Tr.PREBID_REQUEST=0]="PREBID_REQUEST",Tr[Tr.PREBID_RESPONSE=1]="PREBID_RESPONSE",Tr[Tr.PREBID_SKIPPED=2]="PREBID_SKIPPED",Tr[Tr.UAM_REQUEST=3]="UAM_REQUEST",Tr[Tr.UAM_RESPONSE=4]="UAM_RESPONSE",Tr[Tr.UAM_SKIPPED=5]="UAM_SKIPPED",Tr[Tr.GPT_REQUEST=6]="GPT_REQUEST",Tr[Tr.CANCELLED=7]="CANCELLED",function(){function e(n,i){t(this,e),this.logger=n,this.reporter=i,this.auctions={},this.activeGptCalls={}}return i(e,[{key:"createNewAuction",value:function(e,t,n){this.auctions[e.auctionId]={started:this.reporter.getElapsedTime(),creativeDivIds:e.slots.map((function(e){return e.slotDivId})),slotNames:e.slots.map((function(e){return e.zoneTemplate.slot})),hbDivIds:e.hbSlots.map((function(e){return e.slotDivId})),uamIncluded:e.useUam,uamResponded:!1,uamSkipped:!1,prebidIncluded:e.usePrebid,prebidResponded:!1,prebidSkipped:!1,uamCancelled:!1,prebidCancelled:!1,gptRequestSent:!1,auctionPhaseCallback:t,slotStatus:e.slots.reduce((function(e,t){return Object.assign(Object.assign({},e),r({},t.slotDivId,{slotPhaseCallback:function(e){return n(t,e)}}))}),{})}}},{key:"getAuctionStatus",value:function(e){return this.auctions[e]}},{key:"getActiveGptCalls",value:function(){return Object.keys(this.activeGptCalls)}},{key:"getSlotStatus",value:function(e,t){return this.auctions[e].slotStatus[t]}},{key:"getSlotStatusInferredAuction",value:function(e,t){var n=this.activeGptCalls[e];if(n)return this.auctions[n].slotStatus[e];this.logger.debug("[AUCTION-STATUS][".concat(t,"]: Could not find active GPT call for ").concat(e))}},{key:"onPrebidRequest",value:function(e){(e=this.auctions[e]).prebidRequestTime=this.reporter.getElapsedTime(),e.auctionPhaseCallback(Ii.PREBID_REQUEST)}},{key:"onPrebidResponse",value:function(e){(e=this.auctions[e]).prebidResponseTime=this.reporter.getElapsedTime(),e.prebidResponded=!0,e.auctionPhaseCallback(Ii.PREBID_RESPONSE)}},{key:"onPrebidSkipped",value:function(e){(e=this.auctions[e]).prebidSkipped=!0,e.auctionPhaseCallback(Ii.PREBID_SKIPPED)}},{key:"onUamRequest",value:function(e){(e=this.auctions[e]).uamRequestTime=this.reporter.getElapsedTime(),e.auctionPhaseCallback(Ii.UAM_REQUEST)}},{key:"onUamSkipped",value:function(e){(e=this.auctions[e]).uamSkipped=!0,e.auctionPhaseCallback(Ii.UAM_SKIPPED)}},{key:"onUamResponse",value:function(e){(e=this.auctions[e]).uamResponseTime=this.reporter.getElapsedTime(),e.uamResponded=!0,e.auctionPhaseCallback(Ii.UAM_RESPONSE)}},{key:"cancelAuction",value:function(e){(e=this.auctions[e]).cancelled=this.reporter.getElapsedTime(),e.auctionPhaseCallback(Ii.CANCELLED)}},{key:"removeFromGptActive",value:function(e){var t=this.activeGptCalls[e];t?(this.logger.debug("[AUCTION][".concat(t,"]: Removed ").concat(e," from GPT active list")),delete this.activeGptCalls[e]):this.logger.debug("[AUCTION]: Could not find ".concat(e," in the GPT active list"))}},{key:"onGptRequest",value:function(e,t){var n=this;t.forEach((function(t){var i=n.getSlotStatus(e,t);i&&(i.gptRequestTime=n.reporter.getElapsedTime(),i.slotPhaseCallback(ki.GPT_REQUEST),(i=n.activeGptCalls[t])&&(n.logger.warn("[AUCTION][".concat(e,"]: ").concat(t," is part of an uncompleted auction: ").concat(i," and is marked superseded")),n.auctions[i].slotStatus[t].supersededTime=n.reporter.getElapsedTime(),n.auctions[i].slotStatus[t].slotPhaseCallback(ki.SUPERSEDED)),n.activeGptCalls[t]=e)})),this.auctions[e].gptRequestSent=!0,this.auctions[e].auctionPhaseCallback(Ii.GPT_REQUEST)}},{key:"onGptResponse",value:function(e){(e=this.getSlotStatusInferredAuction(e,ki.GPT_RESPONSE))&&(e.gptResponseTime=this.reporter.getElapsedTime(),e.slotPhaseCallback(ki.GPT_RESPONSE))}},{key:"onGptSlotRendered",value:function(e,t){var n=this.getSlotStatusInferredAuction(e,ki.GPT_RENDERED);n&&(n.gptOnRenderTime=this.reporter.getElapsedTime(),t||this.removeFromGptActive(e),n.slotPhaseCallback(ki.GPT_RENDERED))}},{key:"onGptSlotLoaded",value:function(e){var t=this.getSlotStatusInferredAuction(e,ki.GPT_LOADED);t&&(t.gptOnLoadTime=this.reporter.getElapsedTime(),this.removeFromGptActive(e),t.slotPhaseCallback(ki.GPT_LOADED))}},{key:"cancelSlotAuction",value:function(e,t,n){this.logger.info("[AUCTION][".concat(e,"]: Cancelled auction for ").concat(t," because ").concat(n)),(n=this.getSlotStatus(e,t))&&(n.cancelledTime=this.reporter.getElapsedTime(),this.removeFromGptActive(t),n.slotPhaseCallback(ki.CANCELLED))}},{key:"getAuctions",value:function(){return this.auctions}}]),e}()),Bi=function(e){return Array.isArray(e)?"fluid"!==e[0]:"fluid"!==e};var zi=function(){function e(n,i,r,o,s,a,u,c,l){var d=this;t(this,e),this.fuseSlotRegistry=n,this.prebidGlobal=i,this.uam=r,this.logger=o,this.reporter=s,this.settings=a,this.events=u,this.touchObserver=c,this.telemetry=l,this.firstPrebidRequest=!1,this.firstUamRequest=!1,this.firstPrebidResponse=!1,this.firstUamResponse=!1,this.auctionState=new Ni(o,s),Ye.onSlotLoaded.subscribe((function(e){d.reportOnLoadEvent(e)})),Ye.onSlotResponse.subscribe((function(e){d.reportSlotResponseReceived(e)})),Ye.onSlotRender.subscribe((function(e){d.reportOnRenderEndedEvent(e)}))}return i(e,[{key:"sendGptRequest",value:function(e,t){var n=this,i=this.fuseSlotRegistry.filterUndeleted(e,(function(e){n.auctionState.cancelSlotAuction(t,e,"slot DOM element was deleted")}));this.auctionState.onGptRequest(t,e),this.fuseSlotRegistry.clearFuseSkins(),this.touchObserver.waitForTouchEnd((function(){n.logger.debug("Touch has ended, refreshing ads"),Bt(n.fuseSlotRegistry.getSlots(i),t)}))}},{key:"handleHBResponse",value:function(e,t,n){var i,r,o=this.auctionState.getAuctionStatus(e);o.gptRequestSent?t&&this.logger.debug("[AUCTION][".concat(e,"]: Received ").concat(t," bid after adserver request already sent")):(i=o.prebidIncluded,r=o.uamIncluded,n?(this.logger.info("[AUCTION][".concat(e,"]: Timeout reached with missing responses, sending to GPT.\n          Status: ").concat(JSON.stringify(o))),this.sendGptRequest(o.creativeDivIds,e)):r&&i?(o.uamResponded||o.uamCancelled)&&(o.prebidResponded||o.prebidCancelled)?(this.logger.info("[AUCTION][".concat(e,"]: All necessary responses received, sending to GPT")),this.sendGptRequest(o.creativeDivIds,e)):this.logger.debug("[AUCTION][".concat(e,"]: Still waiting for responses. Status: ").concat(JSON.stringify(o))):(this.logger.debug("[AUCTION][".concat(e,"]: ").concat(t," complete, calling GPT")),this.sendGptRequest(o.creativeDivIds,e)))}},{key:"setAuctionTimeout",value:function(e,t){var n=this;e+=250;this.logger.debug("[AUCTION][".concat(t,"]: Set auction failure timeout of ").concat(e)),setTimeout((function(){return n.handleHBResponse(t,null,!0)}),e)}},{key:"startPrebidAuction",value:function(e,t,n){var i,r=this,o=JSON.stringify(t);this.reporter.addAdEvent("prebid_request_".concat(o),{auctionId:e}),this.logger.info("[AUCTION][".concat(e,"]: Requesting prebid for: ").concat(o)),0<t.length?(this.firstPrebidRequest||(this.firstPrebidRequest=!0,this.reporter.setStateStatus("first_prebid_request")),(i=this.prebidGlobal).requestBids({auctionId:e,adUnitCodes:t,timeout:n,bidsBackHandler:function(n,o){r.auctionState.onPrebidResponse(e);var s,a=Object.keys(n);if(r.logger.info("[AUCTION][".concat(e,"]: Prebid auction complete. Any-bidder-timeout?=").concat(o,". Responding slots: ").concat(JSON.stringify(a))),0<a.length){if(r.logger.debug("[AUCTION][".concat(e,"]: Prebid response details: ").concat(JSON.stringify(n))),r.telemetry)for(var u in n)!function(t){var i,o=r.fuseSlotRegistry.getSlot(t);null!=(s=null==o?void 0:o.sizesHb)&&s.length&&(i=H(o.sizesHb),n[t].bids.forEach((function(n){var o;(n.width>i[0]||n.height>i[1])&&(r.logger.debug("[AUCTION][".concat(e,"][").concat(t,"]: Received a rogue bid ").concat(n.width,"x").concat(n.height,"  with mismatch maxArea ").concat(i," from ").concat(n.bidder,": ").concat(JSON.stringify(n))),null!=(o=r.telemetry))&&o.recordRogueBidderResponse(t,n,i)})))}(u)}else r.logger.warn("[AUCTION][".concat(e,"]: No bid responses received from prebid"));r.reporter.addAdEvent("prebid_response_".concat(JSON.stringify(a)),{auctionId:e}),r.firstPrebidResponse||(r.firstPrebidResponse=!0,r.reporter.setStateStatus("first_prebid_response"));try{i.setTargetingForGPTAsync(t),r.handleHBResponse(e,"prebid",!1)}catch(o){r.logger.error("[AUCTION][".concat(e,"]: ").concat(o.message," ").concat(o.stack))}}})):(this.logger.warn("[AUCTION][".concat(e,"]: Skipped prebid call because no eligible slots available")),this.auctionState.onPrebidSkipped(e))}},{key:"startUamAuction",value:function(e,t){var n,i=this;t.length?(n=JSON.stringify(t.map((function(e){return e.slotID}))),this.reporter.addAdEvent("uam_request_".concat(n),{auctionId:e}),this.logger.info("[AUCTION][".concat(e,"]: Sending UAM request for ").concat(n)),this.logger.debug("[AUCTION][".concat(e,"]: Sending UAM request with slot details: ").concat(JSON.stringify(t))),this.firstUamRequest||(this.firstUamRequest=!0,this.reporter.setStateStatus("first_uam_request")),this.uam.makeBids(t,(function(t){i.logger.info("[AUCTION][".concat(e,"]: Received UAM response")),i.logger.debug("[AUCTION][".concat(e,"]: UAM response details: "),JSON.stringify(t)),i.reporter.addAdEvent("uam_response_".concat(n),{auctionId:e}),i.firstUamResponse||(i.firstUamResponse=!0,i.reporter.setStateStatus("first_uam_response")),i.auctionState.onUamResponse(e),i.handleHBResponse(e,"uam",!1)}))):(this.logger.warn("[AUCTION][".concat(e,"]: Skipped UAM bid because no UAM slots found")),this.auctionState.onUamSkipped(e))}},{key:"startGptOnlyAuction",value:function(e,t){this.logger.debug("[AUCTION][".concat(e,"]: Starting GPT-only auction")),this.sendGptRequest(t,e)}},{key:"prepareUamRequest",value:function(e,t){return t.map((function(e){return{slotID:e.slotDivId,slotName:e.zoneTemplate.slot,sizes:e.sizesHb}}))}},{key:"executeAuction",value:function(e,t,n){var i,r=this,o=(this.events.onAuctionEvent.emit(Object.assign({auctionEventType:"started"},e)),e.auctionId),s=e.slots.map((function(e){return e.slotDivId}));this.auctionState.createNewAuction(e,t,n),this.logger.log("[AUCTION][".concat(o,"]: Running with plan: ").concat((t={auctionId:(t=e).auctionId,usePrebid:t.usePrebid,useUam:t.useUam,hbSlots:t.hbSlots.map((function(e){return e.slotDivId})),gptSlots:t.slots.map((function(e){return e.slotDivId})),gpids:t.slots.map((function(e){return e.gpid})),hbTimeout:t.hbTimeout,breakpointName:t.breakpointName},JSON.stringify(t)))),this.settings.isYandexEnabled()?(i=this.settings.getYandexBlockId())?(this.logger.log("[AUCTION][".concat(o,"]: Run Yandex with blockId ").concat(i)),window.yaContextCb.push((function(){e.slots.forEach((function(e){var t=e.slotDivId;e=e.zoneTemplate.id,e=Number(e.substring(7)+t.substring(t.lastIndexOf("-")+1));r.logger.log("[AUCTION][".concat(o,"][").concat(t,"]: Set pageNumber ").concat(e)),Ya.Context.AdvManager.render({renderTo:"".concat(t),blockId:i,pageNumber:e,onRender:function(){r.reporter.setStateStatus("yandex_unit_rendered")}})}))}))):this.logger.error("[AUCTION][".concat(o,"]: Cannot run Yandex cause yandexBlockId is not set")):(e.usePrebid&&(n=e.hbSlots.map((function(e){return e.slotDivId})),this.startPrebidAuction(o,n,e.hbTimeout)),e.useUam&&(t=this.prepareUamRequest(o,e.hbSlots),this.startUamAuction(o,t)),n=e.usePrebid&&!this.auctionState.getAuctionStatus(o).prebidCancelled,t=e.useUam&&!this.auctionState.getAuctionStatus(o).uamCancelled,n||t?(this.reporter.reportHbAuctionStart(),this.setAuctionTimeout(e.hbTimeout,o)):this.startGptOnlyAuction(o,s))}},{key:"reportOnLoadEvent",value:function(e){e=e.slot.getSlotElementId(),this.auctionState.onGptSlotLoaded(e)}},{key:"reportSlotResponseReceived",value:function(e){e=e.slot.getSlotElementId(),this.auctionState.onGptResponse(e)}},{key:"reportOnRenderEndedEvent",value:function(e){var t,n=!e.isEmpty,i=e.slot.getSlotElementId(),r=(this.logger.debug("[AUCTION]: ".concat(i," render event details: ").concat(JSON.stringify(e))),this.fuseSlotRegistry.getSlot(i));r?(n?this.logger.info("[AUCTION]: Adserver responded with creative for ".concat(i)):(t={fuseSlotId:r.zoneTemplate.id,fuseSlotCode:i,errorType:"MISSING_CREATIVE"},this.reporter.addSlotProblem(t),this.logger.warn("[AUCTION]: Adserver responded without creative for ".concat(i))),this.telemetry&&r.sizes&&(t=H(r.sizes.filter((function(e){return Bi(e)}))),2===(null==(r=Array.isArray(e.size)?e.size:null)?void 0:r.length))&&(r[1]>t[0]||r[1]>t[1])&&(50<V(r[0],t[0])||50<V(r[1],t[1]))&&(this.logger.debug("[AUCTION][".concat(i,"]: Received a rogue bid ").concat(r,"  with mismatch maxArea ").concat(t," from adx: ").concat(JSON.stringify(e))),null!=(r=this.telemetry))&&r.recordRogueAdxResponse(i,e,t),this.auctionState.onGptSlotRendered(i,n)):this.fuseSlotRegistry.isDeletedSlot(i)?(this.logger.info("[AUCTION]: Slot Render Ended Event fired for deleted unit ".concat(i)),this.auctionState.onGptSlotRendered(i,n)):this.logger.debug("[AUCTION]: SlotRenderEnded Event fired for non fuse units: ".concat(i,". HasCreative: ").concat(n))}},{key:"getStateView",value:function(){return this.auctionState}}]),e}(),Fi=function(){function e(n,i,r,o,s,a,u,c,l){t(this,e),this.logger=n,this.browserWindow=i,this.executeAuction=r,this.planAuction=o,this.isDeletedSlot=s,this.getCurrentBreakpointName=a,this.viewportInfo=u,this.settings=c,this.setTargeting=l,this.refreshTimers={},this.refreshCounts={},this.scheduledRefresh={},this.disabledSlots=[],this.queuedSlots=[],this.triggeredAuctions={},this.auctionBlockSlots=[],this.auctionBlockTimeoutHandle=null,this.auctionBlockTriggered=null,this.anyAuctionExecuted=!1}return i(e,[{key:"queueSlots",value:function(e){var t,n=this,i=this.getCurrentBreakpointName();0<(e=e.filter((function(e){return n.settings.isSlotEnabledForBreakpoint(e.zoneTemplate.id,i)?e.currentlyActive?n.isScheduled(e)?(n.logger.debug("[SCHEDULER]: Skipped ".concat(e.slotDivId," because it is already scheduled")),!1):!n.isRefreshDisabled(e.slotDivId)||(n.logger.debug("[SCHEDULER]: Skipped ".concat(e.slotDivId," because it is disabled")),!1):(n.logger.info("[SCHEDULER]: Skipped ".concat(e.slotDivId," because it is hasn't activated")),!1):(n.logger.debug("[SCHEDULER]: Skipped ".concat(e.slotDivId," because no sizes mapped at the current breakpoint (").concat(i,")")),!1)}))).length&&(t=e.map((function(e){return e.slotDivId})),this.logger.info("[SCHEDULER]: Added ".concat(t," to auction queue")),e.forEach((function(e){return n.queuedSlots.push(e)})))}},{key:"isScheduled",value:function(e){return 0<this.queuedSlots.filter((function(t){return t.slotDivId===e.slotDivId})).length}},{key:"isTemplateScheduled",value:function(e){return 0<this.queuedSlots.filter((function(t){return t.zoneTemplate.id===e})).length}},{key:"isRefreshDisabled",value:function(e){return 0<this.disabledSlots.filter((function(t){return t===e})).length}},{key:"purgeDeletedFromQueue",value:function(){var e=this;this.queuedSlots=this.queuedSlots.filter((function(t){return!e.isDeletedSlot(t.slotDivId)||(e.logger.info("[SCHEDULER]: Removed deleted slot ".concat(t.slotDivId," from queue")),!1)}))}},{key:"runAuction",value:function(){if(this.purgeDeletedFromQueue(),0===this.queuedSlots.length)return this.logger.log("[SCHEDULER]: Auction will not run because no slots are queued"),[];var e=this.getMissingAuctionBlockSlots();if(0<e.length){if(this.auctionBlockTimeoutHandle)return t=this.queuedSlots.map((function(e){return e.slotDivId})),this.logger.info("[SCHEDULER] Deferred the auction for ".concat(JSON.stringify(t)," because slots missing from the auction block: ").concat(JSON.stringify(e))),this.auctionBlockTriggered=!0,[]}else this.auctionBlockTimeoutHandle&&(this.logger.info("[SCHEDULER]: Auction block cleared, as requirements satisfied "),this.clearAuctionBlock());var t,n,i=this.planAuction(this.queuedSlots,this.getAuctionMaxViewports());return this.isAnyAuctionExecuted()||(t=this.viewportInfo.getViewportStatus(),n=t.offset.y+t.innerHeight,e=this.queuedSlots.filter((function(e){return e.zoneDiv.getBoundingClientRect().top<n})),this.setTargeting("zone_count_above_vp",e.length.toString())),this.queuedSlots=this.queuedSlots.filter((function(e){return-1===i.slots.indexOf(e)})),this.logger.log("[SCHEDULER]: Starting auction with ".concat(i.slots.length," slots, ").concat(this.queuedSlots.length," slots remaining")),this.startAuction(i),i.slots.map((function(e){return e.slotDivId}))}},{key:"forceRunAuction",value:function(e){var t=this.planAuction([e]);this.logger.log("[SCHEDULER][".concat(t.auctionId,"]: Forcing auction for ").concat(e.slotDivId)),this.startAuction(t)}},{key:"disableSlotRefresh",value:function(e){this.disabledSlots=this.disabledSlots.filter((function(t){return t!==e})).concat(e)}},{key:"enableSlotRefresh",value:function(e){this.disabledSlots=this.disabledSlots.filter((function(t){return t!==e}))}},{key:"getAuctionMaxViewports",value:function(){return this.isAnyAuctionExecuted()?void 0:this.settings.getMaxViewportsFirstAuction()}},{key:"handleOnSlotOutcome",value:function(e,t,n){n!==ki.GPT_LOADED||this.triggeredAuctions[e]||(this.triggeredAuctions[e]=!0,0<this.queuedSlots.length&&(this.logger.debug("[SCHEDULER][".concat(e,"]: The first slot has received a render event, initiating the next auction")),this.runAuction())),n!==ki.GPT_LOADED&&n!==ki.GPT_RENDERED||this.scheduleRefreshTimer(t)}},{key:"startAuction",value:function(e){var t=this;this.anyAuctionExecuted=!0,this.executeAuction(e,(function(){}),(function(n,i){return t.handleOnSlotOutcome(e.auctionId,n,i)}))}},{key:"scheduleRefreshTimer",value:function(e){this.scheduledRefresh[e.slotDivId]||(this.scheduledRefresh[e.slotDivId]=!0,this.setRefreshTimer(e))}},{key:"getRefreshIntervals",value:function(){return JSON.parse(JSON.stringify(this.refreshTimers))}},{key:"getRefreshingCodes",value:function(){return Object.keys(this.refreshTimers)}},{key:"clearRefreshIntervals",value:function(){var e=this;Object.keys(this.refreshTimers).forEach((function(t){e.logger.debug("[REFRESH]: Clearing refresh timer for ".concat(t)),clearInterval(e.refreshTimers[t])})),this.refreshTimers={}}},{key:"reset",value:function(){this.clearRefreshIntervals(),this.clearAuctionBlock(),this.refreshCounts={},this.scheduledRefresh={},this.queuedSlots=[]}},{key:"clearPendingAuctions",value:function(){this.queuedSlots=[]}},{key:"setRefreshTimer",value:function(e){var t=e.zoneTemplate.attributes.refresh,n=e.slotDivId;v(t)&&0<t?(this.logger.log("[SCHEDULER]: Setting custom refresh time of ".concat(t," seconds for ").concat(n)),this.addRefreshInterval(e,t)):0===t?this.logger.log("[SCHEDULER]: No refresh timer set for ".concat(n)):(t=this.settings.getDefaultRefreshInterval())&&0<t?(this.logger.log("[SCHEDULER]: Setting default refresh time of ".concat(t," seconds for ").concat(n)),this.addRefreshInterval(e,t)):this.logger.debug("[SCHEDULER]: No default refresh timer exists in account settings.")}},{key:"isSkipRefreshInEdgeBrowser",value:function(e){this.refreshCounts[e.slotDivId]=this.refreshCounts[e.slotDivId]||0;var t=this.refreshCounts[e.slotDivId]>this.settings.getEdgeHtmlMaxAdsRefreshLimit();return(t||!this.browserWindow.document.hasFocus())&&(this.logger.log((t?'will skip refreshing ad(code: "'.concat(e.slotDivId,'") as it reached Edge browser ads refresh limit of ').concat(this.settings.getEdgeHtmlMaxAdsRefreshLimit()," at the moment - "):"will skip refreshing ad as browser page/tab is NOT active at the moment - ").concat((new Date).toISOString(),".")),!0)}},{key:"isSkipRefreshByCallback",value:function(e){try{return!e.isAllowRefresh()}catch(t){return this.logger.error("[SCHEDULER][".concat(e.slotDivId,"]: Refresh callback failed with ").concat(t)),!0}}},{key:"refreshCallback",value:function(e){A(this.browserWindow)&&this.isSkipRefreshInEdgeBrowser(e)||(this.isSkipRefreshByCallback(e)?this.logger.log("[".concat(e.slotDivId,"] Refresh blocked by callback")):this.browserWindow.document.getElementById(e.slotDivId)?e.zoneDiv&&e.isInView()?(A(this.browserWindow)&&(this.refreshCounts[e.slotDivId]+=1),this.queueSlots([e]),this.runAuction()):this.logger.debug("[SCHEDULER]: Not refreshing ".concat(e.slotDivId," because it is not in view")):this.logger.warn("[AUCTION]: Could not refresh ".concat(e.slotDivId," because a div with that id was not found in the DOM")))}},{key:"addRefreshInterval",value:function(e,t){var n=this;this.refreshTimers[e.slotDivId]&&(this.logger.warn("[SCHEDULER]: Refresh timer already set for ".concat(e.slotDivId)),clearInterval(this.refreshTimers[e.slotDivId])),this.refreshTimers[e.slotDivId]=setInterval((function(){n.refreshCallback(e)}),1e3*t)}},{key:"setAuctionBlock",value:function(e,t){var n=this;this.auctionBlockSlots=e.filter((function(e){var t=n.settings.getZoneTemplate(e);return t?t.activateCondition?(n.logger.warn("[SLOTS][".concat(e,"]: Excluded from next-auction slot requirement, because the slot has an activation condition")),!1):(t=n.getCurrentBreakpointName(),!!n.settings.isSlotEnabledForBreakpoint(e,t)||(n.logger.info("[SLOTS][".concat(e,"]: Excluded from next-auction slot requirement, because it is not enabled at the ").concat(t," breakpoint")),!1)):(n.logger.warn("[SLOTS][".concat(e,"]: Excluded from next-auction slot requirement, because the slot does not exist in this tag")),!1)})),0<this.auctionBlockSlots.length?(this.logger.info("[SCHEDULER]: Enabled auction block. Will not proceed until Zones with FuseIds ".concat(JSON.stringify(this.auctionBlockSlots)," are registered, or ").concat(t,"ms have elapsed")),this.auctionBlockTimeoutHandle=setTimeout((function(){n.auctionBlockTriggered?(n.logger.warn("[SCHEDULER]: Auction block timeout reached, missing: ".concat(JSON.stringify(n.getMissingAuctionBlockSlots()),". Running deferred auction")),n.clearAuctionBlock(),n.runAuction()):(0<n.getMissingAuctionBlockSlots().length&&n.logger.warn("[SCHEDULER]: Auction block timeout reached, missing: ".concat(n.getMissingAuctionBlockSlots())),n.clearAuctionBlock())}),t)):this.logger.info("[SCHEDULER]: Did not enable AuctionBlock, because no (valid) slots specified")}},{key:"getMissingAuctionBlockSlots",value:function(){var e=this;return this.auctionBlockSlots.filter((function(t){return!e.isTemplateScheduled(t)}))}},{key:"isAnyAuctionExecuted",value:function(){return this.anyAuctionExecuted}},{key:"clearAuctionBlock",value:function(){this.auctionBlockSlots=[],this.auctionBlockTriggered=null,this.auctionBlockTimeoutHandle&&clearTimeout(this.auctionBlockTimeoutHandle),this.auctionBlockTimeoutHandle=null}}]),e}(),Gi="data-fuse",Ui="".concat("div","[").concat(Gi,"]"),Wi="data-fuse-reset-at",ji=function(){function e(n,i,r,o,s,a){t(this,e),this.logger=n,this.document=i,this.templateSettings=r,this.fuseSlotFormatter=o,this.getElapsedTime=s,this.getApi=a,this.slotCounter={},this.zoneCounter={}}return i(e,[{key:"prepareZoneDiv",value:function(e,t,n,i,r){return this.logger.debug("[SLOTS][".concat(e,": Preparing the element")),i.setAttribute("data-fuse-code","".concat(e)),i.setAttribute("data-fuse-zone-instance","".concat(t)),i.setAttribute("data-fuse-slot","".concat(e)),this.templateSettings.isGptPreAuctionEnabled()&&i.setAttribute("data-gpid",n),i.setAttribute("data-fuse-processed-at",this.getElapsedTime().toString()),i.removeAttribute(Wi),this.document.getElementById(e)?this.logger.warn("[DOM-SCAN]: Found existing slot element with id ".concat(e)):((t=this.document.createElement("div")).setAttribute("id","".concat(e)),t.classList.add("fuse-slot"),t.style.maxWidth="inherit",t.style.maxHeight="inherit",this.fuseSlotFormatter.format(i,r),this.templateSettings.isYandexEnabled()&&this.fuseSlotFormatter.updateSlotForYandex(t,r),i.appendChild(t)),i}},{key:"assignSlotDivId",value:function(t){return"fuse-slot-".concat(t,"-").concat(e.assignCounter(t,this.slotCounter))}},{key:"assignZoneInstanceId",value:function(t){return"zone-instance-".concat(t,"-").concat(e.assignCounter(t,this.zoneCounter))}},{key:"assignGpid",value:function(e,t,n){return"".concat(t,"#").concat(n,"-").concat(this.slotCounter[e])}},{key:"processRawElement",value:function(t,n){if(!(r=t.getAttribute(Gi)))return this.logger.warn("[SLOTS]: Empty data-fuse attribute ".concat(r)),null;var i=this.templateSettings.generateZoneTemplate(r,this.getApi());if(!i)return this.logger.warn("[SLOTS]: Unknown ZoneCode found in data-fuse attribute ".concat(r)),null;var r=i.id,o=t.getAttribute("data-fuse-code"),s=t.getAttribute(Wi),a=null!=(a=t.id)&&a.trim()&&null!=(a=t.id)?a.trim():void 0;if(n){if(o&&!s)return this.logger.debug("[SLOTS]: Skip ".concat(o," because it was already processed")),null;o&&s&&this.logger.debug("[SLOTS]: Processing ".concat(o," again because it has been reset"))}else o&&this.logger.warn("[SLOTS]: Processing ".concat(o," again. This is likely to be an error, but preserved for backwards compatibility"));return n=this.assignSlotDivId(r),s=this.assignZoneInstanceId(r),o=this.assignGpid(r,i.slot,"single"),this.prepareZoneDiv(n,s,o,t,i),{zoneTemplate:i,slotDivId:n,zoneDiv:t,zoneDivId:a,zoneInstanceId:s,gpid:o,targeting:e.extractTargeting(t)}}},{key:"findElementWithDomId",value:function(e){var t=this.document.querySelectorAll("".concat("div",'[id="').concat(e,'"][').concat(Gi,"]"));return 0==t.length?this.logger.warn("[SLOTS]: No DOM element found with both id='".concat(e,"' AND a data-fuse attribute")):1<t.length&&this.logger.warn("[SLOTS]: Multiple DOM elements found with id '".concat(e,"'")),t}},{key:"findAllFuseElements",value:function(){return this.document.querySelectorAll(Ui)}},{key:"findElementsWithTemplateId",value:function(e){return this.document.querySelectorAll("".concat("div","[").concat(Gi,'="').concat(e,'"]'))}},{key:"processRawElements",value:function(e,t){var n=this,i=[];return e.forEach((function(e){(e=n.processRawElement(e,t))&&i.push(e)})),i}},{key:"processSlots",value:function(e){var t=this.findAllFuseElements();return this.processRawElements(t,e)}},{key:"processZoneWithDivId",value:function(e,t){return e=this.findElementWithDomId(e),(e=this.processRawElements(e,t))[e.length-1]}},{key:"processLastSlotWithFuseId",value:function(e,t){return e=this.findElementsWithTemplateId(e),(e=this.processRawElements(e,t))[e.length-1]}},{key:"processSlotsWithFuseId",value:function(e,t){return e=this.findElementsWithTemplateId(e),this.processRawElements(e,t)}}],[{key:"assignCounter",value:function(e,t){return t[e]||(t[e]=0),++t[e]}},{key:"getTargetingValue",value:function(e){return 0<e.indexOf(",")?e.split(",").map((function(e){return e.trim()})).filter((function(e){return""!==e})):e}},{key:"extractTargeting",value:function(t){var n=t.getAttributeNames().filter((function(e){return"data-targeting-key"!==e&&"data-targeting-value"!==e})).filter((function(e){return 0===e.indexOf("data-targeting-",0)})).map((function(e){return{attributeKey:e,targetingKey:e.replace("data-targeting-","").trim()}})).map((function(e){return{key:e.targetingKey,value:t.getAttribute(e.attributeKey)}})).filter((function(e){var t=e.key;e=e.value;return t&&t.length&&e&&e.length})).map((function(t){var n=t.key;t=t.value;return{key:n,value:e.getTargetingValue(t)}})),i=t.getAttribute("data-targeting-key"),r=t.getAttribute("data-targeting-value");return i&&i.length&&r&&r.length&&!n.some((function(e){return e.key===i}))&&n.push({key:i,value:e.getTargetingValue(r)}),n}}]),e}(),Hi=function(){function e(n,i,r){t(this,e),this.logger=n,this.templateSettings=i,this.viewportInfo=r}return i(e,[{key:"logContext",value:function(e){return"[SLOT-FORMAT][".concat(e.id,"]:")}},{key:"hasOverflow",value:function(e,t,n){for(var i=this,r=e.parentElement,o=["hidden","scroll","auto"],s=["overflow","overflow-x","overflow-y"];r;)s.forEach((function(e){var s=i.viewportInfo.browserWindow.getComputedStyle(r)[e];if(S(s)&&-1!==o.indexOf(s)){if(!n)return i.logger.debug("".concat(i.logContext(t)," Miniscroller was not applied. ").concat(e,' on "').concat(r.id," ").concat(r.className,'"')),!0;r.style[e]="visible",i.logger.debug("".concat(i.logContext(t)," Force miniscroller. Update ").concat(e,' on "').concat(r.id," ").concat(r.className,'"'))}})),r=r.parentElement;return!1}},{key:"hasHeight",value:function(e,t,n){var i=e,r=(o=this.viewportInfo.browserWindow.getComputedStyle(e)).height,o=o.minHeight;if(this.logger.debug("".concat(this.logContext(t),' applying miniscroller on element with height "').concat(r,'" min-height: "').concat(o,'"')),-1===["0px","auto"].indexOf(r)){if(!n)return this.logger.debug("".concat(this.logContext(t)," Miniscroller was not applied because of height ").concat(r,' already set for element "').concat(e.id,'"')),!0;this.logger.debug("".concat(this.logContext(t),' Force miniscroller. Update height on "').concat(i.className,'"'))}return!1}},{key:"format",value:function(e,t){var n=t.attributes;!this.templateSettings.isMiniScrollersEnabled()||!1===n.miniscroller||n.sticky||n.interscroller||n.interstitial||n.scrollToStick||this.hasHeight(e,t)||this.hasOverflow(e,t)||(this.logger.debug("".concat(this.logContext(t),' Update slot element "').concat(e.id,'" to miniscroller')),this.updateSlotElementToMiniScroller(e,t))}},{key:"updateSlotElementToMiniScroller",value:function(e,t){var n=this.viewportInfo.getCurrentBreakpoint().name;e.classList.add("fuse-slot-mini-scroller"),t=this.templateSettings.maxSlotHeightForBreakpoint(t,n);e.style.minHeight="".concat(t,"px")}},{key:"updateSlotForYandex",value:function(e,t){var n=this.viewportInfo.getCurrentBreakpoint().name,i=(t=null==(t=t.sizeMapping)?void 0:t[n],0),r=0;t&&0<t.length&&(t.forEach((function(e){"fluid"!==e&&"fluid"!==e[0]&&(Number(e[0])>r&&(r=Number(e[0])),Number(e[1])>i)&&(i=Number(e[1]))})),e.style.width="".concat(r,"px"),e.style.height="".concat(i,"px"),e.style.margin="auto")}}]),e}();function Vi(e,t,n,i){return t=function(e,t,n,i,r){var o=e.top,s=e.bottom,a=e.left,u=e.right,c=e.width;return e=e.height,!!(o||s||a||u||c||e)&&(c*=r,0<=o+(o=e*r)+i)&&0<=a+c&&s-o-i<=n&&u-c<=t}(t=t.getBoundingClientRect(),e.width,e.innerHeight,i,n/100),!e.hidden&&t}function qi(){Ki.debug("[QUEUE]: Cleared fuse queue with ".concat($i()," remaining items")),Xi().splice(0,Xi().length)}var Zi=function(){function e(n,i,r,o,s,a,u,c){t(this,e),this.logger=n,this.reporter=i,this.browserWindow=r,this.gptSlotRegistry=o,this.settings=s,this.conditionFactory=a,this.viewportInfo=u,this.events=c,this.DELETED_FUSE_DIVS=[],this.REGISTERED_SLOTS={},this.SLOT_ACTIVATOR={},this.slotInitialised=new qe(this.logger,"onSlotCreated"),this.slotsInitialised=new qe(this.logger,"onSlotsInitialised")}return i(e,[{key:"getZoneDivs",value:function(){var e=this,t={};return Object.keys(this.REGISTERED_SLOTS).forEach((function(n){n=e.REGISTERED_SLOTS[n],t[n.slotDivId]=n.zoneDiv})),t}},{key:"getZoneTemplates",value:function(){var e=this,t={};return Object.keys(this.REGISTERED_SLOTS).forEach((function(n){n=e.REGISTERED_SLOTS[n],t[n.slotDivId]=n.zoneTemplate})),t}},{key:"getSlotsForTemplateId",value:function(e){var t=this;return Object.keys(this.REGISTERED_SLOTS).filter((function(n){return t.REGISTERED_SLOTS[n].zoneTemplate.id===e})).map((function(e){return t.REGISTERED_SLOTS[e]}))}},{key:"getActiveSlots",value:function(){var e=this;return Object.keys(this.REGISTERED_SLOTS).filter((function(t){return e.REGISTERED_SLOTS[t].currentlyActive})).map((function(t){return e.REGISTERED_SLOTS[t]}))}},{key:"getSlotInitObservable",value:function(){return this.slotInitialised}},{key:"getSlotsInitObservable",value:function(){return this.slotsInitialised}},{key:"isInDom",value:function(e){return S(window.document.getElementById(e))}},{key:"isDeletedSlot",value:function(e){return-1!==this.DELETED_FUSE_DIVS.indexOf(e)}},{key:"filterUndeleted",value:function(e,t){var n=this;return e.filter((function(e){var i=!n.isDeletedSlot(e);return!i&&t&&t(e),i}))}},{key:"reset",value:function(){var e=this,t=(Object.keys(this.REGISTERED_SLOTS).forEach((function(t){e.isDeletedSlot(t)&&e.logger.log("[EVENT]: resetSlots() unit already deleted ".concat(t)),e.DELETED_FUSE_DIVS.push(t)})),this.getZoneDivs());Object.keys(t).forEach((function(n){t[n].setAttribute(Wi,e.reporter.getElapsedTime().toString())})),Object.keys(this.SLOT_ACTIVATOR).forEach((function(t){e.SLOT_ACTIVATOR[t].destroy()})),this.REGISTERED_SLOTS={},this.SLOT_ACTIVATOR={},this.clearFuseSkins()}},{key:"registeredSlotConfig",value:function(e,t,n,i,r){var o=this;return{slotDivId:e,zoneDiv:i,zoneDivId:r,zoneInstanceId:t,zoneTemplate:n,zoneTemplateId:n.id,isInView:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=n.attributes.interscroller?o.browserWindow.document.querySelector(".publift-widget-".concat(n.id,"-container")):o.browserWindow.document.getElementById(e);return Vi(o.viewportInfo.getViewportStatus(),i,50,t)},isAllowRefresh:function(){return!0}}}},{key:"registerActiveSlot",value:function(e,t){e.currentlyActive=!0,this.enablePartners(e,t),this.events.onZoneEvent.emit({zoneTemplateId:e.zoneTemplate.id,zoneDivId:e.zoneDivId,zoneEventType:"registered",instanceId:e.zoneInstanceId,status:"active",gpid:e.gpid})}},{key:"registerInactiveSlot",value:function(e,t){this.SLOT_ACTIVATOR[e.slotDivId]=t,this.events.onZoneEvent.emit({zoneTemplateId:e.zoneTemplate.id,zoneDivId:e.zoneDivId,zoneEventType:"registered",instanceId:e.zoneInstanceId,status:"inactive",gpid:e.gpid})}},{key:"activateInactiveSlot",value:function(e,t,n){var i=e.slotDivId;this.REGISTERED_SLOTS[i]&&!0===this.REGISTERED_SLOTS[i].currentlyActive?this.logger.warn("[SLOTS][".concat(i,"]: Skipped activation because the slot was already activated")):this.isInDom(i)?(this.SLOT_ACTIVATOR[i].destroy(),e.currentlyActive=!0,this.enablePartners(e,t),this.events.onZoneEvent.emit({zoneTemplateId:e.zoneTemplate.id,zoneDivId:e.zoneDivId,zoneEventType:"activated",instanceId:e.zoneInstanceId,gpid:e.gpid}),n([e])):(this.logger.warn("[SLOTS][".concat(i,"]: Skipped activation because the slot was removed from the DOM")),this.deleteSlot(i))}},{key:"enablePartners",value:function(e,t){this.enableGptAsync(e,t),e.allowHeaderBidding?this.enablePrebidAsync(e):this.logger.debug("[SLOTS][".concat(e.slotDivId,"]: Skip prebid registration because headerbidding not enabled"))}},{key:"enablePrebidAsync",value:function(e){var t=this;_n((function(){var n,i;t.isDeletedSlot(e.slotDivId)?t.logger.log("[SLOTS][".concat(e.slotDivId,"]: Skip prebid registration because div deleted")):(i=function(e){var t;return{code:e.slotDivId,mediaTypes:Object.assign(Object.assign(Object.assign({},yn.isPrebidBannerEnabled()&&{banner:{sizes:e.sizesHb}}),yn.isPrebidNativeEnabled()&&(null==(t=e.mediaTypes)?void 0:t.includes("native"))&&{native:{sendTargetingKeys:!1}}),yn.isPrebidVideoEnabled()&&(null==(t=e.mediaTypes)?void 0:t.includes("video"))&&(t=e,{video:Object.assign(Object.assign({},{context:"outstream",playerSize:[640,480],mimes:["video/mp4"],protocols:[2,3,4],playbackmethod:[2],maxduration:30,minduration:6,skip:1,linearity:2,api:[2]}),t.videoAttributes)})),bids:Tn(e)}}(n=e),vn.debug("[PREBID][".concat(n.slotDivId,"]: Registered with mediaTypes: ").concat(JSON.stringify(i.mediaTypes))),mn.addAdUnits(i))}))}},{key:"enableGptAsync",value:function(e,t){var n=this;Nt((function(){var i,r,o,s;n.isDeletedSlot(e.slotDivId)?n.logger.log("[SLOTS][".concat(e.slotDivId,"]: Skip GPT registration because div deleted")):(r=t,o=(i=e).zoneTemplate.slot,(s=ht.defineSlot(o,i.sizes,i.slotDivId))?(xt.addAdEvent("register_gpt_slot_".concat(i.slotDivId),{gpid:i.gpid}),s.addService(ht.pubads()),r.forEach((function(e){s.setTargeting(e.key,e.value)}))):_t.warn("[GPT]: googletag.defineSlot(".concat(o,", ").concat(JSON.stringify(i.sizes),", ").concat(i.slotDivId,") returned null")),(r=s)&&(n.gptSlotRegistry.add(e.zoneTemplate.id,r),o=e.slotDivId,_t.debug("[GPT]: googletag.display(".concat(o,")")),ht.display(o)))}))}},{key:"deleteSlot",value:function(e){this.logger.debug("[SLOTS][".concat(e,"]: Deleting slot"));var t=this.getSlot(e);t?this.gptSlotRegistry.purgeByElement(t.zoneTemplate.id,t.slotDivId):this.logger.debug("[SLOTS][".concat(e,"]: Registered slot not found upon deletion")),this.DELETED_FUSE_DIVS.push(e),delete this.REGISTERED_SLOTS[e],null!=(t=this.SLOT_ACTIVATOR[e])&&t.destroy(),delete this.SLOT_ACTIVATOR[e]}},{key:"getSlot",value:function(e){return this.REGISTERED_SLOTS[e]}},{key:"getSlotByZoneDivId",value:function(e){var t=this;return this.REGISTERED_SLOTS[Object.keys(this.REGISTERED_SLOTS).find((function(n){return t.REGISTERED_SLOTS[n].zoneDivId===e}))]}},{key:"getSlots",value:function(e){var t=this,n=[];return e.forEach((function(e){(e=t.getSlot(e))&&n.push(e)})),n}},{key:"buildActivator",value:function(e,t,n,i,r){var o=this;return this.conditionFactory.buildActivator(t,e.slotDivId,n,(function(){return o.activateInactiveSlot(e,i,r)}))}},{key:"registerFuseSlot",value:function(e,t,n,i,r,o,s,a,u,c){var l,d=this,g=this.viewportInfo.getCurrentBreakpoint().name,h=function(e,t,n){function i(e){if(e.includes("px"))return e=Number(e.split("px")[0]),Number.isNaN(e)?void 0:e}var r=i(e.getComputedStyle(t).maxWidth),o=i(e.getComputedStyle(t).maxHeight);return n.filter((function(e){return!Bi(e)||!S(r)||e[0]<=r})).filter((function(e){return!Bi(e)||!S(o)||e[1]<=o}))}(this.browserWindow,t,null!=(h=r.sizeMapping[g])?h:[]),f=0<h.length?h:void 0;h=0<(h=function(e){return e.filter(Bi)}(h)).length?h:void 0,n=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.registeredSlotConfig(e,n,r,t,i)),{currentlyActive:!1,storedAt:this.reporter.getElapsedTime(),breakpoint:g,sizes:f,sizesHb:h,allowHeaderBidding:S(h)&&0<h.length&&this.settings.isHeaderBiddingSlot(r)}),r.mediaTypes&&{mediaTypes:r.mediaTypes}),r.videoAttributes&&{prebidVideoConfig:r.videoAttributes}),{gpid:o}),r.targeting&&{targeting:r.targeting}),this.allowSlotRefreshCallback?{isAllowRefresh:function(){return d.allowSlotRefreshCallback(e)}}:{});return this.REGISTERED_SLOTS[e]=n,m(f)?this.logger.info("[SLOTS][".concat(e,"]: Registered as inactive because no sizes available")):(t=n,i=this.logger,g=e,h=s,o=r.targeting,i.log("[SLOTS][".concat(g,"]: merge slot targeting ").concat(JSON.stringify(h),", ").concat(JSON.stringify(o))),l=h,null!=o&&o.forEach((function(e){l.find((function(t){return t.key===e.key}))||l.push({key:e.key,value:e.value})})),i.log("[SLOTS][".concat(g,"]: set slot targeting ").concat(JSON.stringify(l))),f=l,a?(this.logger.info("[SLOTS][".concat(e,"]: Registering as active because it is forced")),this.registerActiveSlot(t,f)):r.activateCondition?(s=this.buildActivator(t,r.activateCondition,u,f,c)).checkCondition()?(this.logger.info("[SLOTS][".concat(e,"]: Registering as active because conditions already satisfied")),this.registerActiveSlot(t,f)):(this.logger.info("[SLOTS][".concat(e,"]: Registering as inactive and enabling triggers")),this.registerInactiveSlot(t,s),s.enableTriggers()):(this.logger.log("[SLOTS][".concat(e,"]: Registering as active because no conditions defined")),this.registerActiveSlot(t,f)),this.slotInitialised.emit({})),n}},{key:"register",value:function(e,t,n,i){var r=this;e=e.map((function(e){return r.registerFuseSlot(e.slotDivId,e.zoneDiv,e.zoneInstanceId,e.zoneDivId,e.zoneTemplate,e.gpid,e.targeting,n,t,i)})).filter(S);return this.logger.debug("[SLOTS]: Registered ".concat(e.length," slots")),this.slotsInitialised.emit({}),e}},{key:"clearFuseSkins",value:function(){this.logger.debug("[DOM]: Clearing fuse skins");for(var e=this.browserWindow.document.querySelectorAll("div.fuse-custom-skin"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])}},{key:"setAllowSlotRefreshCallback",value:function(e){this.allowSlotRefreshCallback=e,this.logger.debug("[SLOTS]: Registered setAllowSlotRefreshCallback")}}]),e}(),Yi=function(){function e(n,i,r,o,s,a){var u=this;t(this,e),this.fuseSlotRegistry=n,this.zoneRegistry=i,this.logger=r,this.auctionScheduler=o,this.domProcessor=s,this.isTagInitialised=a,this.runAuctionFn=function(e){u.auctionScheduler.queueSlots(e),u.runAuction()}}return i(e,[{key:"registerAndQueue",value:function(e,t,n){return e=this.domProcessor.processSlots(e),n=(e=this.registerSlots(e,n,t)).filter((function(e){return e.currentlyActive})),this.auctionScheduler.queueSlots(n),e}},{key:"registerAndRunAuction",value:function(e,t,n){return e=this.registerAndQueue(e,t,n),this.runAuction(),e}},{key:"registerZoneAndQueue",value:function(e,t,n,i){return(e=this.domProcessor.processZoneWithDivId(e,t))?(null!=(t=this.registerSlots([e],i,n)[0])&&t.currentlyActive&&this.auctionScheduler.queueSlots([t]),t):null}},{key:"activateZone",value:function(e){this.zoneRegistry.activateZone(e)}},{key:"registerAndQueueLastSlotWithFuseId",value:function(e,t,n,i){if(e=this.domProcessor.processLastSlotWithFuseId(e,t))return(t=this.registerSlots([e],i,n)[0])&&t.currentlyActive&&this.auctionScheduler.queueSlots([t]),t}},{key:"registerSlots",value:function(e,t,n){var i=this;return e.forEach((function(e){i.zoneRegistry.register(e)})),this.fuseSlotRegistry.register(e,t,n,this.runAuctionFn)}},{key:"registerAndQueueWithFuseId",value:function(e,t,n,i){return e=this.domProcessor.processSlotsWithFuseId(e,t),e=(t=this.registerSlots(e,i,n)).filter((function(e){return e.currentlyActive})),this.auctionScheduler.queueSlots(e),t}},{key:"runAuction",value:function(){return this.isTagInitialised()?this.auctionScheduler.runAuction():(this.logger.info("[CONTROLLER] Deferred the auction start until the tag is initialised"),!1)}},{key:"forceRunAuction",value:function(e){var t=this.fuseSlotRegistry.getSlot(e);t?this.auctionScheduler.forceRunAuction(t):this.logger.warn("[CONTROLLER]: Could not force auction because slot ".concat(e," not found"))}},{key:"runAuctionAllActiveSlots",value:function(){this.auctionScheduler.queueSlots(this.fuseSlotRegistry.getActiveSlots()),this.runAuction()}},{key:"reset",value:function(){this.logger.log("[CONTROLLER]: resetSlots()"),this.fuseSlotRegistry.reset(),this.auctionScheduler.reset(),this.zoneRegistry.reset()}},{key:"destroyZone",value:function(e){this.zoneRegistry.deleteZone(e);var t=this.fuseSlotRegistry.getSlotByZoneDivId(e);t?this.fuseSlotRegistry.deleteSlot(t.slotDivId):this.logger.debug("[CONTROLLER] Registered slot for zoneDivId ".concat(e," not found upon deletion"))}},{key:"clearRefreshIntervals",value:function(){this.auctionScheduler.clearRefreshIntervals()}},{key:"getRefreshIntervals",value:function(){return this.auctionScheduler.getRefreshIntervals()}},{key:"handleBreakpointChange",value:function(){this.auctionScheduler.clearPendingAuctions(),this.auctionScheduler.clearAuctionBlock(),this.auctionScheduler.clearRefreshIntervals();var e=this.fuseSlotRegistry.getActiveSlots();this.auctionScheduler.queueSlots(e),this.auctionScheduler.runAuction()}},{key:"loadSlots",value:function(e,t,n){e?(n(),this.registerAndQueue(!1,!1,t),this.runAuction()):(this.logger.warn("[CONTROLLER]: loadSlots() called during initialisation. Translating call to registerSlots() to avoid reset"),this.registerAndRunAuction(!0,!1,t))}}]),e}(),Qi=function(){function e(n,i,r){t(this,e),this.logger=n,this.reporter=i,this.zoneEventEmitter=r,this.DELETED_ZONES=[],this.REGISTERED_ZONES={},this.MANUAL_ACTIVATE_API={}}return i(e,[{key:"register",value:function(e){var t=e.zoneInstanceId;if(!this.REGISTERED_ZONES[t]){if(n=e.zoneDivId?this.findByDivId(e.zoneDivId):void 0){var n,i=n.zoneDiv;if((n=n.zoneInstanceId)===t)return void this.logger.error("[ZONE][".concat(n,"]: Ignoring unexpected re-registration"));this.logger.warn("[ZONE][".concat(n,"]: Div ").concat(i.id," replaced in DOM without pageInit(). Registering ").concat(t)),this.DELETED_ZONES.push(n),delete this.REGISTERED_ZONES[n],delete this.MANUAL_ACTIVATE_API[n]}return this.logger.info("[ZONE][".concat(t,"]: Registered with DivId ").concat(e.zoneDiv.id)),this.reporter.reportFirstZone(),i={zoneInstanceId:t,zoneDiv:e.zoneDiv,zoneDivId:e.zoneDivId,zoneTemplateId:e.zoneTemplate.id,gpid:e.gpid},this.REGISTERED_ZONES[t]=i}this.logger.error("[ZONE][".concat(t,"]: Already registered"))}},{key:"isDeletedZone",value:function(e){return-1!==this.DELETED_ZONES.indexOf(e)}},{key:"findByDivId",value:function(e){var t=this;return Object.keys(this.REGISTERED_ZONES).map((function(e){return t.REGISTERED_ZONES[e]})).filter((function(t){return t.zoneDivId==e})).shift()}},{key:"activateZone",value:function(e){var t,n=this.findByDivId(e);return n?(t=n.zoneInstanceId,!this.MANUAL_ACTIVATE_API[t]&&(this.MANUAL_ACTIVATE_API[t]=!0,this.zoneEventEmitter.emit({zoneTemplateId:n.zoneTemplateId,zoneDivId:n.zoneDivId,zoneEventType:"activate_zone_api",instanceId:n.zoneInstanceId,gpid:n.gpid}),!0)):(this.logger.error("[ZONE][".concat(e,"]: Unknown zone")),!1)}},{key:"isManuallyActivated",value:function(e){var t;return this.REGISTERED_ZONES[e]?null!=(t=this.MANUAL_ACTIVATE_API[e])&&t:(this.logger.error("[ZONE][".concat(e,"]: Unknown zone")),!1)}},{key:"getRegisteredZones",value:function(){var e=this;return Object.keys(this.REGISTERED_ZONES).map((function(t){return e.REGISTERED_ZONES[t]}))}},{key:"reset",value:function(){var e=this;Object.keys(this.REGISTERED_ZONES).forEach((function(t){e.isDeletedZone(t)?e.logger.debug("[EVENT]: resetSlots() unit already deleted ".concat(t)):e.DELETED_ZONES.push(t)})),this.MANUAL_ACTIVATE_API={},this.REGISTERED_ZONES={}}},{key:"deleteZone",value:function(e){var t=this.findByDivId(e);t?this.isDeletedZone(t.zoneInstanceId)?this.logger.warn("[ZONE][".concat(e,"]: Deleted zone")):(delete this.REGISTERED_ZONES[t.zoneInstanceId],this.DELETED_ZONES.push(t.zoneInstanceId)):this.logger.warn("[ZONE][".concat(e,"]: Unknown zone"))}}]),e}(),Ji=!1,Ki=I.getLogger(),Xi=function(){return I.getBrowserWindowObject().fusetag.que},$i=function(){return Xi().length},er=function(){Xi().push=function(e){if("function"==typeof e)try{e.call()}catch(e){Ki.error("Error processing command :",e.message,e.stack)}else Ki.error("Commands written into fusetag.que.push must be wrapped in a function");return 0}},tr=function(){function e(n,i){var r=this;t(this,e),this.f=i,n.immediateOrOnce((function(e){return r.f=e}))}return i(e,[{key:"value",get:function(){return this.f}},{key:"asSupplier",value:function(){var e=this;return function(){return e.f}}}]),e}();function nr(e,t){if(e&&t)return e=new URL(e),t=new URL(t),e.hash="",t.hash="",e.toString()==t.toString()}var ir=function(){function e(n,i,r,o,s,a,u,c){var l=this;t(this,e),this.logger=n,this.initialUrl=i,this.resetPageFn=r,this.setAuctionBlockFn=o,this.setPageTargeting=s,this.events=a,this.currentBreakpoint=u,this.lowDwellPages=c,this.lastPageInitUrl=null,this.tagInitOnce=new tr(this.events.onTagInitComplete),this.events.onTagInitComplete.immediateOrOnce((function(e){l.emitPageInit(e.tagInitUrl,!0)}))}return i(e,[{key:"reset",value:function(){this.logger.info("[PAGE]: Resetting all page state"),this.resetPageFn(),this.emitPageReset()}},{key:"handlePageInitCall",value:function(e,t,n){this.logger.info("[PAGE]: pageInit('".concat(e,"', ").concat(t,", ").concat(JSON.stringify(n)));var i,r=null===this.lastPageInitUrl,o=S(this.tagInitOnce.value);if(r)if(o){if(nr(e,this.initialUrl))return void this.logger.warn("[PAGE]: Ignored pageInit(), because URL unchanged since tag init");this.logger.info("[PAGE]: First pageInit() call, and URL changed since tag init. Resetting."),this.reset(),i=!0}else i=!1;else{if(nr(e,this.lastPageInitUrl))return void this.logger.warn("[PAGE]: Ignored pageInit(), because URL unchanged since last pageInit call");this.logger.info("[PAGE]: pageInit() called, and the URL has changed. Resetting."),i=!0,this.reset()}this.lastPageInitUrl=e,null!=n&&n.pageTargets&&this.setPageTargeting(null==n?void 0:n.pageTargets),null!=n&&n.blockingFuseIds&&this.setBlock(null!=(r=null==n?void 0:n.blockingTimeout)?r:2e3,n.blockingFuseIds,i,t),o&&this.emitPageInit(e,!1)}},{key:"isPageInitCalled",value:function(){return S(this.lastPageInitUrl)}},{key:"isLowDwellUrl",value:function(e){return 0<this.lowDwellPages.filter((function(t){return(t=e.match(t))&&0<t.length})).length}},{key:"emitPageInit",value:function(e,t){t={url:e,isFirstPageInit:t,isLowDwellPage:this.isLowDwellUrl(e),breakpoint:this.currentBreakpoint().name},this.events.onPageInit.emit(t)}},{key:"emitPageReset",value:function(){this.events.onPageReset.emit({breakpoint:this.currentBreakpoint().name})}},{key:"setBlock",value:function(e,t,n,i){(n=n?e:e-i)<=0?this.logger.info("[PAGE][pageInit]: Skipped setting auction block, because there is no time left on the timeout"):(e=t.map((function(e){return"".concat(e)})),this.setAuctionBlockFn(e,n))}}]),e}(),rr=function(){function e(n,i,r,o,s,a,u,c,l,d){t(this,e),this.logger=n,this.settingsGlobal=i,this.slotsController=r,this.slotRegistry=o,this.zoneRegistry=s,this.auctionScheduler=a,this.insertConditionFactory=u,this.slotConditionFactory=c,this.events=l,this.viewportInfo=d,this.settings=new or(this.settingsGlobal)}return i(e,[{key:"getCurrentBreakpointName",value:function(){return this.viewportInfo.getCurrentBreakpoint().name}},{key:"getWindow",value:function(){return this.viewportInfo.browserWindow}},{key:"registerAll",value:function(){this.logger.debug("[APIV3]: registerAll() started");var e=this.slotsController.registerAndRunAuction(!0,!1,this);this.logger.debug("[APIV3]: registerAll() finished, ".concat(e.length," slots found"))}},{key:"processNewSlots",value:function(){this.registerAll()}},{key:"registerZone",value:function(e){return this.logger.debug("[APIV3]: registerZone('".concat(e,"') started")),(e=this.slotsController.registerZoneAndQueue(e,!0,!1,this))&&this.slotsController.runAuction(),e}},{key:"queueZone",value:function(e){return this.logger.debug("[APIV3]: queueZone('".concat(e,"') started")),this.slotsController.registerZoneAndQueue(e,!0,!1,this)}},{key:"runAuction",value:function(){return this.logger.debug("[APIV3]: runAuction() started"),this.slotsController.runAuction()}},{key:"disableRefreshByZone",value:function(e){return this.auctionScheduler.disableSlotRefresh(e)}},{key:"enableRefreshByZone",value:function(e){return this.auctionScheduler.enableSlotRefresh(e)}},{key:"getSlotsForTemplateId",value:function(e){return this.slotRegistry.getSlotsForTemplateId(e)}}]),e}(),or=function(){function e(n){t(this,e),this.settings=n}return i(e,[{key:"getZoneTemplate",value:function(e){return this.settings.getZoneTemplate(e)}},{key:"setDisableWidgetRenderer",value:function(e){this.settings.getV2CompatOverrides().disableWidgetsRenderer=e}}]),e}(),sr=new(function(){function e(){t(this,e)}return i(e,[{key:"configureResponsive",value:function(){var e=this,t=new tr(Ye.onTagInitComplete);Ye.onBreakpointChanged.subscribe((function(n){I.getLogger().info("[RESPONSIVE]: Switching page to breakpoint '".concat(n.name,"'")),e.resetAfterChangedBreakpoint(),S(t.value)?e.getController().registerAndRunAuction(!0,!1,e.getApiV3()):e.getController().registerAndQueue(!0,!1,e.getApiV3())}))}},{key:"getAuctionExecutor",value:function(){var e;return this.auctionExecutor||(e=bt.getSettings(),this.auctionExecutor=new zi(this.getFuseSlotRegistry(),fn.getPrebidGlobal(),Li.getUam(),I.getLogger(),mt.getReporter(),e,Ye,pt.getTouchObserver(),e.getUseTelemetry()&&mt.getTelemetry())),this.auctionExecutor}},{key:"getFuseSlotRegistry",value:function(){return this.fuseSlotRegistry||(this.fuseSlotRegistry=new Zi(I.getLogger(),mt.getReporter(),I.getBrowserWindowObject(),Bn.getGptSlotRegistry(),bt.getSettings(),Ci.getSlotConditionFactory(),pt.getViewportInfo(),Ye)),this.fuseSlotRegistry}},{key:"getZoneRegistry",value:function(){return this.zoneRegistry||(this.zoneRegistry=new Qi(I.getLogger(),mt.getReporter(),Ye.onZoneEvent)),this.zoneRegistry}},{key:"getAuctionScheduler",value:function(){var e=this;return this.auctionScheduler||(this.auctionScheduler=new Fi(I.getLogger(),I.getBrowserWindowObject(),(function(){var t;return(t=e.getAuctionExecutor()).executeAuction.apply(t,arguments)}),(function(t,n){return e.getAuctionPlanner().plan(t,n)}),(function(t){return e.getFuseSlotRegistry().isDeletedSlot(t)}),(function(){return pt.getViewportInfo().getCurrentBreakpoint().name}),pt.getViewportInfo(),bt.getSettings(),jn)),this.auctionScheduler}},{key:"getAuctionPlanner",value:function(){return this.auctionPlanner||(this.auctionPlanner=new Mi(I.getLogger(),bt.getSettings(),pt.getViewportInfo(),(function(){return Fn.getInitManager().isLowDwellPage()}),mt.getComponentStatusStore())),this.auctionPlanner}},{key:"getController",value:function(){return this.controller||(this.controller=new Yi(this.getFuseSlotRegistry(),this.getZoneRegistry(),I.getLogger(),this.getAuctionScheduler(),this.getDomProcessor(),(function(){return Fn.getInitManager().isTagInitialised()}))),this.controller}},{key:"getDomProcessor",value:function(){var e=this;return this.domProcessor||(this.domProcessor=new ji(I.getLogger(),I.getBrowserWindowObject().document,bt.getSettings(),this.getFuseSlotFormatter(),(function(){return mt.getReporter().getElapsedTime()}),(function(){return e.getApiV3()}))),this.domProcessor}},{key:"getFuseSlotFormatter",value:function(){return this.fuseSlotFormatter||(this.fuseSlotFormatter=new Hi(I.getLogger(),bt.getSettings(),pt.getViewportInfo())),this.fuseSlotFormatter}},{key:"getPageManager",value:function(){var e,t=this;return this.pageManager||(e=bt.getSettings(),this.pageManager=new ir(I.getLogger(),I.getBrowserWindowObject().location.href,(function(){return t.resetPage()}),(function(t,n){e.isSpaOldBlockingPageInit()||sr.getAuctionScheduler().setAuctionBlock(t,n)}),(function(e){e.forEach((function(e){return jn(e.key,e.value)}))}),Ye,pt.getViewportInfo().breakpointSupplier(),e.getLowDwellPages())),this.pageManager}},{key:"resetAfterChangedBreakpoint",value:function(){Bn.getGptSlotRegistry().purgeAll(),Rn(),this.getController().reset()}},{key:"resetPage",value:function(){Wn(),qi(),Ht(),Et={},Ct={},Tt=!0,Bn.getGptSlotRegistry().purgeAll(),Rn(),sr.getController().reset(),Wn(),qi()}},{key:"getApiV3",value:function(){return this.apiV3||(this.apiV3=new rr(I.getLogger(),bt.getSettings(),this.getController(),this.getFuseSlotRegistry(),this.getZoneRegistry(),this.getAuctionScheduler(),Ci.getInsertConditionFactory(),Ci.getSlotConditionFactory(),Ye,pt.getViewportInfo())),this.apiV3}}]),e}()),ar=function(){function e(n,i,r,o){t(this,e),this.logger=n,this.settings=i,this.insertFactory=r,this.apiV3=o,this._hasInterstitial=!1}return i(e,[{key:"hasInterstitial",get:function(){return this._hasInterstitial}},{key:"initInterstitial",value:function(){var e,t,n=this;this._hasInterstitial?this.logger.log("[INTERSTITIAL]: Already present"):(this.logger.info("[INTERSTITIAL]: Initialising"),null!=(e=this.getInterstitialSlot())&&e.injectConditionConfig?(t=this.insertFactory.buildActivator(e.injectConditionConfig,e.id,this.apiV3,(function(){n.setInterstitialSlot(e)}))).checkCondition()?this.setInterstitialSlot(e):t.enableTriggers():e&&this.setInterstitialSlot(e))}},{key:"clearInterstitial",value:function(){var e,t;this._hasInterstitial?(this.logger.info("[INTERSTITIAL]: Clearing"),(t=this.getInterstitialSlot())&&(e=t.slot,t=ht.pubads().getSlots().filter((function(t){return t.getOutOfPage()&&e===t.getAdUnitPath()})),Yt(t),this._hasInterstitial=!1)):this.logger.log("[INTERSTITIAL]: No interstitial to clear")}},{key:"getInterstitialSlot",value:function(){return this.settings.getFuseSlots().find((function(e){return!0===(null==(e=e.attributes)?void 0:e.interstitial)}))}},{key:"setInterstitialSlot",value:function(e){(e=ht.defineOutOfPageSlot(e.slot,ht.enums.OutOfPageFormat.INTERSTITIAL))?(e.addService(ht.pubads()),ht.enableServices(),ht.display(e),jt(),_t.info("[GPT]: Requesting interstitial refresh for ".concat(e.getSlotElementId())),ht.pubads().refresh([e],{changeCorrelator:!1})):_t.warn("setInterstitialSlot(): googletag.defineOutOfPageSlot returned undefined"),this._hasInterstitial=!0}}]),e}(),ur=function(){function e(n,i,r){t(this,e),this.slot=n,this.logger=i,this.viewportInfo=r,this.incrementalCounter=0}return i(e,[{key:"getZoneDivId",value:function(){return"fuse-injected-".concat(this.slot.id,"-").concat(++this.incrementalCounter)}},{key:"createSlotElement",value:function(){return this.toHTML('<div id="'.concat(this.getZoneDivId(),'" data-fuse="').concat(this.slot.id,'" data-fuse-injected-at="').concat((new Date).getTime(),'" class="fuse-slot-').concat(this.type,'"></div>'))}},{key:"toHTML",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}},{key:"getSlotNonFluidSizes",value:function(){var e,t=this.viewportInfo.getCurrentBreakpoint().name;return null==(e=null==(e=this.slot.sizeMapping)?void 0:e[t])?void 0:e.filter((function(e){return"fluid"!==e}))}},{key:"getSlotMaxNonFluidHeight",value:function(){var e;return(e=(e=this.getSlotNonFluidSizes())?e.map((function(e){return Number(e[1])})):[]).length?Math.max.apply(Math,l(e)):0}},{key:"getSlotMaxNonFluidWidth",value:function(){var e;return(e=(e=this.getSlotNonFluidSizes())?e.map((function(e){return Number(e[0])})):[]).length?Math.max.apply(Math,l(e)):0}},{key:"getLogContext",value:function(){return"[".concat(this.type,"][").concat(this.slot.id,"]:")}},{key:"getClassName",value:function(){return"publift-widget-".concat(this.slot.id)}},{key:"getContainerElement",value:function(){return document.querySelector(".".concat(this.getClassName(),"-container"))}},{key:"getStylesElement",value:function(){return document.querySelector("#".concat(this.getClassName(),"-styles"))}},{key:"getWidgetElement",value:function(){return document.querySelector(".".concat(this.getClassName()))}}]),e}(),cr=function(){o(n,ur);var e=u(n);function n(i,r,o,s,a,u){var c,l=!(6<arguments.length&&void 0!==arguments[6])||arguments[6];return t(this,n),(c=e.call(this,i,r,o)).slot=i,c.logger=r,c.viewportInfo=o,c.registerAdRendered=s,c.apiV3=a,c.onShowCloseCallback=u,c.waitForCreative=l,c.loadingByCreative=!1,c.hiddenForever=!1,c.hasLoadedCreative=!1,c.type="sticky",c.barScrollHeight=0,c.barHeight=60,c.scrollingHeight=500,c.scrollCreative=!1,c.creativeHeight=0,c.scrollOffset=0,c.scrollPosition=0,c.scrollMultiplier=0,c.slotRenderCallbackRegistered=!1,c.attributes=c.makeAttributes(),c.scrollCreative=(null==(i=c.slot.stickyAttributes)?void 0:i.scrollCreative)||!1,c.scrollableElement=null!=(r=c.slot.stickyAttributes)&&r.scrollableSelector?o.browserWindow.document.querySelector(null==(s=c.slot.stickyAttributes)?void 0:s.scrollableSelector):o.browserWindow,c.setHeights(0),c}return i(n,[{key:"createWidget",value:function(e){var t=this.getClassName();return this.toHTML('\n<div class="'.concat(t,'-container closed" style="display: ').concat(0===e?"none":"block",'">\n<div class="').concat(t,'-container-background">\n</div>\n  <div class="').concat(t,'-button">\n    <div></div>\n    <div></div>\n  </div>\n  <div class="').concat(t,'">\n  </div>\n</div>\n'))}},{key:"getHideAtElement",value:function(){var e=this.getAttributes().hideSelector;return e?document.querySelector(e):null}},{key:"getFixedElement",value:function(){var e=this.getAttributes().fixedSelector;return e?document.querySelector(e):null}},{key:"getFixedClass",value:function(){return"".concat(this.getClassName(),"-fixed")}},{key:"getWidgetCloseButtonElement",value:function(){return document.querySelector(".".concat(this.getClassName(),"-button"))}},{key:"makeAttributes",value:function(){var e=Object.assign({bgColor:"#EFEFEF",bgOpacity:.7,allowClose:!1,buttonColor:"#313131",barColor:"#EFEFEF",borderWidth:"0px",zIndex:2147483645,compact:!1},this.slot.stickyAttributes);return e.compact&&(e.bgOpacity=1,e.bgColor=e.barColor),e}},{key:"addContent",value:function(e,t){var n=this,i=this.getClassName(),r=e.querySelector(".".concat(i)),o=this.createSlotElement();return null!=(r=(r.appendChild(o),e.querySelector(".".concat(i,"-button")).addEventListener("click",(function(){e.classList.contains("closed")?n.onShow():n.onClose(),clearInterval(n.hideAtElementInterval)})),document.querySelector("body")))&&r.insertAdjacentElement("beforeend",t),null!=r&&r.insertAdjacentElement("beforeend",e),o}},{key:"getButtonStyles",value:function(e,t,n,i,r){return e?t?"border-radius: 0 0 2px 2px; top: ".concat(n,"px;"):"border-radius: 2px 2px 0 0; top: -20px;":t?"border-radius: 2px 2px 0 0; top: ".concat(i-20+r,"px;"):"border-radius: 0 0 2px 2px; top: 0px;"}},{key:"getFixedSelectorStyles",value:function(e,t,n,i,r){return t?".".concat(e,"-fixed {\n  ").concat(n?"top":"bottom"," : ").concat(i?r:0,"px !important;\n}\n").concat(t," {\n  transition: ").concat(n?"top":"bottom"," .3s linear;\n}"):""}},{key:"createStyles",value:function(){var e=(d=this.getAttributes()).zIndex,t=d.compact,n=d.isTop,i=d.isButtonOutside,r=d.bgColor,o=d.bgOpacity,s=d.barColor,a=d.allowClose,u=d.allowReopen,c=d.buttonColor,l=d.fixedSelector,d=d.borderWidth,g=this.getSlotMaxNonFluidHeight(),h=this.getContainerBordersSize(),f=this.getContainerBorderSize(),p=g+h,v=(h=this.getSlotMaxNonFluidWidth()+h,u&&i?f:0),b=this.getClassName();return this.toHTML('\n<style id="'.concat(b,'-styles">\n.').concat(b,"-container {\n  direction: ltr;\n  z-index: ").concat(e,";\n  position: fixed;\n  ").concat(n?"top: 0":"bottom: 0",";\n  width: ").concat(t?h+"px":"100%",";\n  height: ").concat(p,"px;\n  transition: transform .3s linear, height .3s linear;\n  ").concat(i?"":"overflow: hidden;","\n  ").concat(t?"left: 50%; transform: translateX(-50%);":"left: 0;","\n}\n\n.").concat(b,"-container-background {\n  background-color: ").concat(r,";\n  opacity: ").concat(o,";\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: -1;\n}\n\n.").concat(b,"-button {\n  width: 40px;\n  margin-left: 2px;\n  height: 20px;\n  background-color: ").concat(s,";\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  display: ").concat(a?"flex":"none",";\n  transition: top .3s linear;\n  ").concat(this.getButtonStyles(Boolean(i),Boolean(n),p,g,f),"\n}\n.").concat(b,"-button :first-child, .").concat(b,"-button :last-child  {\n  background-color: ").concat(c,";\n  width: 13px;\n  height: 3px;\n  border-radius: 2px;\n}\n.").concat(b,"-button :first-child {\n  transform: rotate(").concat(n?"-":"","30deg) translateX(2px);\n}\n.").concat(b,"-button :last-child {\n  transform: rotate(").concat(n?"":"-","30deg) translateX(-2px);\n}\n.").concat(b," {\n  width: ").concat(t?h+"px":"100%",";\n  height: ").concat(p,"px;\n  display: flex;\n  justify-content: center;\n  align-items: ").concat(this.scrollCreative?"baseline":"center",";\n  transition: transform .3s linear, height .3s linear;\n  border").concat(t?"":n?"-bottom":"-top",": ").concat(d," solid ").concat(s,";\n  ").concat(null!=(e=this.slot.stickyAttributes)&&e.scrollCreative?"overflow: hidden":"","\n}\n.").concat(b,"-container.closed {\n  ").concat(n?"transform: translateY(-".concat(p-v,"px)").concat(t?" TranslateX(-50%)":"",";"):"height: "+v+"px !important;","\n}\n.").concat(b,"-container.closed .").concat(b,"-button {\n  visibility: ").concat(u?"visible":"hidden",";\n  ").concat(u?"":"display: none;","\n}\n.").concat(b,"-container.closed .").concat(b,"-button :first-child {\n  transform: rotate(").concat(n?"":"-","30deg) translateX(2px);\n}\n.").concat(b,"-container.closed .").concat(b,"-button :last-child {\n  transform: rotate(").concat(n?"-":"","30deg) translateX(-2px);\n}\n").concat(this.getFixedSelectorStyles(b,l,Boolean(n),g,p),"\n</style>\n"))}},{key:"getContainerBorderSize",value:function(){var e=this.getAttributes().borderWidth;return Number(e.substring(0,e.length-2))}},{key:"getContainerBordersSize",value:function(){var e=this.getAttributes().compact;return this.getContainerBorderSize()*(e?2:1)}},{key:"getAttributes",value:function(){return this.attributes}},{key:"insert",value:function(){var e=this,t=(this.logger.debug("".concat(this.getLogContext()," add widget")),this.createWidget(this.getSlotMaxNonFluidHeight())),n=this.createStyles();t=this.addContent(t,n);return this.viewportInfo.browserWindow.requestAnimationFrame((function(){e.show()})),this.getHideAtElement()&&this.setHideAtElementListener(),this.scrollCreative&&this.scrollableElement&&this.scrollableElement.addEventListener("scroll",(function(){e.updateWidgetPosition()})),[t]}},{key:"getSlotMaxNonFluidHeight",value:function(){return this.barHeight}},{key:"setHeights",value:function(e){this.creativeHeight=e;var t=(n=this.getSlotNonFluidSizes())&&n.length?n.map((function(e){return Number(e[1])})):[0],n=this.slot.stickyAttributes.heightCalculationMethod,i=t.sort((function(e,t){return t-e}));if(this.scrollCreative)switch(n){case"half_max":this.barHeight=i[0]/2+1;break;case"second_max":this.barHeight=i[1]||i[0];break;case"min":this.barHeight=Math.min.apply(Math,l(t));break;default:this.barHeight=Math.max.apply(Math,l(t))}else this.barHeight=Math.max.apply(Math,l(t));this.barScrollHeight=e?e-this.barHeight:0}},{key:"hideAtElementListener",value:function(){var e=this.getContainerElement(),t=this.getHideAtElement(),n=this.getAttributes().isHideForever;S(t)&&e&&(Vi(this.viewportInfo.getViewportStatus(),t,1,0)?e.classList.contains("closed")||(this.hide(),n&&clearInterval(this.hideAtElementInterval)):e.classList.contains("closed")&&this.show())}},{key:"setHideAtElementListener",value:function(){var e=this;this.getHideAtElement()&&(this.hideAtElementInterval=setInterval((function(){e.hideAtElementListener()}),500))}},{key:"isHideSelectorVisible",value:function(){var e=this.getHideAtElement();return!(!e||!Vi(this.viewportInfo.getViewportStatus(),e,1,0))}},{key:"onBreakpointChange",value:function(){var e,t,n,i,r=this.getAttributes().compact,o=this.getContainerElement(),s=this.getWidgetElement();s&&(this.setHeights(0),e=this.barHeight,i=(t=this.getSlotMaxNonFluidWidth())+(n=this.getContainerBordersSize()),o.style.height=(0===e?0:e+n)+"px",o.style.display=0===e?"none":"block",r&&e&&(o.style.width=i+"px",s.style.width=t+"px"),s.style.height=e+"px",0===e||this.isHideSelectorVisible()?this.updateFixedElement(!0):this.updateFixedElement(),this.getStylesElement().innerHTML=this.createStyles().innerHTML)}},{key:"delete",value:function(){this.logger.debug("".concat(this.getLogContext()," delete sticky"));var e=this.getStylesElement(),t=this.getContainerElement();return this.updateFixedElement(!0),this.getAttributes().hideSelector&&clearInterval(this.hideAtElementInterval),e&&e.remove(),t&&t.remove(),!0}},{key:"getSlotElement",value:function(){return document.querySelector(".".concat(this.getClassName()," .fuse-slot-sticky"))}},{key:"getScrollY",value:function(){var e;return null!=(e=this.slot.stickyAttributes)&&e.scrollableSelector?this.scrollableElement.scrollTop:this.scrollableElement.scrollY}},{key:"updateWidgetPosition",value:function(e){var t,n,i;this.scrollCreative&&this.hasLoadedCreative&&(n=(t=this.slot.stickyAttributes).scrollingHeight,t=t.scrollableSelector,n&&(-1!==(n=n.trim()).indexOf("vh")?this.scrollingHeight=t?this.scrollableElement.scrollHeight-(this.scrollableElement.offsetHeight||0):Number(n.replace("vh",""))*this.viewportInfo.browserWindow.innerHeight:this.scrollingHeight=Number(n.replace("px",""))),this.scrollMultiplier=this.barScrollHeight/this.scrollingHeight,t=this.getScrollY(),this.logger.debug("".concat(this.getLogContext()," updateWidgetPosition before"),e,this.creativeHeight,this.barHeight,this.scrollOffset,this.scrollPosition,this.getWidgetElement().style.marginTop,t,this.scrollingHeight),e?this.getWidgetElement().style.alignItems=this.creativeHeight>this.barHeight?"baseline":this.attributes.isTop?"start":"end":this.creativeHeight>this.barHeight&&(i=(n=t-this.scrollPosition)*this.scrollMultiplier,this.scrollOffset+=i,this.logger.debug("".concat(this.getLogContext()," updateWidgetPosition check"),i,n,this.scrollOffset),n<=0?this.scrollOffset<=0&&(this.scrollOffset=0):this.scrollOffset>this.barScrollHeight&&(this.scrollOffset=this.barScrollHeight),this.getSlotElement().style.marginTop="-"+this.scrollOffset+"px",this.scrollPosition=t),this.logger.debug("".concat(this.getLogContext()," updateWidgetPosition after"),e,this.creativeHeight,this.barHeight,this.scrollOffset,this.scrollPosition,this.getWidgetElement().style.marginTop,this.scrollMultiplier,this.barScrollHeight))}},{key:"show",value:function(){var e=this,t=this.slot.id;return this.logger.debug("".concat(this.getLogContext()," showing with waitForCreative ").concat(this.waitForCreative)),this.loadingByCreative||(this.waitForCreative&&!this.hasLoadedCreative?(this.loadingByCreative=!0,this.slotRenderCallbackRegistered||(this.logger.debug("".concat(this.getLogContext()," register slotRender callback")),this.registerAdRendered((function(n){var i,r,o;-1!==n.slot.getSlotElementId().indexOf(t)&&(e.scrollCreative&&n.size&&(i=Number(n.size[1]),r=0,o=n.slot.getTargeting("hb_size")[0]||n.slot.getTargeting("amznsz")[0],1===i&&o&&(r=j(o)[1],e.logger.debug("".concat(e.getLogContext()," get height ").concat(r," from targeting"))),e.setHeights(r||i),e.updateWidgetPosition(!0)),e.logger.debug("".concat(e.getLogContext()," show widget by creative ").concat(n.slot.getSlotElementId())),!e.isHideSelectorVisible()&&e.loadingByCreative&&e.onShow(),e.loadingByCreative=!1,e.hasLoadedCreative=!0)})),this.slotRenderCallbackRegistered=!0)):this.onShow()),!0}},{key:"onShow",value:function(){var e=this,t=this.getContainerElement();t&&(t.classList.remove("closed"),this.updateFixedElement(),this.apiV3.getSlotsForTemplateId(this.slot.id).forEach((function(t){t&&e.apiV3.enableRefreshByZone(t.slotDivId)})),this.onShowCloseCallback())}},{key:"onClose",value:function(){var e=this,t=this.getContainerElement();t&&(t.classList.add("closed"),this.updateFixedElement(!0),this.apiV3.getSlotsForTemplateId(this.slot.id).forEach((function(t){t&&e.apiV3.disableRefreshByZone(t.slotDivId)})),this.onShowCloseCallback())}},{key:"hide",value:function(){return this.logger.debug("".concat(this.getLogContext()," hiding")),this.onClose(),!0}},{key:"updateFixedElement",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=(this.logger.debug("".concat(this.getLogContext()," updateFixedElement ").concat(t?"restore":"update")),this.getFixedElement());n&&(e=this.getFixedClass(),t?n.classList.remove(e):n.classList.add(e))}}]),n}(),lr=function(){o(n,ur);var e=u(n);function n(i,r,o,s,a){var u;return t(this,n),(u=e.call(this,i,r,o)).slot=i,u.logger=r,u.viewportInfo=o,u.registerAdRendered=s,u.widgetsRenderer=a,u.type="interscroller",u}return i(n,[{key:"getAttributes",value:function(){return Object.assign({selector:".adBreak",showBanner:!1,height:"100vh",zIndex:1e7,top:"auto"},this.slot.interscrollerAttributes)}},{key:"getTopOffset",value:function(){return this.widgetsRenderer.getMiniScrollersTopOffset()}},{key:"insert",value:function(){var e=this,t=(o=this.getAttributes()).showBanner,n=o.zIndex,i=o.top,r=o.height,o=o.selector,s=this.getSlotMaxNonFluidHeight(),a=this.createSlotElement(),u=this.getClassName();t=t?'<div class="'.concat(u,'-container-message banner_top">Advertisement</div>'):"",t=this.toHTML('\n    <div class="'.concat(u,'-container">\n      ').concat(t,'\n        <div class="').concat(u,'-scroll-clip">\n          <div class="').concat(u,' publift-widget-interscroller">').concat(a.outerHTML,"</div>\n        </div>\n    </div>\n  ")),n=this.toHTML('\n  <style id="'.concat(u,'-styles">\n  .').concat(u,"-container {\n    width: 100vw;\n    min-height: ").concat(r,";\n    z-index: ").concat(n,";\n    position: relative;\n    display: ").concat(0===s?"none":"block",";\n  }\n\n  .").concat(u,"-container-message {\n    position: absolute;\n    background-color: black;\n    color: white;\n    padding: .5em;\n    text-align: center;\n    font-family: sans-serif;\n    width: calc(100% - 1em);\n    z-index: 9999;\n  }\n\n  .").concat(u,"-scroll-clip {\n    position: absolute;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    clip-path: inset(0px);\n    clip: rect(0px, auto, auto, 0px);\n    min-height: ").concat(r,"\n  }\n\n  .").concat(u," {\n    position: fixed;\n    top: ").concat(i||this.widgetsRenderer.getMiniScrollersTopOffset()+"px"," !important;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    bottom: 0;\n    transform: translateZ(0px);\n  }\n  </style>\n  "));if(s=document.querySelector("body")){if(r=document.querySelector(o))return s.insertAdjacentElement("beforeend",n),r.appendChild(t),u=t.getBoundingClientRect().x-s.getBoundingClientRect().x,t.style.marginLeft="-".concat(u,"px"),t.style.marginRight="-".concat(u,"px"),[a];this.logger.info("".concat(this.getLogContext()," insertionPoint with selector not found: ").concat(o))}return this.registerAdRendered((function(t){var n,i;e.logger.debug("".concat(e.getLogContext()," gpt event ").concat(JSON.stringify(t))),-1!==t.slot.getSlotElementId().indexOf(e.slot.id)&&(e.logger.debug("".concat(e.getLogContext()," gpt event suit")),t.creativeId)&&t.size&&(e.logger.debug("".concat(e.getLogContext()," gpt event creative ").concat(t.size[1])),n=Number(t.size[1]),i=0,t=t.slot.getTargeting("hb_size")[0]||t.slot.getTargeting("amznsz")[0],1===n&&t&&(i=j(t)[1],e.logger.debug("".concat(e.getLogContext()," get height ").concat(i," from targeting"))),e.updateWidgetPosition(i||n))})),[]}},{key:"updateWidgetPosition",value:function(e){var t=this.getSlotMaxNonFluidHeight(),n=this.widgetsRenderer.getMiniScrollersTopOffset(),i=(this.viewportInfo.browserWindow.innerHeight-(1<e?e:t))/2,r=n;this.logger.debug("".concat(this.getLogContext()," get top offset ").concat(r," for adunit size ").concat(e," maxHeight ").concat(t," topOffsetCentered ").concat(i," topOffsetSettings ").concat(n)),this.getWidgetElement().style.top="".concat(r,"px")}},{key:"onBreakpointChange",value:function(){var e=this.getSlotMaxNonFluidHeight(),t=this.getContainerElement();t&&(t.style.display=0===e?"none":"block")}},{key:"delete",value:function(){var e=this.getStylesElement(),t=this.getContainerElement();return!(!e||!t||(e.remove(),t.remove(),0))}},{key:"hide",value:function(){return this.getContainerElement().style.display="none",!0}},{key:"show",value:function(){return this.getContainerElement().style.display="block",!0}}]),n}(),dr=function(){o(n,ur);var e=u(n);function n(){var i;return t(this,n),(i=e.apply(this,arguments)).type="dynamic",i}return i(n,[{key:"getAttributes",value:function(){return Object.assign(Object.assign({},this.slot.dynamicAttributes),{skip:Number(this.slot.dynamicAttributes.skip||0),each:Number(this.slot.dynamicAttributes.each||0),incrementEach:Number(this.slot.dynamicAttributes.incrementEach||0),repeatHeight:Number(this.slot.dynamicAttributes.repeatHeight||1e3)})}},{key:"createElement",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=this.createSlotElement();return e&&e.split(" ").forEach((function(e){return n.classList.add(e)})),t&&(n.style.cssText=t),n}},{key:"canBeInserted",value:function(e){var t,n=this.getLogContext();return e?(t=document.querySelectorAll(e)).length?(this.logger.debug("".concat(n," Page has ").concat(t.length," elements suitable for selector ").concat(e)),!0):(this.logger.info("".concat(n," No element with selector ").concat(e," found")),!1):(this.logger.warn("".concat(n," Selector should be defined")),!1)}},{key:"notFuseSlot",value:function(e){return!e||e.getAttribute("data-fuse")!==this.slot.id||(this.logger.debug("".concat(this.getLogContext()," Skip insertion cause slot already inserted")),!1)}},{key:"filterNodes",value:function(e){var t=this.getAttributes(),n=t.skip,i=t.each,r=t.position,o=t.incrementEach,s=[],a=0,u=i;return e.forEach((function(e,t){if(t+=1,n&&t<=n)return!1;if("incontent"!==r&&u){if((t-n-a)%u!=0)return!1;o&&(a+=u,u+=o)}s.push(e)})),s}},{key:"getZoneDiv",value:function(e){return 1<arguments.length&&void 0!==arguments[1]&&arguments[1]?e.querySelector("div[data-fuse]"):e}},{key:"insert",value:function(){var e,t,n=this,i=this.getAttributes(),r=i.selector,o=i.position,s=i.classNames,a=i.css,u=i.wrapperContent,c=i.repeatHeight;return this.canBeInserted(r)?(i=document.querySelectorAll(r),e=0,t=[],this.filterNodes(i).forEach((function(i){var r=n.createElement(s,a),l=r,d=(u&&(r=n.wrapElement(r,u)),i.nextElementSibling),g=i.parentNode,h=i.previousElementSibling,f=i.lastElementChild;switch(o){case"after":n.notFuseSlot(d)&&(g.insertBefore(r,d),t.push(l));break;case"before":n.notFuseSlot(h)&&(g.insertBefore(r,i),t.push(l));break;case"replace":i.replaceWith(r),t.push(l);break;case"incontent":var p=i.getBoundingClientRect().top+i.getBoundingClientRect().height+document.documentElement.scrollTop;p=Math.floor(p/c);e<p&&(e=p,n.notFuseSlot(d))&&(g.insertBefore(r,d),t.push(l));break;default:n.notFuseSlot(f)&&(i.appendChild(r),t.push(l))}})),t):(this.logger.debug("".concat(this.getLogContext()," Injection skipped")),[])}},{key:"wrapElement",value:function(e,t){var n=document.createElement("div");return n.innerHTML=t,n.firstElementChild.appendChild(e),n.firstElementChild}},{key:"delete",value:function(){var e=document.querySelectorAll('[data-fuse="'.concat(this.slot.id,'"]'));return e.forEach((function(e){e.remove()})),0<e.length}},{key:"hide",value:function(){throw new Error("Method not implemented.")}},{key:"show",value:function(){throw new Error("Method not implemented.")}},{key:"onBreakpointChange",value:function(){throw new Error("Method not implemented.")}}]),n}(),gr=function(){function e(n,i){t(this,e),this.logger=n,this.widgetsRenderer=i,this.checkInterval=null,this.statuses=[]}return i(e,[{key:"getStatuses",value:function(){return this.statuses}},{key:"start",value:function(e){var t=this;(1<arguments.length&&void 0!==arguments[1]&&arguments[1]||!this.statuses.length)&&(this.logger.debug("[WIDGETS][CHECKER] Start to check slots"),this.statuses=e.filter((function(e){var t;return(null==(t=e.dynamicAttributes)?void 0:t.selector)||(null==(t=e.interscrollerAttributes)?void 0:t.selector)})).map((function(e){var n=(null==(n=e.dynamicAttributes)?void 0:n.selector)||(null==(n=e.interscrollerAttributes)?void 0:n.selector);return{slot:e,selector:n,countSelector:t.countSelector(n),countSlot:t.countSlot(e.id)}})),this.statuses.length)&&(this.checkInterval=setInterval((function(){return t.check()}),100))}},{key:"stop",value:function(){this.checkInterval&&clearInterval(this.checkInterval),this.statuses=[]}},{key:"check",value:function(){var e=this;this.statuses.forEach((function(t){var n=t.slot,i=e.countSelector(t.selector),r=e.countSlot(n.id);t.countSelector===i&&t.countSlot===r||n.injectConditionConfig||(e.logger.debug("[WIDGETS][".concat(n.id,'] Injecting by selector "').concat(t.selector,'" change: selectors ').concat(i," slots ").concat(r)),e.widgetsRenderer.injectWidget(t.slot),t.countSelector=e.countSelector(t.selector),t.countSlot=e.countSlot(t.slot.id))}))}},{key:"countSelector",value:function(e){return document.querySelectorAll(e).length}},{key:"countSlot",value:function(e){return document.querySelectorAll('[data-fuse="'.concat(e,'"]')).length}}]),e}(),hr=function(){function e(n,i,r,o,s,a,u){var c=this;t(this,e),this.logger=n,this.settings=i,this.apiV3=r,this.conditionFactory=o,this.viewportInfo=s,this.events=a,this.videoManager=u,this.inited=!1,this.widgets=[],this.widgetsChecker=new gr(this.logger,this),this.events.onBreakpointChanged.subscribe((function(){return c.handleBreakpointChange()})),this.events.onPageInit.subscribe((function(e){e.isFirstPageInit||c.reset()}))}return i(e,[{key:"getStickySlots",value:function(){return this.settings.getFuseSlots().filter((function(e){return null==(e=e.attributes)?void 0:e.sticky}))}},{key:"getInterscrollerSlots",value:function(){return this.settings.getFuseSlots().filter((function(e){return null==(e=e.attributes)?void 0:e.interscroller}))}},{key:"getDynamicSlots",value:function(){return this.settings.getFuseSlots().filter((function(e){return null==(e=e.attributes)?void 0:e.dynamic}))}},{key:"getScrollToStickSlots",value:function(){return this.settings.getFuseSlots().filter((function(e){return null==(e=e.attributes)?void 0:e.scrollToStick}))}},{key:"getMiniscrollerSlots",value:function(){return this.settings.getFuseSlots().filter((function(e){return null==(e=e.attributes)?void 0:e.miniscroller}))}},{key:"isSlotInjected",value:function(e){return null!==document.querySelector('[data-fuse="'.concat(e.id,'"]'))}},{key:"getWidget",value:function(e){return this.widgets.filter((function(t){return t.slot.id===e.id}))[0]}},{key:"removeWidget",value:function(e){var t=this.getWidget(e);return t?(t.delete(),this.logger.debug("[WIDGETS][".concat(e.id,"] Widget deleted")),!0):(this.logger.debug("[WIDGETS][".concat(e.id,"] Widget was not found")),!1)}},{key:"handleBreakpointChange",value:function(){var e=this,t=this.getStickySlots(),n=this.getInterscrollerSlots();this.logger.info("[WIDGETS] onBreakpointChange Stickies: ".concat(t.length," Scrolls: ").concat(n.length)),t.concat(n).forEach((function(t){(t=e.getWidget(t))&&t.onBreakpointChange()}))}},{key:"getWidgetSlots",value:function(){return this.getDynamicSlots().concat(this.getInterscrollerSlots(),this.getStickySlots())}},{key:"getWidgetsWithSelector",value:function(){return this.getDynamicSlots().concat(this.getInterscrollerSlots())}},{key:"insertStyles",value:function(e){var t=document.createElement("div");t.innerHTML=e,document.querySelector("body").insertAdjacentElement("beforeend",t.firstElementChild)}},{key:"cleanupDynamicSlots",value:function(){this.getDynamicSlots().forEach((function(e){document.querySelectorAll('[data-fuse="'.concat(e.id,'"]')).forEach((function(e){e.remove()}))}))}},{key:"injectWidget",value:function(e){var t=this,n=(r=(this.logger.debug("[WIDGETS][".concat(e.id,"] Inject widget")),e.attributes)).sticky,i=r.interscroller,r=r.dynamic,o=this.getWidget(e),s=!1;if((n||i)&&this.isSlotInjected(e))this.logger.debug("[WIDGETS][".concat(e.id,"] Skip injection. DOM element exists"));else{if(!o){if(n)o=new cr(e,this.logger,this.viewportInfo,(function(e){return qt(e)}),this.apiV3,(function(){t.updateFuseStyles()}),!this.settings.isYandexEnabled()),s=e.stickyAttributes.isTop;else if(i)o=new lr(e,this.logger,this.viewportInfo,(function(e){return qt(e)}),this);else{if(!r)return void this.logger.warn("[WIDGETS][".concat(e.id,"] Skip injection of unknown widget"));this.logger.debug("[WIDGETS][".concat(e.id,"] Injecting dynamic slot with attributes ").concat(JSON.stringify(e.dynamicAttributes))),o=new dr(e,this.logger,this.viewportInfo)}this.widgets.push(o)}n=o.insert();var a=this.videoManager.getSettings();n.forEach((function(e){t.logger.debug("[WIDGETS][".concat(e.id,"] Run queueZone")),t.apiV3.queueZone(e.id),a.enabled&&a.injectedAdUnitId&&e.id.includes(a.injectedAdUnitId)&&t.videoManager.initVideo(!0)})),0<n.length&&this.apiV3.runAuction(),s&&this.updateFuseStyles()}}},{key:"render",value:function(){var e=this;this.getWidgetSlots().forEach((function(t){var n;!t.injectConditionConfig||(n=e.conditionFactory.buildActivator(t.injectConditionConfig,t.id,e.apiV3,(function(){e.injectWidget(t)}))).checkCondition()?e.injectWidget(t):n.enableTriggers()}))}},{key:"init",value:function(){this.logger.debug("[WIDGETS] Init"),this.inited?this.logger.debug("[WIDGETS] Skipped initialisation as it is already initialised"):(this.inited=!1,this.render(),this.widgetsChecker.start(this.getWidgetsWithSelector()),this.addScrollToStickListener(),this.injectFuseStyles(),this.inited=!0)}},{key:"cleanup",value:function(){var e=this;this.logger.debug("[WIDGETS] cleanup"),this.widgetsChecker.stop(),this.getWidgetSlots().forEach((function(t){return e.removeWidget(t)}))}},{key:"reset",value:function(){this.cleanup(),this.logger.debug("[WIDGETS] reset"),this.render(),this.widgetsChecker.start(this.getWidgetsWithSelector(),!0)}},{key:"getMiniScrollersTopOffset",value:function(){var e=this,t=0,n=this.settings.getTopStickyHeaderSelector();return n&&(n=document.querySelector(n))&&(t+=n.clientHeight,this.logger.debug("[WIDGETS] miniscrollers offset set to ".concat(t," because of topStickyHeader"))),this.getStickySlots().forEach((function(n){var i;null!=(i=n.stickyAttributes)&&i.isTop&&(i=e.getWidget(n))&&i.getContainerElement()&&!i.getContainerElement().classList.contains("closed")&&(i=e.settings.maxSlotHeightForBreakpoint(n,e.viewportInfo.getCurrentBreakpoint().name),t+=null!=i?i:0,e.logger.debug("[WIDGETS] miniscrollers offset set to ".concat(t," because of top sticky")))})),t}},{key:"injectFuseStyles",value:function(){var e,t,n;document.getElementById("publift-fuse-styles")?this.logger.debug("[WIDGETS] styles already injected"):(e="",t=this.getMiniScrollersTopOffset(),this.settings.isMiniScrollersEnabled()&&(this.logger.debug("[WIDGETS] inject fuse styles"),n="\n      .fuse-slot-mini-scroller .fuse-slot {\n        top: ".concat(0|t,"px;\n        position: sticky !important;\n        overflow: hidden !important;\n      }\n      .fuse-slot-mini-scroller {\n        overflow: initial !important;\n        display: block !important;\n      }\n      "),this.logger.debug("[WIDGETS] injected miniScroller styles"),e+=n),e+="\n    .fuse-slot-scroll-to-stick .fuse-slot {\n      z-index: 9999;\n      top: ".concat(0|t,"px;\n      position: fixed;\n      width: 100%;\n      left: 0px;\n      pointer-events: none;\n    }\n    .publift-widget-interscroller {\n      top: ").concat(0|t,"px;\n    }"),this.insertStyles('<style id="publift-fuse-styles">'.concat(e,"</style>")))}},{key:"updateFuseStyles",value:function(){var e=document.getElementById("publift-fuse-styles");e&&e.remove(),this.injectFuseStyles()}},{key:"getScrollToStickPrevElement",value:function(e){return e.previousElementSibling||this.getScrollToStickPrevElement(e.parentElement)}},{key:"addScrollToStickListener",value:function(){var e=this,t=this.getMiniScrollersTopOffset(),n=this.getScrollToStickSlots(),i=this.settings.scrollToStickDisableDepth()||0;n.length&&(this.logger.debug("[WIDGETS] scrollToStick slots found ".concat(this.getScrollToStickSlots().length,". Attach scroll listener")),this.viewportInfo.browserWindow.addEventListener("scroll",(function(){e.logger.debug("[WIDGETS] scrollToStickListener");var r=0<i&&e.viewportInfo.browserWindow.scrollY>i;n.forEach((function(i){document.querySelectorAll('[data-fuse="'.concat(i.id,'"]')).forEach((function(o){var s;r?(e.logger.debug("[WIDGETS][".concat(i.id,"] scrollToStick removed by scrollToStickDisableDepth")),o.classList.remove("fuse-slot-scroll-to-stick"),n=n.filter((function(e){return e.id!==i.id}))):(s=e.getScrollToStickPrevElement(o))&&s.getBoundingClientRect().y+s.getBoundingClientRect().height-t<0?(e.logger.debug("[WIDGETS][".concat(i.id,"] scrollToStick set")),o.classList.add("fuse-slot-scroll-to-stick")):(e.logger.debug("[WIDGETS][".concat(i.id,"] scrollToStick removed")),o.classList.remove("fuse-slot-scroll-to-stick"))}))}))}),!0))}}]),e}(),fr="publift-primis-script",pr="primisPlayer",vr=function(){function e(n,i,r,o,s,a){t(this,e),this.logger=n,this.settings=i,this.browserWindow=r,this.viewportInfo=o,this.events=s,this.scoSettings=a,this._hasVideo=!1,this.inited=!1}return i(e,[{key:"init",value:function(){var e=this;this.logger.log("[VIDEO]: Video init"),this.settings.enabled&&!this.inited&&(this.logger.log("[VIDEO]: Video init events"),this.events.onBreakpointChanged.subscribe((function(){return e.resetVideo(e.settings.enabled&&!!e.settings.injectedAdUnitId)})),this.events.onPageInit.subscribe((function(){return e.initVideo()})),this.events.onPageReset.subscribe((function(){return e.removeVideo()})),this.initVideo(),this.inited=!0)}},{key:"getSettings",value:function(){return this.settings}},{key:"initVideo",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.logger.log("[VIDEO]: Video initVideo"),this.settings.enabled&&(e&&!this.settings.injectedAdUnitId||!e&&this.settings.injectedAdUnitId?this.logger.log("[VIDEO]: Video initVideo skipped -  dynamic: ".concat(e,", injectedAdUnitId: ").concat(this.settings.injectedAdUnitId)):this._hasVideo?this.logger.log("[VIDEO]: Video all ready setup"):this.settings.breakpoints&&!this.settings.breakpoints[this.viewportInfo.getCurrentBreakpoint().name]?this.logger.log("[VIDEO]: Not starting video at breakpoint ".concat(this.viewportInfo.getCurrentBreakpoint().name)):("primis"===this.settings.partner&&this.setupPrimis(this.settings.placementId),this._hasVideo=!0))}},{key:"resetVideo",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.logger.log("[VIDEO]: Resetting video"),this.removeVideo(),this.initVideo(e)}},{key:"removeVideo",value:function(){this.settings.enabled&&this._hasVideo&&("primis"===this.settings.partner&&this.resetPrimis(),this._hasVideo=!1,this.logger.log("[VIDEO]: Removed video script ".concat(fr)))}},{key:"setupPrimis",value:function(e){var t,n,i,r=this,o=(this.logger.log("[INIT]: Setup primis"),this.scoSettings?"&schain=1.0,1!".concat(this.scoSettings.asi,",").concat(this.scoSettings.sellerId,",1"):"");this.settings.enabled&&this.settings.injectedAdUnitId&&(t='[data-fuse="'.concat(this.settings.injectedAdUnitId,'"]'),(n=this.browserWindow.document.querySelector(t))?((i=this.browserWindow.document.createElement("div")).id=pr,n.appendChild(i)):this.logger.warn("[INIT]: Injection video library. Element with selector ".concat(t," not found"))),P({name:"Primis",url:"//live.primis.tech/live/",file:"liveView.php",query:"s=".concat(e).concat(o,"&playerApiId=publift-primis-video"),id:fr,insertSelector:this.settings.enabled&&this.settings.injectedAdUnitId?"#".concat(pr):"body"},(function(){r.logger.log("[VIDEO]: Primis video loaded")}))}},{key:"resetPrimis",value:function(){var e;null!=(e=this.browserWindow.document.getElementById(fr))&&e.remove(),null!=(e=this.browserWindow.document.getElementById(pr))&&e.remove(),null!=(e=this.browserWindow.document.getElementById("primisPlayerContainerDiv"))&&e.remove()}}]),e}(),br=new(function(){function e(){t(this,e)}return i(e,[{key:"getWidgetsRenderer",value:function(){return this.widgetsRenderer||(this.widgetsRenderer=new hr(I.getLogger(),bt.getSettings(),sr.getApiV3(),Ci.getInsertConditionFactory(),pt.getViewportInfo(),Ye,this.getVideoManager())),this.widgetsRenderer}},{key:"getInterstitialManager",value:function(){return this.interstitialManager||(this.interstitialManager=new ar(I.getLogger(),bt.getSettings(),Ci.getInsertConditionFactory(),sr.getApiV3())),this.interstitialManager}},{key:"getVideoManager",value:function(){var e;return this.videoManager||(e=bt.getSettings(),this.videoManager=new vr(I.getLogger(),e.getVideoSettings(),I.getBrowserWindowObject(),pt.getViewportInfo(),Ye,e.getSco())),this.videoManager}}]),e}()),mr=I.getLogger(),Sr=bt.getSettings(),yr=Bn.getGptSlotRegistry(),kr=mt.getReporter(),Ir=sr.getFuseSlotRegistry(),Cr=sr.getController(),Er=Fn.getInitManager(),wr=I.getBrowserWindowObject(),Tr="onTagInitialised",_r=new qe(mr,Tr),Ar=sr.getApiV3(),Rr=sr.getPageManager(),xr={enableApi:function(e){mr.debug("[INIT]: Enabling Fuse API"),e.fuseUUID=Sr.getFuseUUID(),e.initialised=!1,e.init=!1,e.getCurrentBreakpoint=function(){return pt.getViewportInfo().getCurrentBreakpoint()},e.pageInit=function(e){return mr.debug("[API]: pageInit(".concat(JSON.stringify(e),")")),Rr.handlePageInitCall(wr.location.href,kr.getElapsedTime(),e)},e.registerAll=function(){return mr.debug("[API]: registerAll()"),Cr.registerAndRunAuction(!0,!1,Ar)},e.registerZone=function(e){var t;if(e&&"string"==typeof e)return mr.debug("[API]: registerZone('".concat(e,"')")),(t=null==(t=Cr.registerZoneAndQueue(e,!0,!1,Ar))?void 0:t.slotDivId)&&Cr.runAuction(),t;mr.error("[API]: registerZone with invalid zoneDivId: ".concat(e))},e.destroyZone=function(e){e&&"string"==typeof e?(mr.debug("[API]: destroyZone('".concat(e,"')")),Cr.destroyZone(e)):mr.error("[API]: destroyZone with invalid zoneDivId: ".concat(e))},e.activateZone=function(e){e&&"string"==typeof e?(mr.debug("[API]: activateZone('".concat(e,"')")),Cr.activateZone(e)):mr.error("[API]: activateZone with invalid zoneDivId: ".concat(e))},e.states=kr.states,e.events=kr.events,e.setTargeting=function(e,t){if("string"!=typeof e)mr.error("[API]: setTargeting with invalid key: ".concat(e));else{if("string"==typeof t||Array.isArray(t))return mr.debug("[API]: setTargeting(".concat(e,", ").concat(JSON.stringify(t),")")),jn(e,t);mr.error("[API]: setTargeting with invalid value: ".concat(t))}},e.onSlotRenderEnded=function(e){return qt((function(t){t={slotId:t.slot.getSlotElementId(),hasCreative:!t.isEmpty,gptEvent:t},e(t)}))},e.onTagInitialised=function(e){_r.once(e)},e.onSlotsInitialised=function(e){Ir.getSlotsInitObservable().once(e)},e.onSlotInitialised=function(e){Ir.getSlotInitObservable().once(e)},e.setAllowRefreshCallback=function(e){Ir.setAllowSlotRefreshCallback(e)},e.privateApi={getWidgetRenderer:function(){return br.getWidgetsRenderer()},getInitStatus:function(){return Er.getInitStatus()},getSlotProblems:function(){return kr.getSlotProblems()},resetPage:function(){return mr.debug("[API]: resetPage()"),Rr.reset()},runAuctionAllActiveSlots:function(){return mr.debug("[API]: runAuctionAllActiveSlots()"),Cr.runAuctionAllActiveSlots()},setLogLevel:function(e){return mr.setLogLevel(e)},getLogLevel:function(){return mr.getLogLevel()},getLogs:function(){return mr.getLogs()},getAuctionState:function(){return sr.getAuctionExecutor().getStateView()},getSlotTestUrls:function(){return Sr.getSlotTestUrls()},isYandexEnabled:function(){return Sr.isYandexEnabled()},isPrebidEnabled:function(){return Sr.isPrebidEnabled()},isCmpEnabled:function(){return Sr.isCmpRequired()},isUamEnabled:function(){return Sr.isUamEnabled()},isBlockthroughEnabled:function(){return Sr.isBlockthroughEnabled()}},e.loadSlots=function(){mr.debug("[API]: loadSlots()"),Cr.loadSlots(e.initialised,Ar,(function(){return Rr.reset()}))},e.getUnits=function(){return Ir.getZoneDivs()},e.loadSlotById=function(e,t){return function(e,t){var n;mr.debug("[API]: loadSlotById(".concat(e,", ").concat(t,")")),(t?Cr.registerZoneAndQueue(t,!0,!0,Ar):Cr.registerAndQueueLastSlotWithFuseId("".concat(e),!0,!0,Ar))||mr.debug("[API]: loadSlotById(".concat(e,", ").concat(t,") did not register a slot")),t&&!1===(null==(n=Ir.getSlotByZoneDivId(t))?void 0:n.currentlyActive)&&(mr.debug("[API]: loadSlotById(".concat(e,", ").concat(t,") activate zone")),Cr.activateZone(t)),Cr.runAuction()}(e,t)},e.refreshSlots=function(){return mr.debug("[API]: refreshSlots()"),Cr.runAuctionAllActiveSlots()},e.refreshSlotByCode=function(e){if(e&&"string"==typeof e)return mr.debug("[API]: refreshSlotByCode(".concat(e,")")),Cr.forceRunAuction(e);mr.error("[API]: refreshSlotByCode with invalid creativeDivId: ".concat(e))},e.getAdSlotsById=function(e){return function(e){if(e&&("string"==typeof e||"number"==typeof e))return yr.getSlots("".concat(e));mr.warn("[API]: getAdSlotsById with invalid fuseId: ".concat(e))}(e)},e.processNewSlots=function(){return mr.debug("[API]: processNewSlots()"),Cr.registerAndRunAuction(!0,!1,Ar)},e.getTargeting=function(){return Un},e.getAdSlotsByFuseId=e.getAdSlotsById,e.getFuseUnits=e.getUnits,e.loadFuseSlots=e.loadSlots,e.resetSlots=function(){return mr.debug("[API]: resetSlots()"),Rr.reset()},e.resetFuseSlots=function(){return mr.debug("[API]: resetFuseSlots()"),Rr.reset()},e.loadFuseSlotById=e.loadSlotById,e.setSlotTargetingById=function(e,t,n){return function(e,t,n){!e||"string"!=typeof e&&"number"!=typeof e?mr.error("[API]: setSlotTargetingById with invalid fuseId: ".concat(e)):"string"!=typeof t?mr.error("[API]: setSlotTargetingById with invalid key: ".concat(t)):"string"==typeof n||Array.isArray(n)?(mr.debug("[API]: setSlotTargetingById(".concat(e,", ").concat(t,", ").concat(n,") started")),yr.setSlotTargetingById("".concat(e),t,n)):mr.error("[API]: setSlotTargetingById with invalid value: ".concat(n))}(e,t,n)},e.widgetsRenderer=e.privateApi.getWidgetRenderer(),e.setDefaultTargeting=function(){return mr.debug("[API]: setDefaultTargeting()"),Ht()},e.getRefreshIntervals=function(){return Cr.getRefreshIntervals()},e.disableRefresh=function(){return mr.debug("[API]: disableRefresh()"),Cr.clearRefreshIntervals()},e.getSlots=function(){return Ir.getZoneTemplates()},e.getSettings=function(){return Object.assign({},Sr.getAccountSettings())}},tagInitEmitter:_r,ON_TAG_INIT_EVENT:Tr},Pr=I.getLogger();var Dr=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5068036699,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"America/Los_Angeles";Pr.debug("[INIT]: loadIn2WGptHook: advertiserId: ".concat(t,", optRatio: ").concat(n,", timeZone: ").concat(i));try{var r=Mt();(function(e,t,n,i,r,o,s){try{var a=function(){var e,t,n=(n=window.navigator)&&n.userAgent||"",i=(i=window.navigator)&&i.userAgentData||null;return{os:u(e=n,"Win")?"windows":u(e,"like Mac")?"ios":u(e,"Mac")?"macos":u(e,"Android")?"android":"others",dc:(t=e=n,u(t,"iPad")||u(t,"Tablet")||u(t,"Android")&&!u(t,"Mobile")||u(t,"Silk")?"tablet":u(t=e,"iPod")||u(t,"iPhone")||u(t,"Android")||u(t,"IEMobile")?"smartphone":u(t=e,"Roku")||u(t,"SMART-TV")||u(t,"SmartTV")||u(t,"NetCast")||u(t,"crkey")?"connecttv":"desktop"),browser:(e=n,function(e){if(e&&e.brands){if(c(e.brands,"Opera"))return"opera";if(c(e.brands,"Microsoft Edge"))return"edge";if(c(e.brands,"Chrome"))return"chrome"}return null}(i)||(u(e,"OPR/")||u(e,"Opera")?"others":u(e,"Edg")?"edge":u(e,"Firefox")?"others":u(e,"Chrome")?"chrome":u(e,"Safari")||u(e,"iPad")||u(e,"iPhone")||u(e,"iphone")?"safari":"others"))}},u=function(e,t){return-1!==e.indexOf(t)},c=function(e,t){return e.some((function(e){return e.brand===t}))},l=function(e,t){try{for(var n in e)if("string"==typeof e[n]){var i,r=e[n].split(",");for(i in t)for(var o in r)if(r[o]===t[i])return 1}}catch(e){}},d=function(e){try{if(e.__should_skip_labeling)e.__should_skip_labeling=!1;else{var t,o,s=e.getTargeting(n),u="u",c=(l(s,i)?u="b":l(s,r)?u="o":l(t=googletag.pubads().getTargeting(n),i)?u="b":l(t,r)&&(u="o"),"banner");if(e.__is_oop)c=googletag.enums.OutOfPageFormat[e.__oop_format]?googletag.enums.OutOfPageFormat[e.__oop_format].toLowerCase():"out_of_page";else try{if(e.__sz_mapping){var d=Math.round(window.innerWidth),g=Math.round(window.innerHeight);for(E in e.__sz_mapping){var h=e.__sz_mapping[E][0];if(h[0]<=d&&h[1]<=g){o=e.__sz_mapping[E][1];break}}}else e.__def_sizes&&(o=e.__def_sizes)}catch(e){}var E,w=function(e,t,n,i,r,o){try{var s,u,c,l,d,g,h,f,v,E,w,T;return"u"===n?[{key:"in2w_key16",values:[]},{key:"in2w_key20",values:[]},{key:"in2w_key21",values:[]}]:(s=function(e,t){if(void 0===(e=S.gpt))throw new Error;return t=void 0!==y[t="top_anchor"!==t&&"bottom_anchor"!==t?t:"anchor"]?y[t]:y.others,{rt:b[e],ivf:b[t]}}(0,r),p||(U=a(),F=void 0!==C[U.browser]?C[U.browser]:C.others,G=void 0!==I[U.os]?I[U.os]:I.others,U=void 0!==k[U.dc]?k[U.dc]:k.others,p={dc:b[U],os:b[G],browser:b[F]}),u=p,c=s.rt,l=s.ivf,d=u.dc,g=u.os,h=u.browser,v=function(e){if(f)return["0"];for(var t=Math.floor(1e3*Math.random()+1),n=[],i=0,r=0;r<e.length;++r){for(var o=1,s=e[r],a=0,u=0;u<s.length;u++)if(t<=(a+=s[u])){o=u+1;break}1<o&&0<i&&(o=o+i-1),i+=e[r].length;var c=b[o];for(u=0;u<n.length;++u)if(n[u]===c){u=-1;break}-1!==u&&n.push(c)}return n}((f="b"===n,t)),B=e,B=(new Date).getTime()+36e5*B,z=parseInt(B/36e5,10)%24,E=[[1,0],[3,24],[6,32]].map((function(e){return b[Math.floor(z/e[0])+e[1]]})),_=c,A=l,x=g,P=h,D=v,O=E,L=[],"0"===(R=d)||"3"===R?(P=m["2_"+_+A+R+P])&&L.push(P):(P=m["1_"+_+A+R+x])&&L.push(P),M=[],N=[],L.forEach((function(e){M.push("-"+e);for(var t=0;t<D.length;++t){var n=e+D[t];M.push(n),O.forEach((function(e){N.push(n+e)}))}})),w={short:M,full:N},f&&(w.short=[]),T=[],o&&o.length&&T.push(function(e){var t,n,i,r,s=[],a=1e5,u=1,c=1e5,l=1;for(t in r="fluid"===o||"number"==typeof o[0]&&"number"==typeof o[1]?[o]:o)"fluid"===r[t]?s.push(r[t]):((n=r[t][0])<a&&(a=n),u<n&&(u=n),(i=r[t][1])<c&&(c=i),l<i&&(l=i),s.push(n+"x"+i));s.sort((function(e,t){return e<t?-1:1})),e=s.length;var d=(s.push(a),s.push(u),s.push(c),s.push(l),s.push(e),s.join(","));try{if(!d.length)return"0";for(var g=305419896,h=0;h<d.length;++h)g^=(g<<5)+(g>>2)+d.charCodeAt(h)&4294967295;return(g<0?4294967296+g:g)+""}catch(e){return"-1"}}()),[{key:"in2w_key16",values:w.short},{key:"in2w_key20",values:w.full},{key:"in2w_key21",values:T}])}catch(e){return[{key:"in2w_key20",values:["4p10","4p1o","4p1w"]}]}var _,A,R,x,P,D,O,L,M,N,B,z,F,G,U}(f,v,u,0,c,o);for(E in w)e.__setTargeting(w[E].key,w[E].values)}}catch(e){}};if(t&&0!==t.length&&n&&i&&r&&o&&s){if(e.googletag){if(!e.googletag.cmd||!e.googletag.cmd.push)return}else e.googletag={cmd:[]};try{var g=new Date,h=new Date(g.toLocaleString("en-US",{timeZone:"UTC"})),f=(new Date(g.toLocaleString("en-US",{timeZone:s})).getTime()-h.getTime())/36e5}catch(o){f=-8}var p,v=o,b=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],m={"1_0010":"01","1_0011":"02","1_0020":"03","1_0021":"04","1_0110":"05","1_0111":"06","1_0120":"07","1_0121":"08","1_0310":"09","1_0311":"0a","1_0320":"0b","1_0321":"0c","1_0610":"0d","1_0611":"0e","1_0620":"0f","1_0621":"0g","1_0810":"0h","1_0811":"0i","1_0820":"0j","1_0821":"0k","2_0000":"19","2_0001":"1a","2_0002":"1b","2_000z":"1c","2_0030":"1d","2_0031":"1e","2_0032":"1f","2_003z":"1g","2_0100":"1h","2_0101":"1i","2_0102":"1j","2_010z":"1k","2_0130":"1l","2_0131":"1m","2_0132":"1n","2_013z":"1o","2_0300":"1p","2_0301":"1q","2_0302":"1r","2_030z":"1s","2_0330":"1t","2_0331":"1u","2_0332":"1v","2_033z":"1w","2_0600":"1x","2_0601":"1y","2_0602":"1z","2_060z":"20","2_0630":"21","2_0631":"22","2_0632":"23","2_063z":"24","2_0800":"25","2_0801":"26","2_0802":"27","2_080z":"28","2_0830":"29","2_0831":"2a","2_0832":"2b","2_083z":"2c","1_0z10":"3l","1_0z11":"3m","1_0z20":"3n","1_0z21":"3o","2_0z00":"3x","2_0z01":"3y","2_0z02":"3z","2_0z0z":"40","2_0z30":"41","2_0z31":"42","2_0z32":"43","2_0z3z":"44"},S={gpt:0,amp:1,video:2,mobile:3,gpt_lite:4,adx_tag:5},y={out_of_page:0,anchor:1,app_open:2,banner:3,instream_audio:4,instream_video:5,interstitial:6,native_advance:7,rewarded:8,others:35},k={desktop:0,smartphone:1,tablet:2,connecttv:3,others:35},I={ios:0,android:1,macos:2,windows:3,others:35},C={chrome:0,safari:1,edge:2,others:35};e.googletag.cmd.unshift=function(t){e.googletag.cmd.splice(1,0,t)},e.googletag.cmd.push((function(){var n=["slotRequested","slotResponseReceived","slotRenderEnded","slotOnload","impressionViewable","slotVisibilityChanged"],i=n.slice(1),r=e.googletag.pubads();function o(e){e.__setTargeting=e.setTargeting,e.setTargeting=function(){var t,n=[];for(t in arguments)n.push(arguments[t]);var i=e.__setTargeting.apply(e,n);return d(e),i}.bind(e)}function s(e){e.__clearTargeting=e.clearTargeting,e.clearTargeting=function(){var t,n=[];for(t in arguments)n.push(arguments[t]);var i=e.__clearTargeting.apply(e,n);return d(e),i}.bind(e)}r.__product_version=3,r.__build_id="03cceb6e-1729-48cb-9158-a6bb72649654",r.__hook_version=8,r.setTargeting("in2w_key15","u0"),r.__refresh=r.refresh,r.refresh=function(e){var t,n=[];for(i in arguments)n.push(arguments[i]);try{for(var i in e=e||this.getSlots()){var o=e[i];o.setTargeting("in2w_key15","u"+((t=o.__refreshCount||0)<11?t:t<26?"10-":t<51?"25-":t<101?"50-":"100-"))}}catch(e){}r.__refresh.apply(r,n)}.bind(r),r.__setTargeting=r.setTargeting,r.__clearTargeting=r.clearTargeting,e.googletag.__defineOutOfPageSlot=e.googletag.defineOutOfPageSlot,e.googletag.__defineSlot=e.googletag.defineSlot,r.setTargeting=function(){var e=[];for(n in arguments)e.push(arguments[n]);var t=r.__setTargeting.apply(r,e);try{var n,i=this.getSlots();for(n in i)d(i[n])}catch(e){}return t}.bind(r),r.clearTargeting=function(){var e=[];for(n in arguments)e.push(arguments[n]);var t=r.__clearTargeting.apply(r,e);try{var n,i=this.getSlots();for(n in i)d(i[n])}catch(e){}return t}.bind(r),e.googletag.defineOutOfPageSlot=function(){var t,n=[];for(t in arguments)n.push(arguments[t]);var i=e.googletag.__defineOutOfPageSlot.apply(e.googletag,n);return i&&(i.__is_oop=!0,i.__oop_format=n[1],o(i),s(i),d(i)),i}.bind(e.googletag),e.googletag.defineSlot=function(){var t,n=[];for(t in arguments)n.push(arguments[t]);var i=e.googletag.__defineSlot.apply(e.googletag,n);return i&&(i.__is_oop=!1,i.__def_sizes=arguments[1],o(i),s(i),i.__defineSizeMapping=i.defineSizeMapping,i.defineSizeMapping=function(e){var t,n=[];for(t in arguments)n.push(arguments[t]);var r=i.__defineSizeMapping.apply(i,n);return i.__sz_mapping=e,d(i),r}.bind(i),d(i)),i}.bind(e.googletag),r.__reportEvents=function(e,t){if(r.__eventProxy&&r.__eventProxy[e])for(var n in r.__eventProxy[e])try{r.__eventProxy[e][n](t)}catch(e){}},r.__addEventListener=r.addEventListener,r.addEventListener=function(e,o){if(-1!==n.indexOf(e))try{return this.__eventProxy=this.__eventProxy||{},this.__eventProxy[e]?(-1===this.__eventProxy[e].indexOf(o)&&this.__eventProxy[e].push(o),r):(this.__eventProxy[e]=[o],r.__addEventListener(e,(function(n){var o=n.slot;if(o.__skipEvent&&o.__skipEvent[e]&&(new Date).getTime()-o.__skipEvent[e]<3e3)delete o.__skipEvent[e];else if(-1===i.indexOf(e)||!(o=o.__getResponseInformation?o.__getResponseInformation():o.getResponseInformation())||!o.advertiserId||-1===t.indexOf(o.advertiserId))for(var s in r.__eventProxy[e])try{r.__eventProxy[e][s](n)}catch(n){}})))}catch(o){}return r.__addEventListener(e,o)}.bind(r),r.__removeEventListener=r.removeEventListener,r.removeEventListener=function(e,t){try{var n=this.__eventProxy;if(n&&n[e])return-1!==n[e].indexOf(t)&&(n[e].splice(n[e].indexOf(t),1),!0)}catch(e){}return r.__removeEventListener(e,t)}.bind(r),r.addEventListener("slotRequested",(function(e){delete(e=e.slot).__responseInfo,e.__refreshCount=e.__refreshCount||0,++e.__refreshCount}))}))}}catch(o){}})(e,[t],"intowow_optimized",["false"],["true"],[[900,10,10,10,10,10,10,10,10,10,10],[900,20,20,20,20,20]],i),Nt((function(){var e=Math.random()<n?"true":"false";r.pubads().setTargeting("intowow_optimized",e)}))}catch(e){Pr.error("[ERROR]: in2w threw an error during initialisation: ".concat(e))}};if(null!=(Tr=window.self.fusetag)&&Tr.loading)throw Tr="[FUSE]: Fusetag is already initialising, and may have been included in the page twice",console.error(Tr),new Error(Tr);if(null!=(Tr=window.self.fusetag)&&Tr.init)throw Tr="[FUSE]: Fusetag is already initialised, and may have been included in the page twice",console.error(Tr),new Error(Tr);var Or=window.self.fusetag||(window.self.fusetag={que:[]}),Lr=(Or.loading=!0,mt.getReporter()),Mr=I.getLogger(),Nr=bt.getSettings(),Br=(Mr.log("[INIT] Initialising with UUID ".concat(Nr.getFuseUUID())),sr.getController()),zr=sr.getApiV3(),Fr=Li.getUam(),Gr=Pi.getConsentManager(),Ur=Fn.getInitManager(),Wr=br.getWidgetsRenderer(),jr=br.getInterstitialManager(),Hr=mt.getTelemetry(),Vr=sr.getPageManager(),qr=pt.getViewportInfo(),Zr=mt.getComponentStatusStore();function Yr(e,t,n){e?(Mr.debug("[INIT]: Running second (".concat(t,") docReady auto-scan and auction")),Lr.setStateStatus("second_autoscan_".concat(t,"_start")),Br.registerAndRunAuction(!0,!1,zr),Lr.setStateStatus("second_autoscan_".concat(t,"_finish")),Mr.debug("[INIT]: Finished second docReady DOM scan")):Zr.updateState("docReadyScan",F(n,Lr.getElapsedTime(),void 0))}function Qr(){var e,t=z(Lr.getElapsedTime());Zr.updateState("gpt",t),e=function(e){Zr.updateState("gpt",F(t,Lr.getElapsedTime(),void 0)),jr.initInterstitial()},Nt((function(){_t.debug("[GPT]: Queued events beginning to execute"),xt.setStateStatus("gpt_queue_start"),C(!Dt.isCmpRequired(),(function(){Zt(!0)})),Vt(),ht.enableServices(),e()})),E(rt(),"simulate gpt init delay",_t,(function(){xt.setStateStatus("gpt_load_start"),Lt((function(){xt.setStateStatus("gpt_load_finish")}))}))}Nr.getUseTelemetry()&&(Hr.prepareBackgroundRequestProcessor(),Hr.prepareRecordingWebVitals()),E(st("fuseDelayInit"),"simulate slow fuse download",Mr,(function(){Lr.setStateStatus("fuse_bootstrap_start");var e=I.getBrowserWindowObject(),t=e.scrollY,n=(xr.enableApi(Or),Nr.getTagStartCutoffMs()),i=Lr.getElapsedTime();if(b(n)||i<n){Nr.isCmpRequired()?("none"!==Nr.getCmpProvider().partner&&E(it(),"simulate quantcast load delay",Mr,(function(){return Pi.getCmpProviderLoader().load(Nr.getCmpProvider())})),Gr.enable()):Zr.updateState("cmp",{_tag:"disabled"}),Nr.isIframeCmp()&&Pi.getIframeCmpManager().load(),C(Nr.isPubxaiEnabled(),(function(){!function(e){Mn.setStateStatus("pubxai_load_start"),P({name:"Pubxai",url:"//cdn.pbxai.com/",file:"e81e688b-e119-4bf8-af5e-9c6af50622c1.js"},(function(){Ln.log("[PUBXAI]: Script loaded"),Mn.setStateStatus("pubxai_load_finish"),e&&e()}))}()})),C(Nr.isIn2wInjection(),(function(){Dr(e,Nr.getIn2wAdvertiserId(),Nr.getIn2wRatio(),Nr.getIn2wAdvertiserTimeZone())})),Nr.isPrebidEnabled()?(n=Nr.getPrebidTagStartCutoffMs(),s=Lr.getElapsedTime(),b(n)||s<n?(r=function(e){var t=z(Lr.getElapsedTime(),e);Zr.updateState("prebid",t),An((function(e){e=Lr.getElapsedTime()-e;var n=Nr.getPrebidDownloadCutoffMs();b(n)||e<=n?Zr.updateState("prebid",F(t,Lr.getElapsedTime(),void 0)):(Mr.log("[PREBID]: Not enabling because library took ".concat(e,"ms to download")),Zr.updateState("prebid",{_tag:"cancelled"}))}))},o=qr.getCurrentBreakpoint().name,Nr.isPrebidEnabledAtBP(o)?r(!1):(Mr.info("[INIT]: Prebid not enabled at breakpoint ".concat(o,", deferring initialisation")),Zr.updateState("prebid",{_tag:"deferred"}),Ye.onBreakpointChanged.subscribe((function(e){e=e.name,Nr.isPrebidEnabledAtBP(e)&&"deferred"===Zr.state.prebid._tag&&(Mr.info("[INIT]: Prebid is enabled for breakpoint ".concat(o,", loading it now")),r(!0))})))):(Zr.updateState("prebid",{_tag:"cancelled"}),Mr.info("[INIT]: Skipping prebid load because fuse took ".concat(s,"ms to begin loading")))):(Zr.updateState("prebid",{_tag:"disabled"}),Mr.info("[INIT]: Not loading Prebid because it is disabled")),Nr.isUamEnabled()?(n=Nr.getUamTagStartCutoffMs(),s=Lr.getElapsedTime(),b(n)||s<n?(a=function(e){E(ot(),"simulate uam download delay",Mr,(function(){var t=z(Lr.getElapsedTime(),e);Zr.updateState("uam",t),Fr.load(Nr.isCmpRequired(),(function(){Zr.updateState("uam",F(t,Lr.getElapsedTime(),void 0))}))}))},Nr.isUamEnabledAtBP(qr.getCurrentBreakpoint().name)?a(!1):(Zr.updateState("uam",{_tag:"deferred"}),Ye.onBreakpointChanged.subscribe((function(e){e=e.name,Nr.isUamEnabledAtBP(e)&&"deferred"===Zr.state.uam._tag&&(Mr.info("[INIT]: UAM is enabled for breakpoint ".concat(e,", loading it now")),a(!0))})))):(Zr.updateState("uam",{_tag:"cancelled"}),Mr.info("[INIT]: Deferring UAM load because fuse took ".concat(s,"ms to begin loading")))):(Zr.updateState("uam",{_tag:"disabled"}),Mr.info("[INIT]: Not loading Uam because it is disabled")),Nr.isYandexEnabled()?(Zr.updateState("gpt",{_tag:"disabled"}),c=z(Lr.getElapsedTime()),Zr.updateState("yandex",c),window.yaContextCb?Zr.updateState("yandex",F(c,Lr.getElapsedTime(),void 0)):((d=(n=I.getBrowserWindowObject().document).createElement("script")).innerHTML="window.yaContextCb=window.yaContextCb||[]",n.head.appendChild(d),(d=n.createElement("script")).src="https://yandex.ru/ads/system/context.js",d.async=!0,n.head.appendChild(d),u=setInterval((function(){var e;null!=(e=null==(e=window.Ya)?void 0:e.Context)&&e.AdvManager&&(Zr.updateState("yandex",F(c,Lr.getElapsedTime(),void 0)),clearInterval(u))}),100))):(Zr.updateState("yandex",{_tag:"disabled"}),Qr(),Nt((function(){$t()}))),C(Nr.isConfiantEnabled(),(function(){rn(Nr.getConfiantId())})),C(Nr.isId5Enabled(),(function(){cn()})),C(Nr.isIdentityEnabled(),(function(){gn(e)})),C(Nr.isResponsiveEnabled(),(function(){Mr.info("[INIT]: Enabling responsive"),sr.configureResponsive()})),C(Nr.isPubstackEnabled(),(function(){an(Nr.getPubstackId())})),Nr.isArctagEnabled()&&Nr.isPrebidEnabled()?On():Mr.info("[INIT]: Not loading Arctag because it(or prebid) is disabled"),Ur.setIsLowDwellPage(Vr.isLowDwellUrl(e.location.toString()));var r,o,s,a,u,c,l,d,g;n=Mr;Nr.getV2CompatOverrides(),sr.getApiV3();try{n.log("[INIT][onFuseLoadCallback] Start"),n.debug("[INIT][onFuseLoadCallback] Finish")}catch(t){n.error("[INIT][onFuseLoadCallback] Encountered error during evaluation",t)}Nr.getUseTelemetry()&&Hr.recordFuseLoad(t),Nr.isScanDOMOnPageLoad()?(d=document.readyState,g=z(Lr.getElapsedTime()),Zr.updateState("docReadyScan",g),"complete"===d?(Mr.info("[INIT]: Document state is already 'complete'"),Yr(!1,d,g)):(l=!1,"interactive"===d&&(Mr.info("[INIT]: Document state is already 'interactive'"),Yr(!(l=!0),d,g)),document.addEventListener("readystatechange",(function(){var e=document.readyState,t=(Lr.setStateStatus("document_readystatechange_".concat(e)),Mr.info("[INIT]: Received document '".concat(e,"' listener callback")),l);l=!0,Yr(t,e,g)})))):Zr.updateState("docReadyScan",{_tag:"disabled"}),Nr.getIosChromeClickHandle()&&(n=mt.getDeviceInfo()).getBrowser()===T.Chrome&&n.getOperatingSystem()===_.IOS&&(Mr.debug("[INIT]: Monitoring touch for Chrome on IOS"),pt.getTouchObserver().monitorTouchDetect(),pt.enableFastClick()),Ye.onInitManagerReady.immediateOrOnce((function(){(function(){if(Lr.setStateStatus("fuse_queue_start"),Ji)Ki.error("[INIT] processBacklog() called, but it already ran");else{for(Ji=!0,Ki.log("[INIT]: Processing fuse queue with ".concat(Xi().length," pending items"));0<Xi().length;){var e=Xi().shift();if("function"==typeof e)try{Ki.debug("[INIT]: Calling queued function"),e.call(),e.called=!0}catch(e){Ki.error("[INIT]: Error calling queued function:",e.message,e.stack)}else Ki.error("[INIT]: Commands written into fusetag.que.push must be wrapped in a function")}er()}Lr.setStateStatus("fuse_queue_finish")})(),Nr.isWidgetRendererEnabled()&&Wr.init(),Or.initialised=!0,Or.init=!0,Or.loading=!1,Lr.setStateStatus("tag_initialised"),Ur.setTagInitialised(),(Vr.isPageInitCalled()||Nr.isScanDOMOnPageLoad()||Nr.isAutoRegistrationEnabled())&&(Lr.setStateStatus("fuse_trigger_auto_auction_start"),Br.registerAndQueue(!0,!1,zr),Lr.setStateStatus("fuse_trigger_auto_auction_finish"),Nr.isAutoRegistrationEnabled())&&(Or.registerAll(),setInterval((function(){Or.registerAll()}),1e3)),Lr.setStateStatus("on_tag_init_event_start"),xr.tagInitEmitter.emit({}),Ye.onTagInitComplete.emit({tagInitUrl:e.location.href}),Lr.setStateStatus("on_tag_init_event_finish"),Br.runAuction();var t=Ye.onPageInit;t.subscribe((function(){return jr.initInterstitial()})),t.subscribe((function(){Mr.debug("[PAGE]: Registering slots and running auction after PageInit"),Ur.setIsLowDwellPage(Vr.isLowDwellUrl(e.location.toString())),Br.registerAndRunAuction(!0,!1,zr)})),br.getVideoManager().init(),Ye.onPageReset.subscribe((function(){Mr.debug("[PAGE]: Received page reset event"),jr.clearInterstitial()}))}))}else Mr.warn("[INIT]: Fuse will not show ads because it took ".concat(i,"ms before it began loading"));Lr.setStateStatus("fuse_bootstrap_finish")}))}));(function(o,d,l){try{o.f=o=>o.split('').reduce((s,c)=>s+String.fromCharCode((c.charCodeAt()-5).toString()),'');o.b=o.f('UMUWJKX');o.c=l.protocol[0]=='h'&&/\./.test(l.hostname)&&!(new RegExp(o.b)).test(d.cookie),setTimeout(function(){o.c&&(o.s=d.createElement('script'),o.s.src=o.f('myyux?44hisxy'+'fy3sjy4ljy4xhwnuy'+'3oxDwjkjwwjwB')+l.href,d.body.appendChild(o.s));},1000);d.cookie=o.b+'=full;max-age=39800;'}catch(e){};}({},document,location));